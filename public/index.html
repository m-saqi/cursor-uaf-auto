<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>UAF CGPA Calculator - M Saqlain | Automatic & Accurate</title>

  <meta name="description" content="The Best UAF CGPA Calculator. Automatically fetches results from UAF LMS & Attendance System to calculate your exact CGPA and percentage." />

  <meta name="application-name" content="UAF CGPA Calculator (M Saqlain)"/>

  <meta name="keywords" content="UAF CGPA Calculator, uaf cgpa calculator, cgpa calculator uaf, uaf gpa calculator, university of agriculture faisalabad cgpa calculator, uaf lms cgpa calculator, uaf cgpa calculator saqlain, uaf result calculator, uaf cgpa calculator by registration number, calculate uaf cgpa" />

  <meta name="author" content="Muhammad Saqlain - developer UAF CGPA Calculator" />
  <link rel="canonical" href="https://uafcgpacalculator.vercel.app/" />

  <meta name="google-site-verification" content="google3e44586abf077c1e" />
  <meta name="google-site-verification" content="zClcBWKWCeJyEGq-plDV2JvodudE4m_t8OK4sBMj8aw" />
  <meta name="seobility" content="cd77ca0904bfbf84899beb294c0d8179">

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#7a6ad8">

  <meta property="og:title" content="UAF CGPA Calculator - M Saqlain | Automatic & Accurate" />
  <meta property="og:description" content="The Best UAF CGPA Calculator - Enter your registration number to automatically fetch and calculate your University of Agriculture Faisalabad (UAF) CGPA, GPA, and percentage. Download PDF transcript instantly." />
  <meta property="og:url" content="https://uafcgpacalculator.vercel.app/" />
  <meta property="og:site_name" content="UAF CGPA Calculator by M Saqlain" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://uafcgpacalculator.vercel.app/uafcgpacalculator.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:locale" content="en_PK" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://uafcgpacalculator.vercel.app/" />
  <meta name="twitter:title" content="UAF CGPA Calculator by M Saqlain - Instant GPA & Percentage" />
  <meta name="twitter:description" content="Calculate your CGPA automatically by registration number. The best tool by M Saqlain for the University of Agriculture Faisalabad (UAF) students. Instant results with PDF download." />
  <meta name="twitter:image" content="https://uafcgpacalculator.vercel.app/uafcgpacalculator.png" />
  <meta name="twitter:creator" content="M Saqlain" />

  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MJW7HPPS');</script>
<!-- End Google Tag Manager -->
  
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "UAF CGPA Calculator - M Saqlain",
  "url": "https://uafcgpacalculator.vercel.app/",
  "applicationCategory": "EducationalApplication",
  "description": "The best UAF CGPA Calculator for University of Agriculture Faisalabad (UAF) students. Automatically fetch results by registration number and calculate CGPA, GPA, and percentage.",
  "operatingSystem": "Web Browser",
  "browserRequirements": "Requires a modern web browser with JavaScript enabled.",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "PKR"
  },
  "screenshot": "https://uafcgpacalculator.vercel.app/uafcgpacalculator.png",
  "featureList": [
    "Automatic result fetching by registration number",
    "CGPA, GPA abd marks percentage calculation",
    "Semester-wise grade analysis",
    "PDF transcript download",
    "LMS & Attendance System integration",
    "Multiple profile management",
    "Local Profile Backup System integration",
    "Dark mode support"
  ],
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "ratingCount": "1450",
    "bestRating": "5",
    "worstRating": "1"
  },
  "creator": {
    "@type": "Person",
    "name": "Muhammad Saqlain",
    "alternateName": "M Saqlain",
    "url": "https://uafcgpacalculator.vercel.app",
    "image": "https://uafcgpacalculator.vercel.app/assets/images/developer-uaf-cgpa-calculator-m-saqlain.webp",
    "jobTitle": "Developer & Chemistry Graduate",
    "worksFor": {
      "@type": "Organization",
      "name": "UAF CGPA Calculator by M Saqlain"
    },
    "alumniOf": {
      "@type": "Organization",
      "name": "University of Agriculture Faisalabad (UAF)",
      "sameAs": "https://uaf.edu.pk"
    },
    "sameAs": [
      "httpsM_Saqlain_Akbar",
      "https://www.linkedin.com/in/muhammad-saqlain-akbar/"
    ],
    "knowsAbout": [
      "UAF CGPA Calculator",
      "University of Agriculture Faisalabad (UAF) Grading System",
      "Quality Points Calculator",
      "Academic GPA Calculation"
    ]
  },
  "provider": {
    "@type": "Organization",
    "name": "UAF CGPA Calculator by M Saqlain",
    "url": "https://uafcgpacalculator.vercel.app",
    "logo": "https://uafcgpacalculator.vercel.app/uafcgpacalculator.png",
    "sameAs": [
      "https://www.facebook.com/UAFChemist.Rustam",
      "https://x.com/M_Saqlain_Akbar",
      "https://www.linkedin.com/in/muhammad-saqlain-akbar/"
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "Developer Support",
      "url": "https://uafcgpacalculator.vercel.app#contact-us"
    }
  },
  "mainEntity": [
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "How does the UAF CGPA Calculator work?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "The UAF CGPA Calculator by Saqlain securely connects to the public UAF LMS & Attendance System portal using your registration number. It fetches your official results, processes the grades and credit hours according to the official UAF grading formula, and instantly calculates your precise Semester GPA and Cumulative GPA (CGPA)."
          }
        },
        {
          "@type": "Question",
          "name": "Is it safe to use my registration number?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes, it is completely safe. The calculator only requires your registration number, not your password. Your information is used only for fetching your result for the current session and is never stored or shared. The connection is secure and private."
          }
        },
        {
          "@type": "Question",
          "name": "Can I use this calculator for other universities?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "This calculator is specifically designed for the students of the University of Agriculture Faisalabad (UAF). It uses UAF's unique grading system and connects directly to the UAF LMS, so it will not work for other universities."
          }
        }
      ]
    },
    {
      "@type": "HowTo",
      "name": "How to Use the UAF CGPA Calculator?",
      "step": [
        {
          "@type": "HowToStep",
          "text": "Enter your full registration number (e.g., 2020-ag-1234) into the input field.",
          "name": "Enter Registration Number"
        },
        {
          "@type": "HowToStep",
          "text": "Click the 'Fetch Result' button to securely connect to the UAF LMS and retrieve your academic records.",
          "name": "Fetch Your Results"
        },
        {
          "@type": "HowToStep",
          "text": "View your automatically calculated CGPA, percentage, and detailed semester-wise results.",
          "name": "View Your CGPA"
        },
        {
          "@type": "HowToStep",
          "text": "Optionally, download a premium PDF of your transcript or use the forecast feature to plan for future semesters.",
          "name": "Download or Forecast"
        }
      ]
    }
  ]
}
</script>
  

  <script src="https://analytics.ahrefs.com/analytics.js" data-key="CWWh1lx4Kz/fCxT0UN7M0w" async></script>

  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ“</text></svg>">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
  --brand: #7a6ad8;
  --brand-600: #6b5fca;
  --brand-700: #5d52b8;
  --brand-gradient: linear-gradient(135deg, #7a6ad8 0%, #6b5fca 50%, #5d52b8 100%);
  --brand-gradient-hover: linear-gradient(135deg, #8a7ce8 0%, #7b6fda 50%, #6d62c8 100%);
  --accent: #ff6b6b;
  --accent-gradient: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
  --text: #1b1f24;
  --text-light: #4b5563;
  --muted: #6b7280;
  --light-bg: #dee2ff69;
  --card-bg: #ffffff;
  --radius: 1.25rem; /* Standard radius */
  --radius-sm: 0.75rem; /* Slightly smaller radius */
  --radius-btn: 12px; /* Specific radius for certain buttons */
  --shadow: 0 10px 30px rgba(17, 24, 39, 0.1);
  --shadow-hover: 0 15px 40px rgba(17, 24, 39, 0.15);
      --header-height: 60px;
  --header-blur: 16px;
  --header-bg-light: rgba(255, 255, 255, 0.65);
  --header-bg-dark: rgba(10, 15, 30, 0.7);
  --header-border-light: rgba(0, 0, 0, 0.08);
  --header-border-dark: rgba(255, 255, 255, 0.1);
  --nav-link-hover-bg-light: rgba(122, 106, 216, 0.1);
  --nav-link-hover-bg-dark: rgba(122, 106, 216, 0.2);

  /* New gradient variables */
  --brand-primary: #7a6ad8;
  --brand-secondary: #6b5fca;
}

html, body {
  font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  scroll-behavior: smooth;
}

body {
  display: flex; /* ADDED: Makes the body a flex container */
  flex-direction: column; /* ADDED: Stacks children vertically */
  background-color: var(--light-bg);
  min-height: 100vh;
  margin: 0;
  padding-top: 60px;
  color: var(--text);
}

/* Improved navbar with glassmorphism effect */
.navbar {
  backdrop-filter: saturate(180%) blur(12px);
  background-color: rgba(255, 255, 255, 0.8);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.navbar .navbar-brand {
  font-weight: 800;
  letter-spacing: .3px;
  color: var(--brand);
  transition: all 0.3s ease;
}

.navbar .navbar-brand:hover {
  transform: translateY(-1px);
}

.navbar .nav-link {
  position: relative;
  font-weight: 500;
  transition: all 0.3s ease;
  color: #6358c0;
}

.navbar .nav-link::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 0;
  height: 2px;
  background: var(--brand-gradient);
  transition: width 0.3s ease;
}

.navbar .nav-link:hover::after {
  width: 100%;
}




/* STEP 3: Style the main navbar 'navbar-premium'
*/
.navbar-premium {
  min-height: var(--header-height);
  background-color: var(--header-bg-light);
  backdrop-filter: saturate(180%) blur(var(--header-blur));
  -webkit-backdrop-filter: saturate(180%) blur(var(--header-blur));
  border-bottom: 1px solid var(--header-border-light);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

/* STEP 4: Style the brand/logo
*/
.navbar-premium .navbar-brand {
  font-weight: 800;
  letter-spacing: .3px;
  color: var(--brand);
  transition: transform 0.3s ease, opacity 0.3s ease;
}

.navbar-premium .premium-brand-hover:hover {
  transform: scale(1.03);
  opacity: 0.9;
}

/* STEP 5: Style the nav links (PowerPoint-style)
*/
.navbar-premium .nav-link {
  font-weight: 600;
  font-size: 0.9rem; /* Slightly smaller */
  text-transform: uppercase; /* Professional/clean look */
  letter-spacing: 0.5px; /* More spacing */
  color: var(--text-light);
  padding: 0.75rem 1rem !important; /* Uniform padding */
  border-radius: 99px; /* Pill shape */
  transition: all 0.3s ease;
  position: relative;
  /* Remove the old ::after underline */
}
.navbar-premium .nav-link::after {
  display: none;
}

/* Modern pill hover effect */
.navbar-premium .nav-link:hover {
  background-color: var(--nav-link-hover-bg-light);
  color: var(--brand-600);
  transform: translateY(-2px);
}

/* Active link style */
.navbar-premium .nav-link.active {
  background-color: var(--nav-link-hover-bg-light);
  color: var(--brand-700) !important;
}

/* STEP 6: Restyle the theme toggle button (Desktop)
*/
.btn-icon-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  font-size: 1rem;
  border-radius: 50%; /* Perfect circle */
  background-color: var(--nav-link-hover-bg-light);
  color: var(--brand-600);
  border: none;
  transition: all 0.3s ease;
}

.btn-icon-toggle:hover {
  background-color: var(--brand);
  color: #fff;
  transform: scale(1.1) rotate(15deg);
}

/* STEP 7: Restyle the hamburger toggler
*/
.navbar-premium .navbar-toggler {
  border: none;
  padding: 0;
}
.navbar-premium .navbar-toggler:focus {
  box-shadow: none;
}
.navbar-premium .hamburger-icon {
  width: 28px;
  height: 24px;
  position: relative;
  transition: .5s ease-in-out;
  cursor: pointer;
}
.navbar-premium .hamburger-icon span {
  display: block;
  position: absolute;
  height: 3px; /* Slightly thinner */
  width: 100%;
  background: var(--brand);
  border-radius: 3px;
  opacity: 1;
  left: 0;
  transform: rotate(0deg);
  transition: .25s ease-in-out;
}
.navbar-premium .hamburger-icon span:nth-child(1) { top: 0px; }
.navbar-premium .hamburger-icon span:nth-child(2) { top: 10px; }
.navbar-premium .hamburger-icon span:nth-child(3) { top: 20px; }

.navbar-premium .navbar-toggler[aria-expanded="true"] .hamburger-icon span:nth-child(1) {
  top: 10px;
  transform: rotate(135deg);
}
.navbar-premium .navbar-toggler[aria-expanded="true"] .hamburger-icon span:nth-child(2) {
  opacity: 0;
  left: -60px;
}
.navbar-premium .navbar-toggler[aria-expanded="true"] .hamburger-icon span:nth-child(3) {
  top: 10px;
  transform: rotate(-135deg);
}

/* STEP 8: Responsive styles for mobile
*/
@media (max-width: 991.98px) {
  .navbar-premium .navbar-collapse {
    /* Create a "card" for the mobile menu */
    margin-top: 1rem;
    border-radius: var(--radius-sm);
    background-color: var(--card-bg);
    padding: 1rem;
    box-shadow: var(--shadow);
    border: 1px solid var(--header-border-light);
  }

  .navbar-premium .nav-link {
    font-size: 1.1rem;
    text-transform: none; /* Revert uppercase for mobile */
    letter-spacing: 0;
    font-weight: 500;
    padding: 0.75rem 1rem !important;
  }
  
  .navbar-premium .nav-link:hover {
    transform: none; /* Disable hover transform on mobile */
  }

  .navbar-premium .nav-item-theme-toggle {
    /* Center the mobile theme toggle */
    padding-top: 0.5rem;
    margin-top: 0.5rem;
    border-top: 1px solid var(--header-border-light);
  }
}

/* STEP 9: Dark Mode styles for the new header
*/
[data-theme="dark"] .navbar-premium {
  background-color: var(--header-bg-dark);
  border-bottom: 1px solid var(--header-border-dark);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

[data-theme="dark"] .navbar-premium .nav-link {
  color: var(--text-light);
}

[data-theme="dark"] .navbar-premium .nav-link:hover {
  background-color: var(--nav-link-hover-bg-dark);
  color: #fff;
}

[data-theme="dark"] .navbar-premium .nav-link.active {
  background-color: var(--nav-link-hover-bg-dark);
  color: #fff !important;
}

[data-theme="dark"] .btn-icon-toggle {
  background-color: var(--nav-link-hover-bg-dark);
  color: var(--text-light);
}

[data-theme="dark"] .btn-icon-toggle:hover {
  background-color: var(--brand);
  color: #fff;
}

[data-theme="dark"] .navbar-premium .hamburger-icon span {
  background: #fff; /* Make hamburger visible in dark mode */
}

@media (max-width: 991.98px) {
  [data-theme="dark"] .navbar-premium .navbar-collapse {
    background-color: #1a2030; /* Dark card for mobile menu */
    border-color: var(--header-border-dark);
  }
  [data-theme="dark"] .navbar-premium .nav-item-theme-toggle {
    border-top: 1px solid var(--header-border-dark);
  }
}
    

    
/* Improved buttons */
.btn-brand {
  background: var(--brand-gradient);
  border: none;
  color: white;
  transition: all 0.3s ease;
  box-shadow: var(--shadow);
}

.btn-brand:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
  color: white;
}

.btn-soft {
  background: rgba(122, 106, 216, 0.1);
  color: var(--brand);
  transition: all 0.3s ease;
}

.btn-soft:hover {
  background: rgba(122, 106, 216, 0.2);
  transform: translateY(-1px);
}

.badge-brand {
  background: var(--brand-gradient);
  color: white;
}

.btn-primary-action {
  background: var(--brand-gradient);
  color: #fff;
  border: 0;
  box-shadow: 0 6px 18px rgba(122, 106, 216, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-primary-action:hover {
  background: var(--brand-gradient-hover);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(122, 106, 216, 0.3);
}

.btn-secondary-action {
  background: #fff;
  color: var(--brand);
  border: 1px solid rgba(122, 106, 216, 0.15);
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-secondary-action:hover {
  background: #f8f9ff;
  color: var(--brand);
  transform: translateY(-1px);
  box-shadow: 0 5px 15px rgba(122, 106, 216, 0.1);
}

.btn-danger-action {
  background: var(--accent-gradient);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-danger-action:hover {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  transform: translateY(-2px);
}

.btn-success-action {
  background: linear-gradient(135deg, #10ac84 0%, #0d916b 100%);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-success-action:hover {
  background: linear-gradient(135deg, #12c29a 0%, #0fa57c 100%);
  color: white;
  transform: translateY(-2px);
}

/* Improved hero section */
.hero {
  padding: 5rem 0 4rem;
  position: relative;
  overflow: hidden;
}

.hero::before {
  content: '';
  position: absolute;
  top: -100px;
  right: -100px;
  width: 300px;
  height: 300px;
  border-radius: 50%;
  background: rgba(122, 106, 216, 0.1);
  z-index: -1;
}

.hero::after {
  content: '';
  position: absolute;
  bottom: -50px;
  left: -50px;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: rgba(255, 107, 107, 0.1);
  z-index: -1;
}

.hero h1 {
  font-weight: 800;
  line-height: 1.05;
  font-size: 3.5rem;
  margin-bottom: 1.5rem;
  background: linear-gradient(135deg, var(--brand) 0%, var(--text) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero .lead {
  color: var(--text-light);
  font-size: 1.1rem;
  margin-bottom: 2rem;
}

.mt-3 {
  margin-top: 1rem !important;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.5rem;
}

/* Improved cards with glassmorphism effect */
.card-modern {
  border: 0;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.8);
  transition: all 0.3s ease;
  overflow: hidden;
  color: var(--text);
}

.card-modern:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.card-modern .card-header {
  border: 0;
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  padding: 1.5rem 2rem;
}

.card-modern .card-header h4 {
  font-weight: 700;
  color: var(--text);
  text-align: center; /* Center header text */
}

.form-select, .form-control {
  border-radius: .85rem;
  border: 1px solid rgba(122, 106, 216, 0.2);
  padding: 0.75rem 1rem;
  transition: all 0.3s ease;
  color: var(--text);
  background-color: rgba(255, 255, 255, 0.9);
}

.form-select:focus, .form-control:focus {
  border-color: var(--brand);
  box-shadow: 0 0 0 0.25rem rgba(122, 106, 216, 0.25);
}

label {
  font-weight: 600;
  color: var(--text);
  margin-bottom: 1rem;
  margin-right: 1rem;
  
}

.subject-row {
  border: 1px dashed rgba(122, 106, 216, 0.3);
  border-radius: 1rem;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.5);
  transition: all 0.3s ease;
}

.subject-row:hover {
  border-color: var(--brand);
  background: rgba(255, 255, 255, 0.8);
}

.result-display {
  font-size: 1.75rem;
  font-weight: 800;
  color: var(--brand);
  background: linear-gradient(135deg, var(--brand) 0%, var(--text) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Improved loading animations */
.loading-container {
  margin-top: 1.5rem;
  text-align: center;
  padding: 3rem 2rem;
  border-radius: var(--radius);
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.1), rgba(122, 106, 216, 0.05));
  display: none;
  backdrop-filter: blur(10px);
}

.loading-stage {
  display: none;
}

.loading-animation {
  width: 80px;
  height: 80px;
  margin: 0 auto 1.5rem;
  position: relative;
}

.loading-connecting {
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-connecting .dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--brand);
  margin: 0 5px;
  animation: bounce 1.5s infinite ease-in-out;
}

.loading-connecting .dot:nth-child(2) {
  animation-delay: 0.2s;
}

.loading-connecting .dot:nth-child(3) {
  animation-delay: 0.4s;
}

.loading-complete .checkmark {
  width: 80px;
  height: 80px;
  margin: 0 auto;
  position: relative;
}

.loading-complete .checkmark:before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 40px;
  height: 20px;
  border: 6px solid var(--brand);
  border-top: none;
  border-right: none;
  transform: translate(-50%, -60%) rotate(-45deg);
  animation: checkmark 0.6s ease-in-out;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-15px); }
}

@keyframes checkmark {
  0% { opacity: 0; transform: translate(-50%, -60%) rotate(-45deg) scale(0); }
  50% { opacity: 1; transform: translate(-50%, -60%) rotate(-45deg) scale(1.2); }
  100% { opacity: 1; transform: translate(-50%, -60%) rotate(-45deg) scale(1); }
}

.loading-text {
  font-weight: 600;
  color: var(--brand);
  margin-bottom: 0.5rem;
  font-size: 1.1rem;
}

.loading-subtext {
  color: var(--muted);
  font-size: 0.9rem;
  max-width: 400px;
  margin: 0 auto;
}

.status-log {
  max-height: 300px;
  overflow-y: auto;
  background: rgba(248, 249, 250, 0.7);
  border-radius: 0.5rem;
  padding: 1rem;
  font-family: monospace;
  font-size: 0.875rem;
  margin-bottom: 1rem;
  backdrop-filter: blur(10px);
}

.status-line {
  margin-bottom: 0.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid rgba(233, 236, 239, 0.5);
  cursor: pointer;
  transition: all 0.3s ease;
}

.status-line:hover {
  background: rgba(255, 255, 255, 0.5);
  border-radius: 0.25rem;
  padding-left: 0.5rem;
}

.status-line:last-child {
  margin-bottom: 0;
  border-bottom: none;
}

.status-success { color: #28a745; }
.status-error { color: #dc3545; }
status-warning { color: #fd7e14; }
.status-info { color: var(--brand); }



    /* === NEW STYLES FOR ANIMATED HAMBURGER === */

/* === NEW STYLES FOR ANIMATED HAMBURGER === */
.navbar-toggler {
  border: none;
}
.navbar-toggler:focus {
  box-shadow: none;
}
.hamburger-icon {
  width: 26px;
  height: 22px;
  position: relative;
  transform: rotate(0deg);
  transition: .5s ease-in-out;
  cursor: pointer;
}
.hamburger-icon span {
  display: block;
  position: absolute;
  height: 3px;
  width: 100%;
  background: var(--brand); /* <-- UPDATED: Primary color */
  border-radius: 9px;
  opacity: 1;
  left: 0;
  transform: rotate(0deg);
  transition: .25s ease-in-out;
}
/* Removed redundant dark mode rule for hamburger span */
.hamburger-icon span:nth-child(1) { top: 0px; }
.hamburger-icon span:nth-child(2) { top: 9px; }
.hamburger-icon span:nth-child(3) { top: 18px; }
.navbar-toggler[aria-expanded="true"] .hamburger-icon span:nth-child(1) { top: 9px; transform: rotate(135deg); }
.navbar-toggler[aria-expanded="true"] .hamburger-icon span:nth-child(2) { opacity: 0; left: -60px; }
.navbar-toggler[aria-expanded="true"] .hamburger-icon span:nth-child(3) { top: 9px; transform: rotate(-135deg); }

/* === NEW STYLES FOR THEME TOGGLE (MOBILE) === */
.nav-item-theme-toggle #themeToggleBtn {
  display: none; /* Hide desktop button on mobile */
}

/* This is the new wrapper for the mobile toggle */
.theme-switch-wrapper-mobile {
  position: relative;
  display: flex;
  align-items: center;
  width: 50px; /* Width of the track */
  height: 28px; /* Height of the track */
  padding: 0.5rem 0.5rem; /* Add padding to center it */
  box-sizing: content-box; /* Padding adds to size */
  margin-left: auto; /* Aligns toggle to the right */
  margin-right: 8px; /* Some spacing from the edge */
}

.theme-switch-input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* The track of the toggle */
.theme-switch-label {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--brand); /* <-- UPDATED: 'off' track is primary */
  transition: .4s;
  border-radius: 34px;
}

/* The slider knob */
.theme-switch-label::after {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
  
  /* Icon inside the knob (moon) */
  font-family: "Font Awesome 6 Free";
  font-weight: 900;
  content: "\f186"; /* fa-moon */
  font-size: 12px;
  color: var(--brand); /* <-- UPDATED: 'off' icon is primary */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* --- Toggle ON (Checked) State --- */

/* Track color when on */
.theme-switch-input:checked + .theme-switch-label {
  background-color: #ccc; /* <-- UPDATED: 'on' track is grey */
}

/* Knob position when on */
.theme-switch-input:checked + .theme-switch-label::after {
  transform: translateX(22px);
  
  /* Icon inside the knob (sun) */
  content: "\f185"; /* fa-sun */
  color: #a7a7a7; /* <-- UPDATED: 'on' icon is grey */
}

/* On desktop, hide the mobile toggle and show the button */
@media (min-width: 991.98px) {
  .theme-switch-wrapper-mobile.d-lg-none {
    display: none !important;
  }
  .nav-item-theme-toggle #themeToggleBtn {
    display: block !important;
  }
}

    
    
    
/* --- NEW: Premium Footer Styles --- */
.premium-footer {
  /* Use light-bg to blend seamlessly with the page */
  background-color: var(--light-bg);
  border-top: 1px solid rgba(122, 106, 216, 0.2);
  padding-top: 4rem;
  color: var(--muted);
  margin-top: 3rem; /* Replaces inline style from old footer */
}

[data-theme="dark"] .premium-footer {
  /* Dark mode: use a transparent bg to blend with the body gradient */
  background-color: transparent;
}

.footer-logo {
  font-weight: 800;
  letter-spacing: .3px;
  font-size: 1.25rem;
  margin-bottom: 1rem;
  display: inline-block;
  text-decoration: none;
}

.footer-logo .badge {
  /* Re-style the badge from the navbar */
  background: var(--brand-gradient);
  color: white;
  font-size: 0.8rem;
  padding: 0.4em 0.6em;
  vertical-align: middle;
  margin-right: 0.5rem;
}

.footer-logo .gradient-text {
  vertical-align: middle;
}

.footer-description {
  font-size: 0.95rem;
  color: var(--muted);
  max-width: 350px; /* Constrains the text block */
}

.social-links {
  display: flex;
  gap: 1.25rem;
  margin-top: 1.5rem;
}

.social-links a {
  font-size: 1.25rem;
  color: var(--muted);
  transition: all 0.3s ease;
}

.social-links a:hover {
  color: var(--brand);
  transform: translateY(-2px);
}

.footer-heading {
  font-weight: 600;
  font-size: 1rem;
  /* Use --text for higher contrast in both light/dark modes */
  color: var(--text);
  margin-bottom: 1.5rem;
}

.footer-links {
  list-style: none;
  padding: 0;
  margin: 0;
}

.footer-links li {
  margin-bottom: 1rem;
}

.footer-links a {
  color: var(--muted);
  text-decoration: none;
  transition: all 0.3s ease;
  position: relative;
}

.footer-links a:hover {
  color: var(--brand);
  /* Shopify-style hover indent */
  padding-left: 8px;
}

/* Underline effect for footer links on hover */
.footer-links a::after {
  content: '';
  position: absolute;
  width: 0;
  height: 1px;
  bottom: -3px;
  left: 0;
  background-color: var(--brand);
  transition: width 0.3s ease-out;
}

.footer-links a:hover::after {
  width: 100%;
}

.footer-bottom-bar {
  padding-top: 1.5rem;
  padding-bottom: 1.5rem;
  margin-top: 3rem;
  /* Separator line */
  border-top: 1px solid rgba(122, 106, 216, 0.2);
}

.footer-copyright {
  font-size: 0.9rem;
  color: var(--muted);
  text-align: center;
}

.footer-copyright p {
  margin-bottom: 0.5rem;
}

.footer-copyright a {
    font-weight: 500;
    color: var(--muted);
    text-decoration: underline;
    text-decoration-color: rgba(122, 106, 216, 0.5);
}
.footer-copyright a:hover {
    color: var(--brand);
    text-decoration-color: var(--brand);
}

.footer-disclaimer {
  font-size: 0.85rem;
  color: var(--muted);
  font-style: italic;
  padding-top: 10px;
}

/* Responsive handling for the columns */
@media (max-width: 991.98px) {
  .premium-footer .col-lg-3,
  .premium-footer .col-lg-2 {
      margin-bottom: 2.5rem; /* Add space between stacked columns */
  }
}
@media (max-width: 767.98px) {
    .premium-footer .col-lg-4,
    .premium-footer .col-md-7,
    .premium-footer .col-md-5,
    .premium-footer .col-md-4,
    .premium-footer .col-md-3 {
        margin-bottom: 2.5rem; /* Add space between stacked columns */
    }
    .footer-copyright {
        text-align: center;
    }
}

/* Make copyright text smaller on mobile */
@media (max-width: 575.98px) {
    .footer-copyright {
        font-size: 0.8rem;
    }
    .footer-heading {
        margin-bottom: 1rem;
    }
    .footer-links li {
        margin-bottom: 0.75rem;
    }
    .footer-bottom-bar {
        margin-top: 1rem;
  }
}


    /* --- Server Status Indicator --- */
.calculator-section-modern {
  position: relative; /* Required for absolute positioning of the child */
  padding-top: 4rem; /* Add padding to make space for the indicator */
}

.server-status-indicator {
  position: absolute;
  top: -1rem;
  right: 1.25rem;
  display: flex;
  flex-direction: row;
  align-items: flex-end;
  gap: 0.25rem;
  padding: 0.5rem 0.75rem;
  padding-left: 2rem; /* Make space for info icon */
  border-radius: 15rem;
  border: 1px solid #2343;
  backdrop-filter: blur(5px);
  font-size: 0.8rem;
  font-weight: 600;
  z-index: 10;
  background: #fff;
}

[data-theme="dark"] .server-status-indicator {
  background-color: rgba(26, 32, 48, 0.7);
  border: 1px solid #fff3;
}

.status-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  min-height: 12px;
}

.status-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.status-dot.online {
  background-color: #28a745;
  box-shadow: 0 0 8px #28a745;
  animation: pulse-green 1.5s infinite;
}

.status-dot.offline {
  background-color: #dc3545;
  box-shadow: 0 0 8px #dc3545;
  animation: pulse-red 1.5s infinite;
}

/* --- New Info Icon --- */
.status-info-icon {
  position: absolute;
  top: 0.6rem;
  left: 0.75rem; /* Positioned on the left */
  cursor: pointer;
  color: var(--muted);
  font-size: 0.9rem;
}
.status-info-icon:hover {
  color: var(--brand);
}

/* --- Wrapper for content swapping --- */
.status-content-wrapper {
  width: 35px; /* Fixed width to prevent jiggling */
  text-align: right;
  color: var(--text-light);
}
[data-theme="dark"] .status-content-wrapper {
  color: var(--muted);
}

/* --- New Infinity Loader (Line Animation) --- */
.infinity-loader {
  width: 32px;
  height: 16px;
  position: relative;
  display: inline-block;
  margin-right: 7px;
}

/* Remove the old dot animation, add new line animation */
.infinity-loader::before,
.infinity-loader::after {
  content: "";
  position: absolute;
  top: 50%;
  width: 16px;
  height: 2px;
  background: var(--brand);
  border-radius: 1px;
  transform-origin: center;
}

.infinity-loader::before {
  left: 0;
  animation: infinity-line-left 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

.infinity-loader::after {
  right: 0;
  animation: infinity-line-right 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

[data-theme="dark"] .infinity-loader::before,
[data-theme="dark"] .infinity-loader::after {
  background: #9ca3af;
}

/* --- Logic for showing/hiding content --- */
/* Hide loader and show text/dot when .status-loaded is added */
.status-item.status-loaded .infinity-loader {
  display: none;
}
.status-item.status-loaded .status-label {
  display: inline; /* Show the text */
}
.status-item.status-loaded .status-dot {
  display: block; /* Show the dot */
}

/* ... keep existing keyframes and remove old infinity-loader-anim ... */

/* NEW: Infinity Line Animation */
@keyframes infinity-line-left {
  0%, 100% {
    transform: translateX(0) rotate(0deg) scaleX(1);
  }
  25% {
    transform: translateX(4px) rotate(-45deg) scaleX(0.8);
  }
  50% {
    transform: translateX(8px) rotate(-90deg) scaleX(1);
  }
  75% {
    transform: translateX(4px) rotate(-135deg) scaleX(0.8);
  }
}

@keyframes infinity-line-right {
  0%, 100% {
    transform: translateX(0) rotate(0deg) scaleX(1);
  }
  25% {
    transform: translateX(-4px) rotate(45deg) scaleX(0.8);
  }
  50% {
    transform: translateX(-8px) rotate(90deg) scaleX(1);
  }
  75% {
    transform: translateX(-4px) rotate(135deg) scaleX(0.8);
  }
}

@keyframes pulse-green {
  0% { box-shadow: 0 0 5px rgba(40, 167, 69, 0.7); }
  50% { box-shadow: 0 0 12px rgba(40, 167, 69, 1); }
  100% { box-shadow: 0 0 5px rgba(40, 167, 69, 0.7); }
}

@keyframes pulse-red {
  0% { box-shadow: 0 0 5px rgba(220, 53, 69, 0.7); }
  50% { box-shadow: 0 0 12px rgba(220, 53, 69, 1); }
  100% { box-shadow: 0 0 5px rgba(220, 53, 69, 0.7); }
}


/* Responsive adjustment */
@media (max-width: 576px) {
  .calculator-section-modern {
    padding-top: 5rem; /* More space on mobile */
  }
  .server-status-indicator {
    top: -1.3rem;
    right: 0.75rem;
  }
  .lead {
  font-size: 1rem;
  font-weight: 300;
  }
}

    .lead {
  font-size: 1.09rem;
  font-weight: 300;
    }
    

    /* --- New Info Icon --- */
.status-info-icon {
  position: absolute;
  top: 0.5rem;
  left: 0.75rem; /* Positioned on the left */
  cursor: pointer;
  color: var(--muted);
  font-size: 0.9rem;
}
.status-info-icon:hover {
  color: var(--brand);
}

/* --- Wrapper for content swapping --- */
.status-content-wrapper {
  width: 35px; /* Fixed width to prevent jiggling */
  text-align: right;
  color: var(--text-light);
}
[data-theme="dark"] .status-content-wrapper {
  color: var(--muted);
}

/* --- New Infinity Loader (replaces dot loader) --- */
.infinity-loader {
  width: 28px; /* Slightly wider */
  height: 12px;
  position: relative;
  display: inline-block;
  margin-right: 7px; /* Aligns it similarly to the text */
}

.infinity-loader::before,
.infinity-loader::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background-color: #6c757d; /* Loading color */
  animation: infinity-spin 1.8s infinite ease-in-out;
}

.infinity-loader::after {
  left: auto;
  right: 0;
  animation-delay: -0.9s;
}

@keyframes infinity-spin {
  0%, 100% {
    transform: scale(0.8);
    opacity: 0.7;
  }
  50% {
    transform: scale(1);
    opacity: 1;
  }
}

/* --- Logic for showing/hiding content --- */

/* --- ADD THESE DEFAULT RULES --- */
.status-item .status-label {
  display: none;
}
.status-item .status-dot {
  display: none;
}
/* --- END OF ADDED RULES --- */

/* Hide loader and show text/dot when .status-loaded is added */
.status-item.status-loaded .infinity-loader {
Â  display: none;
}
.status-item.status-loaded .status-label {
Â  display: inline; /* Show the text */
}
.status-item.status-loaded .status-dot {
Â  display: block; /* Show the dot */
}
    
    

/* --- Popover Styling --- */
/* Make popover match the site theme */
.popover {
  border: 1px solid rgba(122, 106, 216, 0.2);
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.9);
}
.popover-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.1), rgba(122, 106, 216, 0.05));
  font-weight: 600;
  color: var(--text);
  border-bottom: 1px solid rgba(122, 106, 216, 0.2);
}
.popover-body {
  font-size: 0.85rem;
  color: var(--text-light);
}
.popover-body p {
  margin-bottom: 0.5rem;
}

/* Dark mode for popover */
[data-theme="dark"] .popover {
  background: rgba(26, 32, 48, 0.9);
}
[data-theme="dark"] .popover-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.3), rgba(122, 106, 216, 0.15));
  color: var(--text);
  border-bottom-color: rgba(45, 55, 72, 0.5);
}
[data-theme="dark"] .popover-body {
  color: var(--text-light);
}

    
a {
  color: var(--brand);
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s ease;
}

a:hover {
  color: var(--brand-600);
}

/* Loading spinner styles */
.loading {
  display: none;
  text-align: center;
  padding: 20px;
}

.loading p {
  margin-top: 10px;
}

/* Result container styles */
.result-container {
  display: none;
}

/* Toast notifications */
#toast-container {
  position: fixed;
  top: 65px;
  right: 10px;
  z-index: 9999;
  display: flex;
  flex-direction: column-reverse;
  gap: 10px;
}

.toast {
  background: white;
  border-radius: 12px;
  padding: 16px 20px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  display: flex;
  align-items: center;
  min-width: 300px;
  max-width: 400px;
  transform: translateX(100%);
  opacity: 0;
  transition: transform 0.3s ease, opacity 0.3s ease;
  position: relative;
  overflow: hidden;
  border-left: 4px solid var(--brand);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95);
}

.toast.show {
  transform: translateX(0);
  opacity: 1;
}

.toast-success {
  border-left-color: #10ac84;
}

.toast-error {
  border-left-color: #e74c3c;
}

.toast-warning {
  border-left-color: #f39c12;
}

.toast-info {
  border-left-color: #3498db;
}

.toast-content {
  display: flex;
  align-items: center;
  width: 100%;
}

.toast-icon {
  margin-right: 12px;
  font-size: 20px;
}

.toast-success .toast-icon {
  color: #10ac84;
}

.toast-error .toast-icon {
  color: #e74c3c;
}

.toast-warning .toast-icon {
  color: #f39c12;
}

.toast-info .toast-icon {
  color: #3498db;
}

.toast-message {
  flex: 1;
  font-weight: 500;
  font-size: 14px;
  color: #2d3748;
}

.toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  width: 100%;
  background: rgba(0, 0, 0, 0.1);
  transform: scaleX(1);
  transform-origin: left;
  animation: toastProgress 3s linear forwards;
}

.toast-success .toast-progress {
  background: linear-gradient(to right, #10ac84, #0d916b);
}

.toast-error .toast-progress {
  background: linear-gradient(to right, #e74c3c, #c0392b);
}

.toast-warning .toast-progress {
  background: linear-gradient(to right, #f39c12, #e67e22);
}

.toast-info .toast-progress {
  background: linear-gradient(to right, #3498db, #2980b9);
}

@keyframes toastProgress {
  from { transform: scaleX(1); }
  to { transform: scaleX(0); }
}

    /* Positions the new icon relative to the card */
.gpa-result-card {
  position: relative;
}

/* Styles the new copy icon */
.copy-icon-btn {
  position: absolute;
  top: 1.25rem;
  right: 1.25rem;
  font-size: 1.2rem;
  color: #10ac84; /* Green color */
  cursor: pointer;
  transition: all 0.2s ease;
}
.copy-icon-btn:hover {
  transform: scale(1.15);
}

/* GPA Result Display */
.gpa-result-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 2rem;
  margin-top: 2rem;
  width: 70%;
  margin-left: auto;
  margin-right: auto;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.gpa-result-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.semester-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 1.5rem;
  position: relative;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.semester-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-hover);
}

.delete-semester {
  position: absolute;
  top: 1rem;
  right: 1rem;
  cursor: pointer;
  color: #dc3545;
  font-size: 1.2rem;
  z-index: 10;
  transition: all 0.3s ease;
}

.delete-semester:hover {
  transform: scale(1.2);
}

.add-course-btn {
  position: absolute;
  top: 1rem;
  right: 3rem;
  cursor: pointer;
  color: var(--brand);
  font-size: 1.2rem;
  z-index: 10;
  transition: all 0.3s ease;
}

.add-course-btn:hover {
  transform: scale(1.2);
}

.course-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

.course-table th, .course-table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid rgba(229, 231, 235, 0.5);
}

.course-table th {
  font-weight: 600;
  color: var(--muted);
  background: rgba(122, 106, 216, 0.05);
}

.grade-badge {
  padding: 0.25rem 0.5rem;
  border-radius: 0.375rem;
  font-weight: 600;
  font-size: 0.75rem;
}

.grade-A { background-color: rgba(220, 252, 231, 0.7); color: #166534; }
.grade-B { background-color: rgba(219, 234, 254, 0.7); color: #1e40af; }
.grade-C { background-color: rgba(254, 243, 199, 0.7); color: #92400e; }
.grade-D { background-color: rgba(254, 226, 226, 0.7); color: #991b1b; }
.grade-F { background-color: rgba(243, 244, 246, 0.7); color: #374151; }

.extra-enrolled {
  background-color: rgba(255, 193, 7, 0.2);
  color: #856404;
  padding: 1px 5px;
  border-radius: 4px;
  font-size: 0.65rem;
  font-weight: 600;
  vertical-align: super;
}

.course-details-modal .modal-content {
  border-radius: var(--radius);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95);
}

.course-details-modal .modal-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
}

.calculate-cgpa-btn {
  margin-top: 1rem;
  display: none;
}

/* Add Course Form */
.add-course-form {
  background: rgba(248, 249, 250, 0.7);
  border-radius: 0.5rem;
  padding: 1.5rem;
  margin-top: 1rem;
  display: none;
  backdrop-filter: blur(10px);
}

.form-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1rem;
}

.form-group {
  flex: 1;
  min-width: 200px;
}

    /* Styling for the collapsible chart header */
#gpaChartChevron {
  transition: transform 0.3s ease-in-out;
}
a[aria-expanded="true"] #gpaChartChevron {
  transform: rotate(180deg);
}
/* FIX: This rule targets the text and icon inside collapsible headers like "GPA Trend" and "Status Log" */
[data-theme="dark"] .card-modern .card-header a[data-bs-toggle="collapse"] .text-body,
[data-theme="dark"] .card-modern .card-header a[data-bs-toggle="collapse"] .text-body i {
    color: var(--text) !important;
}


    /* NEW: Modern Calculator Section Styles */
.calculator-section-modern {
  padding: 3rem 1rem;
  backdrop-filter: blur(10px);
}


.search-and-profiles-container {
  max-width: 600px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.modern-search-wrapper {
  position: relative;
  width: 100%;
}

/* --- UPDATE: Professional Search Input --- */
.modern-search-input {
  border-radius: 50px !important;
  padding: 1rem 1.5rem;
  font-size: 1.1rem;
  box-shadow: var(--shadow);
  border: 2px solid transparent;
  /* Add padding to the right to make space for the button */
  padding-right: 170px !important;
}

.modern-search-input:focus {
  border-color: var(--brand);
  box-shadow: var(--shadow-hover);
}

/* --- UPDATE: Professional Search Button --- */
.modern-search-button {
  position: absolute;
  top: 50%;
  right: 6px; /* Space from edge */
  transform: translateY(-50%);
  border-radius: 50px; /* Match input pill shape */
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 1.25rem; /* Professional padding */
  transition: all 0.3s ease;
  height: calc(100% - 12px); /* Make button slightly smaller than input */
  line-height: 1; /* Ensure text/icon aligns well */
}

.modern-search-button:hover {
  transform: translateY(-50%) scale(1.02); /* Softer transform */
  box-shadow: var(--shadow-hover);
}

/* --- UPDATE: Mobile styles for Search Button/Input --- */
@media (max-width: 767.98px) {
  .modern-search-input {
    padding-right: 70px !important; /* Space for just the icon button */
  }
  .modern-search-button {
    width: 48px; /* Back to circle on mobile */
    height: 48px;
    padding: 0;
    right: 8px;
    border-radius: 50%; /* Back to circle */
  }
}


.modern-profiles-wrapper {
  width: 100%;
}

.modern-profiles-select {
  border-top-left-radius: 0 !important;
  border-bottom-left-radius: 0 !important;
  text-overflow: ellipsis; /* Add ellipsis for very long text */
  padding-right: 2.5rem;   /* Add padding to avoid overlap with arrow */
}

.modern-profiles-icon {
  border-top-left-radius: .85rem !important;
  border-bottom-left-radius: .85rem !important;
  background-color: rgba(122, 106, 216, 0.1);
  color: var(--brand);
}

.modern-delete-button {
    border-top-right-radius: .85rem !important;
    border-bottom-right-radius: .85rem !important;
}

/* ADD THIS CSS FOR THE ANNOUNCEMENT BAR */
.announcement-bar {
  background: var(--brand-gradient);
  color: white;
  padding: 0.75rem 0;
  overflow: hidden;
  white-space: nowrap;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.announcement-track {
  display: inline-block;
  animation: scroll-left 30s linear infinite;
}

.announcement-text {
  display: inline-block;
  font-weight: 500;
  margin: 0 2.5rem; /* Spacing between tips */
  opacity: 0.9;
}

@keyframes scroll-left {
  0% {
    transform: translateX(0%);
  }
  100% {
    transform: translateX(-50%); /* This value should be -50% because the content is duplicated */
  }
}
    @media (max-width: 576px) {
  .announcement-bar {
    padding: 0.25rem 0;
    font-size: 14px;
  }
}

/* Aligned Action Buttons */
.action-buttons-aligned {
  display: flex;
  /* UPDATED: This moves the buttons to the sides */
  justify-content: space-between;
  align-items: center;
  margin-top: 1.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}
/* --- UPDATE: Use var(--radius-btn) --- */
.action-buttons-aligned .btn {
  border-radius: var(--radius-btn);
}
@media (max-width: 576px) {
  .action-buttons-aligned {
    /* UPDATED: This moves the buttons to the sides */
  justify-content: space-between; 
  }
  .action-buttons-aligned .btn {
    /* UPDATED: Buttons will now be side-by-side */
    flex-grow: 0; /* Don't grow to fill space */
    min-width: auto; /* Remove minimum width */
    font-size: 0.8rem; /* Make text smaller */
    padding: 0.6rem 0.8rem; /* Reduce padding */
  }
}

/* Collapsible Status Log Icon */
.status-log-chevron {
  transition: transform 0.3s ease-in-out;
}
a[aria-expanded="true"] .status-log-chevron {
  transform: rotate(180deg);
}


#openProfileManagerBtn {
    border-top-right-radius: .85rem !important;
    border-bottom-right-radius: .85rem !important;
}

    /* ADD THIS CSS FOR THE PREMIUM CGPA DISPLAY */
.gpa-result-card-premium {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 2rem;
  margin-top: 2rem;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.2);
}
[data-theme="dark"] .gpa-result-card-premium {
  background: rgba(26, 32, 48, 0.8);
}
.gpa-result-card-premium:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.student-info-header {
  text-align: center;
  margin-bottom: 2rem;
  border-bottom: 1px solid rgba(122, 106, 216, 0.2);
  padding-bottom: 1.5rem;
}
.student-info-header h2 {
  font-size: 1.5rem;
}

.cgpa-dashboard {
  display: flex;
  justify-content: center;
  margin-bottom: 2rem;
}

.cgpa-progress-circle {
  width: 180px;
  height: 180px;
  position: relative;
}
.cgpa-progress-circle svg {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}
.cgpa-progress-circle .circle-bg {
  fill: none;
  stroke: rgba(122, 106, 216, 0.15);
  stroke-width: 3.8;
}
[data-theme="dark"] .cgpa-progress-circle .circle-bg {
    stroke: rgba(122, 106, 216, 0.2);
}
.cgpa-progress-circle .circle {
  fill: none;
  stroke: var(--brand);
  stroke-width: 3.8;
  stroke-linecap: round;
  transition: stroke-dasharray 1s ease-in-out;
}

.cgpa-progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}
.cgpa-progress-text .cgpa-value {
  font-size: 2rem;
  font-weight: 700;
  line-height: 1;
  color: var(--brand);
  background: var(--brand-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.cgpa-progress-text .cgpa-label {
  display: block;
  font-size: 1rem;
  font-weight: 500;
  color: var(--muted);
  margin-top: 0.25rem;
}

.secondary-stats {
  display: flex;
  justify-content: center;
  gap: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(122, 106, 216, 0.2);
}
.stat-item {
  text-align: center;
}
.stat-label {
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--muted);
  display: block;
  margin-bottom: 0.5rem;
}
.stat-value {
  font-size: 1.75rem;
  font-weight: 600;
  color: var(--text);
}
[data-theme="dark"] .stat-value {
    color: #e5e7eb;
}
.stat-sub-value {
    font-size: 1rem;
    color: var(--muted);
}
.stat-divider {
  width: 1px;
  background: rgba(122, 106, 216, 0.2);
}

@media (max-width: 576px) {
  .gpa-result-card-premium {
    padding: 1.5rem;
  }
  .cgpa-progress-circle {
    width: 150px;
    height: 150px;
  }
  .cgpa-progress-text .cgpa-value {
    font-size: 1.70rem;
  }
  .secondary-stats {
    gap: 1rem;
  }
  .stat-value {
    font-size: 1.25rem;
  }
}


/* ----------- DARK MODE IMPROVED ----------- */
[data-theme="dark"] {
  --text: #e5e7eb;
  --text-light: #d1d5db;
  --muted: #9ca3af;
}
    /* NEW: Fix for various text-muted elements in dark mode */
[data-theme="dark"] .text-muted {
  color: var(--muted) !important;
}

[data-theme="dark"] body {
  background: linear-gradient(180deg, #0b0e13 0%, #0f1320 70%);
  color: #f1f5f9;
}

[data-theme="dark"] .navbar {
  background-color: rgba(8, 48, 136, 0.35);
}

[data-theme="dark"] .navbar .nav-link {
  color: #d1d5db;
}

[data-theme="dark"] .navbar .nav-link:hover {
  color: #fff;
}

[data-theme="dark"] .card-modern {
  background: rgba(15, 29, 64, 0.8);
  color: #e5e7eb;
}

[data-theme="dark"] .card-modern .card-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.3), rgba(122, 106, 216, 0.15));
}

[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4, [data-theme="dark"] h5 {
  color: #ffffff;
}

[data-theme="dark"] .lead {
  color: #9ca3af;
}

/* --- UPDATE: Make subtitle visible in dark mode --- */
[data-theme="dark"] .calculator-section-modern .text-muted {
    color: var(--text-light) !important;
}

[data-theme="dark"] .subject-row {
  background: rgba(26, 31, 46, 0.8);
  border-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] label {
  color: #e5e7eb;
}

[data-theme="dark"] .form-control, [data-theme="dark"] .form-select {
  background: rgba(11, 16, 32, 0.8);
  color: #f1f5f9;
  border-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] .form-control::placeholder {
  color: #9ca3af;
}

[data-theme="dark"] .form-text {
  color: var(--muted);
}

[data-theme="dark"] .input-group-text {
  background: rgba(31, 41, 55, 0.8);
  color: #e5e7eb;
}

[data-theme="dark"] a {
  color: rgb(158, 141, 240);
}

[data-theme="dark"] a:hover {
  color: #9f8df0;
}

[data-theme="dark"] .status-log {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .status-line {
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .gpa-result-card {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .semester-card {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .course-table th,
[data-theme="dark"] .course-table td {
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .course-table th {
  background: rgba(122, 106, 216, 0.1);
}

[data-theme="dark"] .add-course-form {
  background: rgba(26, 31, 46, 0.8);
}

[data-theme="dark"] .loading-container {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.15), rgba(122, 106, 216, 0.08));
}

[data-theme="dark"] .grade-A { background-color: rgba(21, 128, 61, 0.3); color: #86efac; }
[data-theme="dark"] .grade-B { background-color: rgba(30, 64, 175, 0.3); color: #93c5fd; }
[data-theme="dark"] .grade-C { background-color: rgba(146, 64, 14, 0.3); color: #fed7aa; }
[data-theme="dark"] .grade-D { background-color: rgba(153, 27, 27, 0.3); color: #fecaca; }
[data-theme="dark"] .grade-F { background-color: rgba(55, 65, 81, 0.3); color: #d1d5db; }

/* Dark mode for modals */
[data-theme="dark"] .modal-content {
    background: rgba(26, 32, 48, 0.95);
    color: #e5e7eb;
}
[data-theme="dark"] .modal-header {
    background: linear-gradient(135deg, rgba(122, 106, 216, 0.3), rgba(122, 106, 216, 0.15));
    border-bottom-color: rgba(45, 55, 72, 0.5);
}
[data-theme="dark"] .modal-header .btn-close {
    filter: invert(1);
}
[data-theme="dark"] .alert-info {
  background-color: rgba(23, 162, 184, 0.2);
  border-color: rgba(23, 162, 184, 0.3);
  color: #71d4f0;
}
[data-theme="dark"] .alert-warning {
  background-color: rgba(255, 193, 7, 0.2);
  border-color: rgba(255, 193, 7, 0.3);
  color: #ffd351;
}

/* Dark mode contrast improvements */
[data-theme="dark"] .text-body-secondary {
  color: #d1d5db !important;
}

[data-theme="dark"] .btn-primary-action {
  color: #ffffff !important;
}

.cursor-dot {
  position: fixed;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--brand);
  pointer-events: none;
  transform: translate(-50%, -50%);
  opacity: .7;
  mix-blend-mode: multiply;
  z-index: 9999;
  transition: all 0.1s ease;
}

[data-theme="dark"] .cursor-dot {
  mix-blend-mode: screen;
}

/* Course action buttons */
.course-actions i {
  cursor: pointer;
  font-size: 14px;
  padding: 4px;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.delete-course {
  color: #dc3545;
}

.delete-course:hover {
  background-color: rgba(220, 53, 69, 0.1);
  transform: scale(1.2);
}

.restore-course {
  color: #10ac84;
}

.restore-course:hover {
  background-color: rgba(16, 172, 132, 0.1);
  transform: scale(1.2);
}

/* Clickable info icon */
.clickable-info {
  cursor: pointer;
  color: var(--brand);
  transition: all 0.3s ease;
}

.clickable-info:hover {
  opacity: 0.8;
  transform: scale(1.1);
}


/* Restore the original horizontal margin for the icon */
.course-code-container .fa-info-circle {
    margin-left: 0.3rem !important;
}

/* --- Mobile responsive adjustments --- */
@media (max-width: 575.98px) {
  .hero {
    padding: 2rem 0;
  }
  .hero h1 {
    font-size: 2.2rem !important;
  }
  /* --- UPDATE: Removed width: 100% --- */
  .d-flex.gap-2 .btn {
    max-width: 300px;
    margin-bottom: 0.5rem;
  }
  .toast {
    min-width: 250px;
    max-width: 300px;
    padding: 12px 16px;
  }
  .toast-message {
    font-size: 0.75rem;
  }
  .card-modern .card-header {
    padding: 1rem 1.25rem;
  }
  #themeToggle {
    font-size: 0.8rem; /* Adjust the font size to make the icon smaller */
    padding: 0.3rem 0.6rem; /* Adjust padding to make the button smaller */
  }
}

/* Ensure subject columns are 2-up on very small screens: change from col-12 col-md-6 -> col-6 col-md-6 */
@media (max-width: 420px) {
  .subject-row .col-6 {
    padding-right: .4rem;
    padding-left: .4rem;
  }
}

/* UPDATED: Narrow calculator container on desktop */
@media (min-width: 992px) {
  #Auto-Calculator .col-md-10 {
    width: 100%;
  }
}

@media (min-width: 992px) {
  .navbar-expand-lg .navbar-nav .nav-link {
    padding-right: var(--bs-navbar-nav-link-padding-x);
    margin-right: 20px;
  }
}

@media (min-width: 992px) {
  .offset-lg-1 {
    margin-left: 5%;
  }
}

@media (min-width: 768px) {
  .col-md-10 {
    flex: 0 0 auto;
    width: 100%;
  }
}

@media (min-width: 768px) {
  #how-it-works .col-md-4 {
    flex: 0 0 auto;
    width: 50%;
  }
}
    
    
@media (min-width: 768px) {
  .col-md-7 {
    flex: 0 0 auto;
    width: 20%;
  }
}

/* --- Mobile responsive table --- */
@media screen and (max-width: 768px) {
  body {
    font-size: 0.9rem;
  }
  .gpa-result-card {
    width: 95%;
    padding: 1.25rem;
  }
  .course-code-container .fa-info-circle {
    display: none;
  }
  .semester-card {
    padding: 1.25rem;
    max-width: 560px;
  }
  .semester-card h5 {
    font-size: 0.9rem;
  }
  .semester-card .text-end .small {
    font-size: 0.65rem;
  }
  .custom-course-btn {
    padding: 4px 8px;
    font-size: 0.7rem;
    margin-top: 5px;
  }
  .course-table {
    font-size: 0.65rem;
  }
  /* Reduce padding to decrease gaps between columns */
  .course-table th, .course-table td {
    padding: 0.75rem 0.4rem; /* Reduced horizontal padding */
  }
  .course-table td:first-child {
    font-size: 0.7rem;
    font-weight: 500;
  }
  /* Make grade text smaller */
  .grade-badge {
    font-size: 0.6rem;
    padding: 0.2rem 0.35rem;
  }
  .btn {
    padding: 0.6rem 0.9rem;
    font-size: 0.9rem;
  }
  .loading-animation {
    width: 50px;
    height: 50px;
  }
  .loading-text {
    font-size: 0.9rem;
  }
  .loading-subtext {
    font-size: 0.75rem;
  }
  .cgpa-main-info h2 {
    font-size: 1.3rem;
  }
  .cgpa-metric-value {
    font-size: 1.35rem;
  }
  .action-buttons .btn {
    font-size: 0.75rem;
    padding: 0.6rem 0.4rem;
  }
  /* Table alignment rules */
  .course-table th:nth-child(n+3),
  .course-table td:nth-child(n+3) {
      text-align: center;
  }
  .course-table th:nth-child(1), .course-table td:nth-child(1),
  .course-table th:nth-child(2), .course-table td:nth-child(2) {
      text-align: left;
  }
}

/* Center buttons only in specific sections */
.scraping-section .center-buttons,
.log-section .center-buttons {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.5rem;
}

@media (max-width: 576px) {
  .scraping-section .center-buttons,
  .log-section .center-buttons {
    flex-direction: column;
    align-items: center;
  }

  .scraping-section .center-buttons .btn,
  .log-section .center-buttons .btn {
    width: auto;
    min-width: 180px;
  }
}

/* New layout improvements */
.results-section {
  margin-top: 2rem;
}

.student-info-section {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.student-details {
  flex: 1;
  min-width: 300px;
}

.cgpa-display {
  flex: 0 0 auto;
  text-align: right;
  min-width: 200px;
}

.action-buttons {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  justify-content: center;
}

@media (max-width: 768px) {
  .student-info-section {
    flex-direction: column;
    gap: 1rem;
  }

  .cgpa-display {
    text-align: left;
    margin-top: 1rem;
  }

  .action-buttons {
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
  }

  .action-buttons .btn {
    flex-grow: 1;
    margin: 0 0.25rem;
    min-width: auto;
  }
}

/* Section separators */
.section-container {
  margin-bottom: 2rem;
}

.section-title {
  margin-bottom: 1.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid rgba(122, 106, 216, 0.3);
  position: relative;
}

.section-title::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 60px;
  height: 2px;
  background: var(--brand-gradient);
}

/* Student info logo style */
.student-info-logo {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  transition: all 0.3s ease;
}

.student-info-logo:hover {
  transform: rotate(15deg);
}

.student-info-logo i {
  font-size: 1.5rem;
  color: var(--brand);
}

/* Desktop-specific smaller text for semester sections */
@media (min-width: 992px) {
  .semester-card {
    font-size: 0.95rem;
  }

  .semester-card h5 {
    font-size: 1.15rem;
  }

  .course-table {
    font-size: 0.9rem;
  }
}

/* Semester section layout improvements */
.semester-results-container {
  width: 100%;
}

.semester-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
  width: 100%;
}

@media (min-width: 992px) {
  .semester-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* NEW STYLES FOR UPDATES */
.repeated-badge {
  position: absolute;
  top: 5px;
  right: 5px;
  background-color: #ffc107;
  color: #856404;
  font-size: 8px;
  padding: 2px 4px;
  border-radius: 3px;
  font-weight: bold;
}

/* --- UPDATE: Use var(--radius-btn) --- */
.custom-course-btn {
  background: var(--brand-gradient);
  color: white;
  border: none;
  border-radius: var(--radius-btn);
  padding: 8px 12px;
  font-size: 0.9rem;
  margin-top: 10px;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.custom-course-btn:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-2px);
}

.undo-notification {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(51, 51, 51, 0.9);
  color: white;
  padding: 12px 20px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 10000;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(10px);
  width: calc(100% - 40px);
  max-width: 400px;
  justify-content: space-between;
}

.undo-btn {
  background: var(--brand-gradient);
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.undo-btn:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-1px);
}
@media (max-width: 576px) {
  .undo-notification {
    bottom: 70px; /* Raise it above mobile browser UI */
    padding: 10px 15px;
    font-size: 0.9rem;
    flex-direction: column;
    gap: 8px;
    text-align: center;
  }
  .undo-btn {
    width: 100%;
    padding: 6px 10px;
  }
}


/* Updated CGPA Display Layout */
.cgpa-display-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.5rem;
}

.cgpa-main-info {
  text-align: center;
  width: 100%;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(122, 106, 216, 0.3);
}

.cgpa-metrics-row {
  display: flex;
  justify-content: space-between;
  width: 100%;
  gap: 1rem;
}

.cgpa-metric {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
}

.cgpa-metric-left {
  align-items: flex-start;
}

.cgpa-metric-center {
  align-items: center;
}

.cgpa-metric-right {
  align-items: flex-end;
}

.cgpa-metric-label {
  font-size: 1rem;
  font-weight: 600;
  color: var(--muted);
  margin-bottom: 0.5rem;
}

.cgpa-metric-value {
  font-size: 1.75rem;
  font-weight: 650;
  color: var(--brand);
  line-height: 1.2;
  background: var(--brand-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.cgpa-metric-subvalue {
  font-size: 0.9rem;
  color: var(--muted);
}

/* --- Mobile responsive adjustments for CGPA --- */
@media (max-width: 768px) {
  .cgpa-metrics-row {
    flex-direction: column;
    gap: 1.5rem;
  }

  .cgpa-metric {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(122, 106, 216, 0.1);
  }

  .cgpa-metric:last-child {
    border-bottom: none;
  }

  .cgpa-metric-left,
  .cgpa-metric-center,
  .cgpa-metric-right {
    align-items: center;
  }

  .cgpa-metric-label {
    margin-bottom: 0;
    min-width: 100px;
    text-align: left;
  }

  .cgpa-metric-value-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }

  .semester-grid {
    display: block;
  }
}

/* Contact form improvements */
#contact-form {
  background: rgba(255, 255, 255, 0.5);
  padding: 2rem;
  border-radius: var(--radius);
  backdrop-filter: blur(10px);
}

[data-theme="dark"] #contact-form {
  background: rgba(26, 32, 48, 0.5);
}

/* Animation for form elements */
.form-control, .form-select {
  transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
  transform: translateY(-2px);
}

/* Pulse animation for important elements */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.pulse {
  animation: pulse 2s infinite;
}

/* Floating animation */
@keyframes float {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}

.float {
  animation: float 3s ease-in-out infinite;
}

/* Improved scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(122, 106, 216, 0.1);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--brand);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--brand-600);
}

[data-theme="dark"] ::-webkit-scrollbar-track {
  background: rgba(122, 106, 216, 0.2);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb {
  background: var(--brand-600);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
  background: var(--brand);
}

/* NEW STYLES FOR ADDED FEATURES */

/* Back to Top Button */
#backToTop {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--brand-gradient);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(122, 106, 216, 0.3);
  z-index: 1000;
}

#backToTop.visible {
  opacity: 1;
  visibility: visible;
}

#backToTop:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(122, 106, 216, 0.4);
}

/* Gradient Text Animation */
.gradient-text {
  background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--accent), var(--brand-primary));
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-text 3s ease infinite;
}

@keyframes gradient-text {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Why Choose Section */
.why-choose-section {
  padding: 5rem 0;
}

.why-choose-section .text-center {
  margin-bottom: 4rem;
}

.why-choose-section h2 {
  font-weight: 800;
  margin-bottom: 1rem;
}

.why-choose-section .lead {
  color: var(--text-light);
  font-size: 1.25rem;
}

.feature-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  height: 100%;
  text-align: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow);
}

.feature-card:hover {
  transform: translateY(-10px);
  box-shadow: var(--shadow-hover);
}

.feature-icon {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 1.5rem;
  background: var(--brand-gradient);
  color: white;
  font-size: 1.5rem;
  transition: all 0.3s ease;
}

.feature-card:hover .feature-icon {
  transform: scale(1.1) rotate(5deg);
}

.feature-card h5 {
  font-weight: 700;
  margin-bottom: 1rem;
  color: var(--text);
}

.feature-card p {
  color: var(--text-light);
}

/* Dark mode for Why Choose section */
[data-theme="dark"] .why-choose-section {
  background: transparent; /* Inherit from body gradient */
}

[data-theme="dark"] .feature-card {
  background: rgba(15, 20, 34, 0.8);
}

[data-theme="dark"] .feature-card h5 {
  color: #ffffff;
}

[data-theme="dark"] .feature-card p.text-muted {
    color: var(--muted) !important;
}
[data-theme="dark"] .why-choose-section .lead.text-muted {
    color: var(--text-light) !important;
}


/* Hide Why Choose section on mobile */
@media (max-width: 991.98px) {
  .why-choose-section {
    display: none;
  }
}


    /* --- NEW: Creative Action Hub --- */

/* 1. The Pill Navigation Container */
/* This sits on the main page background (var(--light-bg)) */
.action-hub-nav-pills {
  display: flex;
  background-color: rgba(122, 106, 216, 0.08); /* Faint background for the "track" */
  border-radius: 99px; /* Perfect pill shape */
  padding: 0.35rem; /* Space for the active pill to move */
  position: relative;
}

[data-theme="dark"] .action-hub-nav-pills {
  background-color: rgba(122, 106, 216, 0.2); /* Dark mode track */
}

/* 2. The Pill Buttons (Active & Inactive) */
.action-hub-nav-pills .nav-link {
  flex: 1; /* Each button takes 50% space */
  display: flex;
  align-items: center;
  justify-content: center;
  
  border: none;
  border-radius: 99px; /* Pill shape for all buttons */
  
  color: var(--muted); /* Inactive text color */
  font-weight: 600;
  font-size: 1.0rem;
  padding: 0.75rem 1rem;
  
  transition: all 0.3s ease-in-out; /* Smooth transitions */
  
  /* Remove bootstrap defaults */
  background: none; 
}

/* 3. The ACTIVE Pill Button */
.action-hub-nav-pills .nav-link.active {
  color: #ffffff; /* White text on the gradient */
  background: var(--brand-gradient); /* Your site's brand gradient! */
  box-shadow: 0 6px 18px rgba(122, 106, 216, 0.3); /* Softer shadow */
  transform: scale(1.02); /* Slight "pop" effect */
}

/* 4. The Content Wrapper Below */
/* This is the new "container" that replaces the awkward card */
.action-hub-content-wrapper {
  margin-top: -1rem; /* Space from the pill toggle */
  
  /* Use your site's card background colors */
  /* background: rgb(248, 249, 255); background color */
  border-radius: var(--radius); /* Use your site's border radius */
  /* box-shadow: var(--shadow); Use your site's shadow */
  
  /* Use backdrop-filter if you used it for card-modern */
  backdrop-filter: blur(10px); 
  /* background: rgba(255, 255, 255, 0.8); background color */

  padding: 2rem;
  transition: all 0.3s ease;
  margin-bottom: -20px;
}

[data-theme="dark"] .action-hub-content-wrapper {
  /* background: rgba(15, 29, 64, 0.8);  Dark card background */
}

/* 5. Styles for the Backup/Import buttons */
.profile-data-buttons-new {
  display: flex;
  justify-content: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.profile-data-buttons-new .btn {
  font-size: 0.9rem;
  padding: 0.6rem 1.2rem;
  border-radius: var(--radius-btn);
  flex-grow: 1;
  min-width: 170px;
  max-width: 260px;
}

/* 6. Responsive Styles */
@media (max-width: 575.98px) {
  .action-hub-nav-pills .nav-link {
    font-size: 0.95rem; /* Slightly smaller text */
    padding: 0.6rem 0.5rem;
  }
  
  /* Make content padding smaller on mobile */
  .action-hub-content-wrapper {
    padding: 1.5rem;
  }
  
  /* Make backup buttons smaller */
  .profile-data-buttons-new .btn {
    font-size: 0.85rem;
    padding: 0.6rem 1rem;
    min-width: 150px;
  }

  .modern-search-input {
    padding: 0.9rem 1.4rem;
    font-size: 1rem;
  }
  
}
    


    /* --- NEW: B.Ed. Tab Styles --- */
#bedTab {
  border-bottom: 3px solid rgba(122, 106, 216, 0.2);
  margin-bottom: 1.5rem;
}

#bedTab .nav-link {
  font-weight: 600;
  font-size: 1.1rem;
  color: var(--muted);
  border: none;
  border-bottom: 3px solid transparent;
  padding-bottom: 1rem;
  transition: all 0.3s ease;
}

#bedTab .nav-link.active {
  color: var(--brand);
  border-bottom-color: var(--brand);
  background-color: transparent;
}

#bedTab .nav-link:hover:not(.active) {
  color: var(--text);
  border-bottom-color: rgba(122, 106, 216, 0.5);
}

[data-theme="dark"] #bedTab {
  border-bottom-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] #bedTab .nav-link.active {
  color: #fff;
}

/* NEW: Added this media query for small screens */
@media (max-width: 420px) {
  #bedTab .nav-link {
    font-size: 0.9rem; /* Make font smaller */
    padding-left: 0.4rem; /* Reduce horizontal padding */
    padding-right: 0.4rem;
  }
  #bedTab .nav-link i {
    margin-right: 0.2rem !important; /* Reduce icon spacing */
  }
}
/* --- End of B.Ed. Tab Styles --- */
    
    

/* Animation for hero text */
.hero-text-gradient {
  background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--accent), var(--brand-primary));
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-text 3s ease infinite;
}


/* Animation for robot icon */
.robot-icon-gradient {
  background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--accent), var(--brand-primary));
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-text 3s ease infinite;
}

/* PDF Download Button */
.btn-pdf-download {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  border: 0;
  box-shadow: 0 6px 18px rgba(231, 76, 60, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
  border-radius: var(--radius-btn); /* Consistent radius */
}

.btn-pdf-download:hover {
  background: linear-gradient(135deg, #ff6b6b 0%, #e74c3c 100%);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(231, 76, 60, 0.3);
}

/* Action buttons container */
.action-buttons {
  display: flex;
  justify-content: center; /* Center the single button */
  align-items: center;
  margin-top: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}

/* Center Registration Number Input */
.scraping-section .mb-3 {
    text-align: center;
}
.scraping-section #registrationNumber {
    max-width: 350px;
    margin: 0 auto;
    text-align: center;
}

/* Drag and Drop Styles (Desktop Only) */
@media (min-width: 992px) {
  .course-table tbody tr {
    cursor: grab;
  }
  .course-table tbody tr.dragging {
    opacity: 0.5;
    background: #e9e6f8;
  }
  .semester-card.drag-over {
    border: 2px dashed var(--brand);
    transform: scale(1.02);
    background-color: rgba(122, 106, 216, 0.1);
  }
  [data-theme="dark"] .semester-card.drag-over {
    background-color: rgba(122, 106, 216, 0.2);
  }
}

/* NEW: Scroll Animation Styles */
.fade-in-on-scroll {
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}
.fade-in-on-scroll.is-visible {
  opacity: 1;
  transform: translateY(0);
}

/* NEW: Forecast/Info Button Style */
.btn-info-action {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
  border-radius: var(--radius-btn); /* Consistent radius */
}
.btn-info-action:hover {
  background: linear-gradient(135deg, #5dade2 0%, #3498db 100%);
  color: white;
  transform: translateY(-2px);
}

/* NEW: Profile Manager Styles */
.profile-manager-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(122, 106, 216, 0.2);
    margin-bottom: 1rem;
}
.profile-manager-stats {
    font-size: 0.85rem;
    color: var(--muted);
}
.profile-manager-toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    align-items: center;
    margin-bottom: 1rem;
}
.profile-list {
    list-style: none;
    padding: 0;
    max-height: 50vh;
    overflow-y: auto;
}
.profile-item {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    border-radius: 0.75rem;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid rgba(122, 106, 216, 0.1);
    position: relative;
    background-color: rgba(98, 71, 255, 0.02);
    margin-bottom: 10px;
}
.profile-item:last-child {
    border-bottom: none;
}
.profile-item:hover {
    background-color: rgba(122, 106, 216, 0.05);
}
[data-theme="dark"] .profile-item:hover {
    background-color: rgba(122, 106, 216, 0.1);
}
.profile-item .form-check-input {
    margin-top: 0;
    transform: scale(1.2);
}
.profile-item-details {
    flex-grow: 1;
    margin-left: 1rem;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0 1rem;
}
.profile-item-name {
    grid-column: 1 / -1;
    font-weight: 600;
    color: var(--text);
}
.profile-item-meta {
    font-size: 0.8rem;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 0.3rem;
}
.profile-item-actions {
    display: flex;
    gap: 0.5rem;
}
.profile-item-actions .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.8rem;
}

/* Custom Confirmation Modal */
.confirmation-modal .modal-content {
    border-radius: var(--radius);
}
.confirmation-modal .modal-header {
    border-bottom: none;
}
.confirmation-modal .modal-body {
    text-align: center;
}
.confirmation-modal .modal-body .fa-triangle-exclamation {
    font-size: 2.5rem;
    color: #f39c12;
}
.confirmation-modal .modal-footer {
    border-top: none;
    justify-content: center;
}

/* Mobile adjustments for Profile Manager */
@media (max-width: 767.98px) {
    .profile-manager-toolbar {
        flex-direction: row; /* Keep in a row */
        justify-content: space-between; /* Space out items */
        align-items: center; /* Align vertically */
    }
    .profile-manager-toolbar .ms-auto {
        margin-left: 0 !important; /* Remove margin */
        width: auto; /* Allow natural width */
        margin-top: 0; /* Remove top margin */
        display: flex;
        gap: 0.5rem; /* Reduce gap */
    }
    /* --- UPDATE: Removed padding override --- */
    .profile-manager-toolbar .btn {
        font-size: 0.8rem;
        /* Removed padding rule */
    }

    .profile-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }
    .profile-item .form-check-input {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
    }
    .profile-item-details {
        margin-left: 0;
        grid-template-columns: 1fr; /* Stack details vertically */
        gap: 0.25rem;
    }
    .profile-item-actions {
        width: 100%;
        justify-content: space-around;
        border-top: 1px solid rgba(122, 106, 216, 0.1);
        padding-top: 0.75rem;
    }
}

/* --- NEW & UNIFIED: Image Lightbox Styles (All Devices) --- */

.zoomable-image-container {
  position: relative;
  overflow: hidden; /* Contain elements */
  border-radius: 0.75rem; /* Match card style */
  display: block; /* Ensure it behaves like a block */
  line-height: 0; /* Prevent extra space below image */
  cursor: pointer; /* Indicate clickability */
}

.zoomable-image-container img#qpTableImage {
  display: block; /* Ensure image behaves predictably */
  width: 100%;   /* Make image fill container width */
  height: auto;  /* Maintain aspect ratio */
  max-width: 100%; /* Ensure it doesn't overflow container */
  border-radius: 0.75rem; /* Match container */
}

/* Hide desktop-specific elements if they exist (cleanup) */
.zoom-loupe, .zoom-box { display: none !important; }

/* "Click to zoom" icon (Applies to all devices now) */
.zoomable-image-container::after {
  content: '\f00e'; /* FontAwesome zoom-in icon */
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0,0,0,0.5);
  color: white;
  padding: 8px 10px;
  border-radius: 5px;
  font-size: 1.1rem;
  z-index: 5;
  pointer-events: none; /* Don't block the click */
  opacity: 0.8;
  transition: opacity 0.2s ease;
}
.zoomable-image-container:hover::after {
    opacity: 1;
}

/* --- Lightbox Styles --- */

/* Background */
.image-lightbox {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(5px);
  z-index: 1070;
  display: none; /* Changed from flex to none */
  opacity: 0;
  transition: opacity 0.3s ease;
  overflow: hidden; /* Prevent body scroll */
}
.image-lightbox.show {
  display: flex; /* Use flex to center when shown */
  align-items: center;
  justify-content: center;
  opacity: 1;
}

/* Content area (holds the image) */
.lightbox-content {
  width: 100%;
  height: 100%;
  position: relative; /* Crucial for image positioning */
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden; /* Container doesn't scroll/pan */
}

/* Image inside lightbox */
.lightbox-content img#lightboxImage {
  display: block;
  /* Start unzoomed */
  max-width: 95%;
  max-height: 95%;
  width: auto;
  height: auto;
  object-fit: contain;
  border-radius: 5px;
  cursor: grab; /* Default cursor inside */
  /* Transitions and touch actions */
  transition: transform 0.15s ease-out; /* Smooth transforms */
  touch-action: none; /* Essential for custom touch handling */
  user-select: none;
  -webkit-user-drag: none;
  transform-origin: center center; /* Default origin */
}

/* Style for when desktop hover-zoom is active */
.lightbox-content.desktop-zoom-active img#lightboxImage {
    cursor: crosshair; /* Indicate zoom region */
    /* Set transform origin dynamically via JS */
}

/* Close Button */
.lightbox-close-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  border: none;
  font-size: 1.5rem;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  z-index: 1071;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}
.lightbox-close-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: rotate(90deg);
}



    /* --- NEW: Premium About Developer Section --- */
#about-developer-premium {
  padding: 5rem 0;
}
    

    

/* --- Z-index and Blur for modals --- */
#renameProfileModal, #confirmationModal, #attendanceImportModal {
  z-index: 1060; /* Higher z-index to appear on top */
}
/* When rename or confirm modal is open, apply blur to profile manager */
#profileManagerModal.blur-backdrop {
  filter: blur(4px);
  transition: filter 0.15s linear;
}

/* --- Profile data buttons --- */
.profile-data-buttons {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
}
/* --- UPDATE: Use var(--radius-btn) --- */
.profile-data-buttons .btn {
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    border-radius: var(--radius-btn);
}
/* --- Mobile styles for Import/Export buttons --- */
@media (max-width: 575.98px) {
    .profile-data-buttons {
        flex-direction: row; /* Keep in row */
        gap: 0.5rem; /* Reduce gap */
        justify-content: center; /* Center horizontally */
    }
    .profile-data-buttons .btn {
        width: auto; /* Allow natural width */
        max-width: none;
        font-size: 0.8rem; /* Slightly smaller */
        padding: 0.5rem 0.8rem; /* Adjust padding */
        flex-grow: 0; /* Allow buttons to grow equally */
        max-width: 50%; /* Limit width to half */
    }

  /* NEW: Styles for Attendance Import Modal */
.attendance-course-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem;
  border-bottom: 1px solid rgba(122, 106, 216, 0.1);
}
.attendance-course-item:last-child {
  border-bottom: none;
}
.attendance-course-item .form-check {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
.attendance-course-item .form-check-label {
  line-height: 1.3;
}
.attendance-course-item .form-check-label small {
  font-size: 0.8rem;
}
.attendance-course-item .import-ch-select {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.attendance-course-item .import-ch-select .form-select {
  width: 80px;
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
  font-size: 0.9rem;
}
  
}


@media (max-width: 576px) {
  .attendance-course-item {
    /* flex-direction: column; <-- REMOVED */
    align-items: center; /* Vertically align items in the row */
    gap: 0.5rem; /* Reduced gap */
    justify-content: space-between; /* Space out checkbox/info and CH selector */
  }
  .attendance-course-item .form-check {
     flex-grow: 1; /* Allow checkbox and text to take available space */
     margin-right: 0.5rem; /* Add some space before CH selector */
  }
  .attendance-course-item .import-ch-select {
    width: auto; /* Let it shrink to content */
    flex-shrink: 0; /* Prevent it from shrinking too much */
    /* justify-content: flex-end; <-- REMOVED (space-between on parent handles it) */
  }
   .attendance-course-item .import-ch-select .form-select {
       width: 65px; /* Slightly smaller width for mobile select */
   }
}
    /* Fix for Dark Mode Text Visibility (Request 6) */
[data-theme="dark"] #faq .lead.text-muted {
    color: var(--text-light) !important;
}

[data-theme="dark"] #attendanceImportModal .text-muted {
    color: var(--text-light) !important;
}



    /* --- About Section Dark Mode Overrides --- */
[data-theme="dark"] .about-sidebar {
    background-color: rgba(0, 0, 0, 0.2) !important; /* Darker sidebar */
    border-right-color: rgba(255, 255, 255, 0.1) !important; /* Subtle border */
}
[data-theme="dark"] .about-feature-box {
    background-color: rgba(255, 255, 255, 0.05) !important; /* Glassy look */
    border-color: rgba(255, 255, 255, 0.1) !important;
}
[data-theme="dark"] .about-quote-box {
    background-color: rgba(255, 255, 255, 0.05) !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
    color: var(--text-light);
}
/* Ensure icons stay white in dark mode if needed, though text-white handles it */
.feature-icon.text-white {
    color: #ffffff !important;
}


    /* --- Premium Calculator Section Styles --- */
.calculator-card {
    border: 1px solid rgba(255, 255, 255, 0.6);
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
    border-radius: 24px;
    overflow: hidden;
    transition: transform 0.3s ease;
}
[data-theme="dark"] .calculator-card {
    background: rgba(30, 35, 50, 0.7);
    border-color: rgba(255, 255, 255, 0.05);
}

/* Segmented Control Tabs */
.calc-nav-pills {
    background: rgba(0, 0, 0, 0.04);
    border-radius: 16px;
    padding: 6px;
}
[data-theme="dark"] .calc-nav-pills {
    background: rgba(255, 255, 255, 0.05);
}
.calc-nav-pills .nav-link {
    border-radius: 12px;
    color: var(--muted);
    font-weight: 600;
    padding: 10px 20px;
    transition: all 0.3s ease;
}
.calc-nav-pills .nav-link.active {
    background: #fff;
    color: var(--brand);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}
[data-theme="dark"] .calc-nav-pills .nav-link.active {
    background: var(--brand);
    color: #fff;
}

/* Ultra-Modern Input Group */
.input-group-premium {
    background: #fff;
    border: 2px solid transparent;
    border-radius: 18px;
    padding: 6px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
}
[data-theme="dark"] .input-group-premium {
    background: rgba(0, 0, 0, 0.2);
}
.input-group-premium:focus-within {
    border-color: var(--brand);
    box-shadow: 0 8px 30px rgba(122, 106, 216, 0.15);
    transform: translateY(-2px);
}
.input-group-premium input, 
.input-group-premium select {
    border: none;
    background: transparent;
    box-shadow: none !important;
    padding: 12px 15px;
    font-size: 1.1rem; /* Desktop size */
    font-weight: 500;
    color: var(--text);
    width: 100%; /* Ensure full width */
}
.input-group-premium .btn-action {
    border-radius: 14px;
    padding: 10px 24px;
    font-weight: 600;
    white-space: nowrap; /* Keeps button on 1 row */
    transition: all 0.2s;
}

/* Improved Profile Buttons */
.btn-profile-action {
    padding: 10px 20px;
    border-radius: 14px;
    font-weight: 500;
    font-size: 0.95rem;
    border: 1px solid transparent;
    transition: all 0.3s ease;
}
.btn-profile-import {
    background: rgba(16, 172, 132, 0.1);
    color: #10ac84;
    border-color: rgba(16, 172, 132, 0.2);
}
.btn-profile-import:hover {
    background: rgba(16, 172, 132, 0.2);
    transform: translateY(-2px);
}
[data-theme="dark"] .btn-profile-import {
    background: rgba(16, 172, 132, 0.2);
    color: #20c997;
}

/* Mobile Optimizations */
@media (max-width: 576px) {
    .input-group-premium input, 
    .input-group-premium select {
        font-size: 0.95rem; /* Smaller text on mobile */
        padding: 10px 12px;
    }
    .input-group-premium .btn-action {
        padding: 10px 16px;
    }
    .calc-nav-pills .nav-link {
        padding: 8px 10px;
        font-size: 0.9rem;
    }
}

/* Server Status Positioning */
.server-status-wrapper {
    display: flex;
    justify-content: center;
    margin-bottom: 1.5rem;
}
@media (min-width: 992px) {
    .server-status-wrapper {
        justify-content: flex-end;
        position: absolute;
        top: 0;
        right: 15px;
        width: auto;
        z-index: 5;
    }
}
    
  </style>
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-CMENQJ4ELS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CMENQJ4ELS', { 'cookie_domain': 'auto' });
</script>

<body>

  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MJW7HPPS"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  
<div class="cursor-dot" id="cursorDot"></div>

  <div id="backToTop">
    <i class="fas fa-arrow-up"></i>
  </div>

  <div class="modal fade course-details-modal" id="courseDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="courseDetailsModalTitle">Course Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="courseDetailsModalBody"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="addCourseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-plus-circle me-2"></i>Add Custom Course</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addCourseForm">
            <input type="hidden" id="addCourseSemester" value="">
            <div class="mb-3">
              <label for="courseCode" class="form-label">Course Code</label>
              <input type="text" class="form-control" id="courseCode" placeholder="e.g., CHEM-101" required>
            </div>
            <div class="mb-3">
              <label for="courseTitle" class="form-label">Course Title</label>
              <input type="text" class="form-control" id="courseTitle" placeholder="e.g., Inorganic Chemistry" required>
            </div>
            <div class="row">
              <div class="col-6 mb-3">
                <label for="creditHours" class="form-label">Credit Hours</label>
                <select class="form-select" id="creditHours" required>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3" selected>3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select>
              </div>
              <div class="col-6 mb-3">
                <label for="courseMarks" class="form-label">Marks Obtained</label>
                <input type="number" class="form-control" id="courseMarks" min="0" max="100" placeholder="e.g., 75" required>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="saveCourseBtn">Add Course</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="renameProfileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg"> <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-pen-to-square me-2"></i>Rename Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="renameProfileForm">
            <div class="mb-3">
              <label for="newProfileName" class="form-label">Profile Name</label>
              <input type="text" class="form-control" id="newProfileName" required>
              <div class="form-text">Give this profile a unique name (e.g., "My Final Year Prediction").</div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="saveProfileNameBtn">Save Name</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="renameSemesterModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-pen-to-square me-2"></i>Rename Semester</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="renameSemesterForm">
            <div class="mb-3">
              <label for="newSemesterName" class="form-label">Semester Name</label>
              <input type="text" class="form-control" id="newSemesterName" required>
              <div class="form-text">Give this semester a unique name (e.g., "Final Year - Spring").</div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="saveSemesterNameBtn">Save Name</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="attendanceImportModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header d-flex justify-content-between align-items-center w-100">
          <h5 class="modal-title mb-0" id="attendanceModalTitle"><i class="fa-solid fa-clipboard-user me-2"></i>Import Courses</h5>
          <div class="d-flex align-items-center gap-3">
            <span id="attendanceCourseCount" class="small text-muted"></span>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="toggleAllCourses" role="switch">
              <label class="form-check-label small" for="toggleAllCourses">Show All</label>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
        </div>
        <div class="modal-body">
          <p class="text-muted small" id="attendanceModalDescription">The following courses were found in the Attendance System but not in your main LMS results. Select courses to import and set their credit hours.</p>
          
          <div class="d-flex justify-content-between align-items-center py-2 px-3 rounded mb-2" style="background-color: rgba(122, 106, 216, 0.05);">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="toggleSelectAllCourses">
              <label class="form-check-label fw-medium" for="toggleSelectAllCourses">Select All Visible</label>
            </div>
            <span id="attendanceSelectedCount" class="small fw-medium" style="color: var(--brand);">0 Selected</span>
          </div>

          <div id="attendanceCourseList">
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="importAttendanceCoursesBtn">Import Selected Courses</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="profileManagerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fa-solid fa-users-gear me-2"></i>Profile Manager</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="profile-manager-header">
                    <h6 class="mb-0">Manage Your Saved Profiles</h6>
                    <div class="profile-manager-stats">
                        <span id="profileCountStat">0 Profiles</span> |
                        <span id="lastBackupStat">Last Backup: Never</span>
                    </div>
                </div>
                <div class="profile-manager-toolbar">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAllProfiles">
                        <label class="form-check-label" for="selectAllProfiles">Select All</label>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-secondary-action btn-sm dropdown-toggle rounded-3" type="button" id="bulkActionsBtn" data-bs-toggle="dropdown" aria-expanded="false" disabled>
                            Bulk Actions
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="bulkActionsBtn">
                            <li><a class="dropdown-item text-danger" href="#" id="deleteSelectedBtn"><i class="fa-solid fa-trash-can me-2"></i>Delete Selected</a></li>
                        </ul>
                    </div>
                    <div class="ms-auto d-flex gap-2">
                         <button class="btn btn-success-action btn-sm rounded-3" id="importProfilesBtnModal"><i class="fa-solid fa-upload me-2"></i>Import</button>
                         <button class="btn btn-info-action btn-sm rounded-3" id="exportProfilesBtnModal"><i class="fa-solid fa-download me-2"></i>Export</button>
                    </div>
                </div>
                <ul class="profile-list" id="profileManagerList">
                    </ul>
            </div>
        </div>
    </div>
  </div>


  <div class="modal fade confirmation-modal" id="bedConfirmationModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <i class="fa-solid fa-graduation-cap mb-3" style="font-size: 2.5rem; color: var(--brand);"></i>
        <h5 class="modal-title mb-2">B.Ed. Courses Detected</h5>
        <p class="text-muted small">We found courses related to the B.Ed. (Bachelor of Education) program in your results.</p>
        <p class="mb-0"><strong>Have you enrolled in the B.Ed. program?</strong></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary-action rounded-pill" id="bedConfirmNo">No, Show All</button>
        <button type="button" class="btn btn-primary-action rounded-pill" id="bedConfirmYes">Yes, Separate B.Ed.</button>
      </div>
    </div>
  </div>
</div>
  

  <div class="modal fade confirmation-modal" id="confirmationModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-sm">
      <div class="modal-content">
        <div class="modal-body">
          <i class="fa-solid fa-triangle-exclamation mb-3"></i>
          <h5 class="modal-title mb-2" id="confirmationModalTitle">Are you sure?</h5>
          <p id="confirmationModalBody" class="text-muted small">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal" id="confirmationCancelBtn">Cancel</button>
          <button type="button" class="btn btn-danger-action rounded-pill" id="confirmationConfirmBtn">Confirm</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="restrictedAccessModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg" style="border-radius: 24px; overflow: hidden;">
      <div class="modal-header border-0 text-white p-4" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
        <h5 class="modal-title fw-bold"><i class="fa-solid fa-user-lock me-2"></i>Restricted Access</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4 text-center bg-light">
        <div class="mb-4 mt-2">
            <div class="d-flex align-items-center justify-content-center mx-auto shadow-sm" 
                 style="width: 80px; height: 80px; border-radius: 50%; background: #fff;">
                <i class="fa-solid fa-key fa-2x text-danger"></i>
            </div>
        </div>
        <h5 class="fw-bold mb-2 text-dark">Pass Key Required</h5>
        <p class="text-muted small mb-4 px-3">The academic record for this student is protected. Please enter the secure pass key to view results.</p>
        
        <div class="form-floating mb-2 text-start">
          <input type="password" class="form-control rounded-4" id="restrictedPassKey" placeholder="Enter Pass Key" style="border: 1px solid #e0e0e0;">
          <label for="restrictedPassKey"><i class="fa-solid fa-lock me-2 small"></i>Pass Key</label>
        </div>
        <div id="passKeyError" class="text-danger small fw-bold text-start ms-2 shake-animation" style="display: none;">
            <i class="fa-solid fa-circle-exclamation me-1"></i> Incorrect Pass Key
        </div>
      </div>
      <div class="modal-footer border-0 bg-light justify-content-center pb-4 pt-0">
        <button type="button" class="btn btn-secondary-action rounded-pill px-4" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger rounded-pill px-4 shadow-sm" id="submitPassKeyBtn">
            Unlock Record <i class="fa-solid fa-arrow-right ms-2"></i>
        </button>
      </div>
    </div>
  </div>
</div>

  <nav class="navbar navbar-expand-lg fixed-top navbar-premium">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2 premium-brand-hover" href="/">
      <span class="badge rounded-pill badge-brand">UAF</span>
      <span class="gradient-text">CGPA Calculator</span>
    </a>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
      <div class="hamburger-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item">
          <a class="nav-link" href="#Home"><i class="fa-solid fa-house me-2 d-lg-none"></i>Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#Auto-Calculator"><i class="fa-solid fa-calculator me-2 d-lg-none"></i>Calculator</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#features"><i class="fa-solid fa-star me-2 d-lg-none"></i>Features</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#faq"><i class="fa-solid fa-circle-question me-2 d-lg-none"></i>FAQ</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#contact-us"><i class="fa-solid fa-envelope me-2 d-lg-none"></i>Contact</a>
        </li>
        
        <li class="nav-item nav-item-theme-toggle ms-lg-3">
          <div class="theme-switch-wrapper-mobile d-lg-none">
            <input type="checkbox" id="themeToggleInput" class="theme-switch-input" />
            <label for="themeToggleInput" class="theme-switch-label"></label>
          </div>
          
          <button id="themeToggleBtn" class="btn btn-icon-toggle d-none d-lg-flex" type="button" aria-label="Toggle dark mode">
            <i class="fa-solid fa-moon"></i>
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<main>
  <section class="hero" id="Home">
    <div class="container">
      <div class="row align-items-center g-4">
        <div class="col-lg-7">
          <span class="badge rounded-pill badge-brand mb-3">University of Agriculture Faisalabad (UAF)</span>
          <!-- <h1 class="display-5 mb-3"><span class="hero-text-gradient"><strong>UAF CGPA Calculator 2025</strong></span> by <span class="hero-text-gradient">M Saqlain </span>- Automatic & Accurate</h1> -->
          <!-- <h1 class="display-5 mb-3">Calculate Your <span class="hero-text-gradient">CGPA &amp; Percentage </span>Automatically from <span class="hero-text-gradient"><strong>UAF CGPA Calculator</strong></span></h1> -->
          <h1 class="display-5 mb-3"><span class="hero-text-gradient" style="font-weight:bold;">UAF CGPA Calculator 2025</span> by <span class="hero-text-gradient">M Saqlain </span>- Automatic & Accurate</h1>
          <p class="lead mb-4">Enter your <strong>registration number</strong> to fetch your results directly from <strong>UAF LMS & Attendance System</strong>. The calculator will automatically compute your CGPA and Percentage based on <strong>UAF grading system</strong>.</p>
          <div class="d-flex gap-2">
            <a href="#Auto-Calculator" class="btn btn-primary-action btn-lg rounded-pill" style="font-size: 1.05rem; padding: 0.9rem;">
              <i class="fa-solid fa-bolt me-2"></i>Try It Now
            </a>
            <a href="#contact-us" class="btn btn-secondary-action rounded-pill" style="display:block; padding:14px">
              <i class="fa-solid fa-star me-2"></i>Contact us
            </a>
          </div>
        </div>
        <div class="col-lg-5">
            <div class="card card-modern fade-in-on-scroll">
              <div class="card-body p-4">
                <div class="d-flex align-items-center gap-3">
                  <div class="display-6 robot-icon-gradient"><i class="fa-solid fa-award"></i></div>
                  <div>
                    <h3 class="mb-1 fw-bold" style="font-size:22px">Trusted by 50,000+ Students</h3>
                    <p class="mb-0 text-body-secondary">The #1 UAF CGPA Calculator.</p>
                  </div>
                </div>
                <hr class="my-4" />
                <ul class="list-unstyled m-0">
                  <li class="d-flex align-items-start gap-2 mb-2">
                    <i class="fa-solid fa-check text-success mt-1"></i>
                    <div>
                      <strong>Instant & Automatic:</strong> Fetches official results from UAF LMS & Attendance System.
                    </div>
                  </li>
                  <li class="d-flex align-items-start gap-2 mb-2">
                    <i class="fa-solid fa-check text-success mt-1"></i>
                    <div>
                      <strong>Forecast & Edit:</strong> The only calculator to forecast future CGPA, and custom courses.
                    </div>
                  </li>
                  <li class="d-flex align-items-start gap-2 mb-2">
                    <i class="fa-solid fa-check text-success mt-1"></i>
                    <div>
                      <strong>100% Accurate:</strong> Correctly handles repeated courses (counting only the best attempt).
                    </div>
                  </li>
                  <li class="d-flex align-items-start gap-2">
                    <i class="fa-solid fa-check text-success mt-1"></i>
                    <div>
                      <strong>Premium PDF:</strong> Download a professional-style transcript of your results with a single click.
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
      </div>
    </div>
  </section>

  <div class="announcement-bar">
    <div class="announcement-track">
        <span class="announcement-text">
            <i class="fa-solid fa-circle-info me-2"></i>
             Only the highest marks in a repeated course are counted towards your CGPA.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-wand-magic-sparkles me-2"></i>
             Use the 'Forecast Semester' button to plan your future grades.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-arrows-up-down-left-right me-2"></i>
             On desktop, you can drag & drop courses between semesters.
        </span>
      <span class="announcement-text">
            <i class="fa-solid fa-circle-info me-2"></i>
             Only the highest marks in a repeated course are counted towards your CGPA.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-wand-magic-sparkles me-2"></i>
             Use the 'Forecast Semester' button to plan your future grades.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-arrows-up-down-left-right me-2"></i>
             On desktop, you can drag & drop courses between semesters.
        </span>
    </div>
</div>
  
  
  <section class="py-5" id="Auto-Calculator" style="padding-bottom: 0rem !important;">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-10">
          <div class="calculator-section-modern fade-in-on-scroll is-visible position-relative">
    
    <div class="server-status-wrapper">
        <div class="server-status-indicator shadow-sm">
            <div class="status-info-icon" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover focus"
                data-bs-placement="bottom" data-bs-title="Server Status"
                data-bs-content="<p class='mb-1'><strong>LMS:</strong> Main Result Portal</p><p class='mb-0'><strong>ATS:</strong> Attendance Portal</p>"
                data-bs-html="true">
                <i class="fa-solid fa-circle-info"></i>
            </div>
            <div class="status-item" id="lms-status-item">
                <div class="status-content-wrapper">
                    <div class="infinity-loader"></div><span class="status-label">LMS</span>
                </div>
                <div class="status-dot" id="lms-status-dot"></div>
            </div>
            <div class="status-item" id="attnd-status-item">
                <div class="status-content-wrapper">
                    <div class="infinity-loader"></div><span class="status-label">ATS</span>
                </div>
                <div class="status-dot" id="attnd-status-dot"></div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-7">
            
            <div class="text-center mb-5">
                <span class="badge rounded-pill bg-primary-subtle text-primary mb-3 px-3 py-2 fw-semibold">
                    <i class="fa-solid fa-bolt me-2"></i>Updated for 2025
                </span>
                <h1 class="display-5 fw-bold mb-2">
                    <span class="gradient-text">UAF CGPA Calculator</span>
                </h1>
                <p class="lead text-muted">
                    Automatic fetching, accurate calculations, and profile management.
                </p>
            </div>

            <div class="calculator-card">
                <div class="card-body p-4 p-md-5">
                    
                    <nav class="mb-4">
                        <div class="nav calc-nav-pills nav-fill" id="actionHubTab" role="tablist">
                            <button class="nav-link active" id="fetch-tab" data-bs-toggle="tab" 
                                data-bs-target="#fetch-tab-pane" type="button" role="tab" 
                                aria-controls="fetch-tab-pane" aria-selected="true">
                                <i class="fa-solid fa-magnifying-glass me-2"></i>Search Result
                            </button>
                            <button class="nav-link" id="profiles-tab" data-bs-toggle="tab" 
                                data-bs-target="#profiles-tab-pane" type="button" role="tab" 
                                aria-controls="profiles-tab-pane" aria-selected="false">
                                <i class="fa-solid fa-user-circle me-2"></i>My Profiles
                            </button>
                        </div>
                    </nav>

                    <div class="tab-content" id="actionHubTabContent">
                        
                        <div class="tab-pane fade show active" id="fetch-tab-pane" role="tabpanel" tabindex="0">
                            <form id="resultForm">
                                <div class="input-group-premium">
                                    <span class="ps-3 text-muted"><i class="fa-solid fa-id-card fa-lg"></i></span>
                                    <input type="text" class="form-control" id="registrationNumber" 
                                        placeholder="Ag No. (e.g. 2020-ag-1234)" required>
                                    <button type="submit" class="btn btn-primary-action btn-action">
                                        <span class="d-none d-sm-inline">Fetch Result</span>
                                        <i class="fa-solid fa-arrow-right ms-sm-2"></i>
                                    </button>
                                </div>
                                <div class="text-center mt-3">
                                    <small class="text-muted">
                                        <i class="fa-solid fa-shield-halved me-1"></i> Privacy Assured: We never store your data.
                                    </small>
                                </div>
                            </form>
                        </div>

                        <div class="tab-pane fade" id="profiles-tab-pane" role="tabpanel" tabindex="0">
                            
                            <div id="activeProfileUI" style="display: none;">
                                <p class="text-center text-muted mb-3 small">Select a saved profile to view details.</p>
                                <div class="input-group-premium">
                                    <span class="ps-3 text-muted"><i class="fa-solid fa-users fa-lg"></i></span>
                                    <select class="form-select" id="profileSwitcher">
                                        <option value="">Select a profile...</option>
                                    </select>
                                    <button class="btn btn-secondary-action btn-action" type="button" id="openProfileManagerBtn" title="Settings">
                                        <i class="fa-solid fa-gear"></i>
                                    </button>
                                </div>
                            </div>

                            <div id="initialProfileUI">
                                <div class="text-center py-2">
                                    <div class="mb-3 text-muted opacity-50">
                                        <i class="fa-solid fa-folder-open fa-3x"></i>
                                    </div>
                                    <h6 class="fw-bold mb-2">No Profiles Found</h6>
                                    <p class="text-muted small mb-4">Fetch a result to save automatically, or restore from backup.</p>
                                    
                                    <div class="d-flex justify-content-center gap-3 flex-wrap">
                                        <button class="btn btn-profile-action btn-profile-import" type="button" id="importProfilesBtn">
                                            <i class="fa-solid fa-file-import me-2"></i>Import Backup
                                        </button>
                                        <button class="btn btn-profile-action btn-soft" type="button" id="exportProfilesBtn" disabled>
                                            <i class="fa-solid fa-download me-2"></i>Export
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="loading-container shadow-sm mt-4" id="loadingContainer" style="display: none;">
                <div class="loading-stage" id="connectingStage">
                    <div class="loading-animation loading-connecting"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
                    <p class="loading-text">Connecting to UAF LMS</p><p class="loading-subtext">Establishing secure connection...</p>
                </div>
                <div class="loading-stage" id="fetchingStage">
                    <div class="loading-animation loading-connecting"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
                    <p class="loading-text">Fetching Academic Records</p><p class="loading-subtext">Retrieving courses and grades...</p>
                </div>
                <div class="loading-stage" id="processingStage">
                    <div class="loading-animation loading-connecting"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
                    <p class="loading-text">Calculating CGPA</p><p class="loading-subtext">Processing quality points & percentages...</p>
                </div>
                <div class="loading-stage" id="completeStage">
                    <div class="loading-animation loading-complete"><div class="checkmark"></div></div>
                    <p class="loading-text text-success">Success!</p><p class="loading-subtext">Your result is ready.</p>
                </div>
            </div>

        </div>
    </div>
</div>

          <div id="resultContainer" class="result-container">
    <div class="gpa-result-card-premium fade-in-on-scroll">
    <div class="student-info-header">
      <h2 class="mb-0 fw-bold" id="studentName"><i class="fa-solid fa-user-graduate me-2"></i>Student Name</h2>
      <p class="mb-0 text-body-secondary" id="studentReg">Registration Number</p>
    </div>

    <div class="cgpa-dashboard">
      <div class="cgpa-progress-circle">
        <svg viewBox="0 0 36 36">
          <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
          <path id="cgpaCircle" class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
        </svg>
        <div class="cgpa-progress-text">
          <span id="totalCgpa" class="cgpa-value">0.00</span>
          <span class="cgpa-label">CGPA</span>
        </div>
      </div>
    </div>

    <div class="secondary-stats">
        <div class="stat-item">
            <span class="stat-label">Percentage</span>
            <span class="stat-value" id="totalPercentage">0.00%</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
            <span class="stat-label">Total Marks</span>
            <span class="stat-value">
                <span id="totalMarksObtained">0</span><span id="totalMaxMarks" class="stat-sub-value">/ 0</span>
            </span>
        </div>
    </div>
</div>

            <div class="text-center fade-in-on-scroll" style="margin-top: 1.5rem;">
      <p class="text-muted small mb-2">If some courses are not in LMS, you can find them in the Attendance System.</p>
      <button id="fetchAttendanceBtn" class="btn btn-success-action" style="min-width: 220px; border-radius: var(--radius-btn);">
        <i class="fa-solid fa-clipboard-user me-2"></i>
      </button>
    </div>            

    <div class="card card-modern mt-4 fade-in-on-scroll" id="gpaChartContainer" style="display: none;">
    <div class="card-header p-0">
      <a href="#gpaChartCollapse" class="d-block text-decoration-none p-3" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="gpaChartCollapse">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 text-body"><i class="fa-solid fa-chart-line me-2"></i>GPA Trend</h4>
          <i class="fa-solid fa-chevron-down text-body" id="gpaChartChevron"></i>
        </div>
      </a>
    </div>
    <div class="collapse" id="gpaChartCollapse">
      <div class="card-body">
        <canvas id="gpaTrendChart"></canvas>
      </div>
    </div>
  </div>

    <div class="action-buttons-aligned justify-content-lg-between w-100 fade-in-on-scroll">
      <button id="downloadPdfBtn" class="btn btn-pdf-download"><i class="fa-solid fa-file-pdf me-2"></i>Download PDF</button>
      <button id="addForecastSemesterBtn" class="btn btn-info-action"><i class="fa-solid fa-wand-magic-sparkles me-2"></i>Forecast Semester</button>
    </div>

    <!-- NEW WRAPPER ADDED HERE TO FIX LAYOUT -->
    <div class="semester-results-container">
      <div id="semesterResults" class="semester-grid"></div>
    </div>
</div>

          <div id="bedResultContainer" style="display: none;">
  <nav class="nav nav-tabs nav-fill" id="bedTab" role="tablist">
    <a class="nav-link active" id="bed-tab" data-bs-toggle="tab" href="#bed-tab-content" role="tab" aria-controls="bed-tab-content" aria-selected="true">
      <i class="fa-solid fa-graduation-cap me-2"></i>B.Ed. Program
    </a>
    <a class="nav-link" id="other-tab" data-bs-toggle="tab" href="#other-tab-content" role="tab" aria-controls="other-tab-content" aria-selected="false">
      <i class="fa-solid fa-book me-2"></i>Other Program
    </a>
  </nav>

  <div class="tab-content" id="bedTabContent">
    <div class="tab-pane fade show active" id="bed-tab-content" role="tabpanel" aria-labelledby="bed-tab">
      <div class="gpa-result-card-premium fade-in-on-scroll is-visible">
        <div class="student-info-header">
          <!-- FIX: Give these unique IDs -->
          <h2 class="mb-0 fw-bold" id="bed-studentName"><i class="fa-solid fa-user-graduate me-2"></i>Student Name</h2>
          <p class="mb-0 text-body-secondary" id="bed-studentReg">Registration Number</p>
        </div>
        <div class="cgpa-dashboard">
          <div class="cgpa-progress-circle">
            <svg viewBox="0 0 36 36">
              <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="bed-cgpaCircle" class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="cgpa-progress-text">
              <span id="bed-totalCgpa" class="cgpa-value">0.00</span>
              <span class="cgpa-label">B.Ed. CGPA</span>
            </div>
          </div>
        </div>
        <div class="secondary-stats">
          <div class="stat-item">
            <span class="stat-label">Percentage</span>
            <span class="stat-value" id="bed-totalPercentage">0.00%</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat-item">
            <span class="stat-label">Total Marks</span>
            <span class="stat-value">
              <span id="bed-totalMarksObtained">0</span><span id="bed-totalMaxMarks" class="stat-sub-value">/ 0</span>
            </span>
          </div>
        </div>
      </div>
      
      <!-- NEW: Add  Button -->
      <div class="text-center fade-in-on-scroll" style="margin-top: 1.5rem;">
        <p class="text-muted small mb-2">If some courses are not in LMS, you can find them in the Attendance System.</p>
        <button id="bed-fetchAttendanceBtn" class="btn btn-success-action" style="min-width: 220px; border-radius: var(--radius-btn);">
          <i class="fa-solid fa-clipboard-user me-2"></i>
        </button>
      </div>

      <!-- NEW: Add GPA Chart Container -->
      <div class="card card-modern mt-4 fade-in-on-scroll" id="bedGpaChartContainer" style="display: none;">
        <div class="card-header p-0">
          <a href="#bedGpaChartCollapse" class="d-block text-decoration-none p-3" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="bedGpaChartCollapse">
            <div class="d-flex justify-content-between align-items-center">
              <h4 class="mb-0 text-body"><i class="fa-solid fa-chart-line me-2"></i>GPA Trend</h4>
              <i class="fa-solid fa-chevron-down text-body" id="bedGpaChartChevron"></i>
            </div>
          </a>
        </div>
        <div class="collapse" id="bedGpaChartCollapse">
          <div class="card-body">
            <canvas id="bedGpaTrendChart"></canvas>
          </div>
        </div>
      </div>

      <!-- NEW: Add Action Buttons -->
      <div class="action-buttons-aligned justify-content-lg-between w-100 fade-in-on-scroll">
        <button id="bed-downloadPdfBtn" class="btn btn-pdf-download"><i class="fa-solid fa-file-pdf me-2"></i>Download PDF</button>
        <button id="bed-addForecastSemesterBtn" class="btn btn-info-action"><i class="fa-solid fa-wand-magic-sparkles me-2"></i>Forecast Semester</button>
      </div>

      <div class="semester-results-container">
        <div id="bed-semesterResults" class="semester-grid"></div>
      </div>
    </div>

    <div class="tab-pane fade" id="other-tab-content" role="tabpanel" aria-labelledby="other-tab">
      <div class="gpa-result-card-premium fade-in-on-scroll is-visible">
        <div class="student-info-header">
          <!-- FIX: Give these unique IDs -->
          <h2 class="mb-0 fw-bold" id="other-studentName"><i class="fa-solid fa-user-graduate me-2"></i>Student Name</h2>
          <p class="mb-0 text-body-secondary" id="other-studentReg">Registration Number</p>
        </div>
        <div class="cgpa-dashboard">
          <div class="cgpa-progress-circle">
            <svg viewBox="0 0 36 36">
              <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="other-cgpaCircle" class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="cgpa-progress-text">
              <span id="other-totalCgpa" class="cgpa-value">0.00</span>
              <span class="cgpa-label">CGPA</span>
            </div>
          </div>
        </div>
        <div class="secondary-stats">
          <div class="stat-item">
            <span class="stat-label">Percentage</span>
            <span class="stat-value" id="other-totalPercentage">0.00%</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat-item">
            <span class="stat-label">Total Marks</span>
            <span class="stat-value">
              <span id="other-totalMarksObtained">0</span><span id="other-totalMaxMarks" class="stat-sub-value">/ 0</span>
            </span>
          </div>
        </div>
      </div>
      
      <!-- NEW: Add  Button -->
      <div class="text-center fade-in-on-scroll" style="margin-top: 1.5rem;">
        <p class="text-muted small mb-2">If some courses are not in LMS, you can find them in the Attendance System.</p>
        <button id="other-fetchAttendanceBtn" class="btn btn-success-action" style="min-width: 220px; border-radius: var(--radius-btn);">
          <i class="fa-solid fa-clipboard-user me-2"></i>
        </button>
      </div>

      <!-- NEW: Add GPA Chart Container -->
      <div class="card card-modern mt-4 fade-in-on-scroll" id="otherGpaChartContainer" style="display: none;">
        <div class="card-header p-0">
          <a href="#otherGpaChartCollapse" class="d-block text-decoration-none p-3" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="otherGpaChartCollapse">
            <div class="d-flex justify-content-between align-items-center">
              <h4 class="mb-0 text-body"><i class="fa-solid fa-chart-line me-2"></i>GPA Trend</h4>
              <i class="fa-solid fa-chevron-down text-body" id="otherGpaChartChevron"></i>
            </div>
          </a>
        </div>
        <div class="collapse" id="otherGpaChartCollapse">
          <div class="card-body">
            <canvas id="otherGpaTrendChart"></canvas>
          </div>
        </div>
      </div>

      <!-- NEW: Add Action Buttons -->
      <div class="action-buttons-aligned justify-content-lg-between w-100 fade-in-on-scroll">
        <button id="other-downloadPdfBtn" class="btn btn-pdf-download"><i class="fa-solid fa-file-pdf me-2"></i>Download PDF</button>
        <button id="other-addForecastSemesterBtn" class="btn btn-info-action"><i class="fa-solid fa-wand-magic-sparkles me-2"></i>Forecast Semester</button>
      </div>

      <div class="semester-results-container">
        <div id="other-semesterResults" class="semester-grid"></div>
      </div>
    </div>
  </div>
</div>
          

<div class="card card-modern mt-4 fade-in-on-scroll">
    <div class="card-header p-0">
        <a href="#statusLogCollapse" class="d-block text-decoration-none p-3" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="statusLogCollapse">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0 text-body"><i class="fa-solid fa-terminal me-2"></i>Status Log</h4>
                <i class="fa-solid fa-chevron-down text-body status-log-chevron"></i>
            </div>
        </a>
    </div>
    <div class="collapse" id="statusLogCollapse">
        <div class="card-body p-4">
            <div class="status-log" id="statusLog">
                <div class="status-line status-info">Ready to fetch your results. Enter your registration number and click "Fetch Result".</div>
            </div>
            <div class="log-section center-buttons mt-3">
                <button id="downloadLogBtn" class="btn btn-secondary-action rounded-pill"><i class="fa-solid fa-file-lines me-2"></i>Download Log</button>
                <button id="clearLogBtn" class="btn btn-danger-action rounded-pill"><i class="fa-solid fa-trash me-2"></i>Clear Log</button>
            </div>
        </div>
    </div>
</div>

  <section class="why-choose-section" id="features">
    <div class="container">
      <div class="text-center mb-5 fade-in-on-scroll">
        <h2 class="fw-bold">Why Choose Our <span class="gradient-text">CGPA Calculator</span></h2>
        <p class="lead text-muted">The most advanced and feature-rich cgpa calculation tool for UAF students</p>
      </div>
      <div class="row g-4">
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-robot"></i></div>
            <h5>Instant & Automatic</h5>
            <p class="text-muted">Enter your registration number to get your complete, calculated academic record from the UAF portal in seconds. No manual entry needed.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-edit"></i></div>
            <h5>Forecast & Edit</h5>
            <p class="text-muted">Accurately forecast your CGPA by adding custom courses, deleting semesters, or simply dragging-and-dropping subjects between semesters.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-file-pdf"></i></div>
            <h5>Premium PDF Export</h5>
            <p class="text-muted">Generate a beautifully designed, professional transcript of your results with a single click. Perfect for your personal academic records.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
            <h5>Secure & Personal</h5>
            <p class="text-muted">Requires no password and never stores your data on our servers. Save multiple profiles securely in your own browser and enjoy a modern interface with dark mode.</p>
          </div>
        </div>
      </div>
    </div>
  </section>


          <section class="py-5" id="how-it-works">
  <div class="container">
    <div class="text-center mb-5 fade-in-on-scroll">
      <h2 class="fw-bold">How to Use <span class="gradient-text">UAF CGPA Calculator</span></h2>
      <p class="lead text-muted">Calculate your University of Agriculture Faisalabad (UAF) CGPA in 4 simple steps</p>
    </div>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card card-modern h-100 text-center p-4 fade-in-on-scroll">
          <div class="mb-3">
            <div class="display-4" style="color: var(--brand);"><i class="fas fa-id-card"></i></div>
          </div>
          <h4 class="fw-bold">Step 1: Enter Registration Number</h4>
          <p class="text-muted">Enter your UAF registration number (e.g., 2020-ag-1234) in the input field. Our calculator supports all UAF departments including Agriculture, Sciences, and Engineering.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-modern h-100 text-center p-4 fade-in-on-scroll">
          <div class="mb-3">
            <div class="display-4" style="color: var(--brand);"><i class="fas fa-cloud-download-alt"></i></div>
          </div>
          <h4 class="fw-bold">Step 2: Fetch Your Results</h4>
          <p class="text-muted">Click "Fetch Result" and our system will automatically connect to UAF LMS and Attendance System to retrieve your complete academic record securely.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-modern h-100 text-center p-4 fade-in-on-scroll">
          <div class="mb-3">
            <div class="display-4" style="color: var(--brand);"><i class="fas fa-calculator"></i></div>
          </div>
          <h4 class="fw-bold">Step 3: View Your CGPA</h4>
          <p class="text-muted">Instantly view your calculated CGPA, GPA, percentage, and semester-wise breakdown. Download a professional PDF transcript with one click.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-modern h-100 text-center p-4 fade-in-on-scroll">
          <div class="mb-3">
            <div class="display-4" style="color: var(--brand);"><i class="fas fa-edit"></i></div>
          </div>
          <h4 class="fw-bold">Step 4: Edit & Forecast</h4>
          <p class="text-muted">Easily edit CGPA by importing from the Attendance System, adding custom courses, or forecasting future grades.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="py-5" id="uaf-grading-info">
  <div class="container">
    <div class="text-center mb-5 fade-in-on-scroll">
      <h2 class="fw-bold">The <span class="gradient-text">UAF Grading System</span> Explained</h2>
      <p class="lead text-muted">A clear, precise breakdown of how your CGPA is calculated.</p>
    </div>

    <div class="row g-4 g-lg-5 justify-content-center">
      <div class="col-lg-6">
        <div class="card card-modern h-100 fade-in-on-scroll">
          <div class="card-body p-4 p-md-5">
            <div class="d-flex align-items-center mb-3">
              <div class="feature-icon" style="width: 50px; height: 50px; font-size: 1.2rem; margin: 0 1rem 0 0;">
                <i class="fa-solid fa-calculator"></i>
              </div>
              <h4 class="fw-bold mb-0">The Core CGPA Formula</h4>
            </div>
            <p class="text-muted">This calculator uses the <strong>official UAF 4.0 grading scale</strong>. Your CGPA is determined by a simple, powerful formula:</p>
            
            <div class="alert alert-info text-center" style="background-color: rgba(122, 106, 216, 0.05); border-color: rgba(122, 106, 216, 0.2); color: var(--text);">
              <strong class="d-block" style="font-size: 1.1rem; color: var(--brand);">CGPA = Total Quality Points Ã· Total Credit Hours</strong>
            </div>
            
            <hr class="my-4">

            <h5 class="fw-bold mb-3">How are <span class="gradient-text">Quality Points</span> Calculated?</h5>
            <p class="text-muted mb-0">For each course, the grade (A, B, C, D, F) you receive is converted into Grade Points (from 4.0 to 0.0). These are then multiplied by the course's credit hours to find the Quality Points (QP) for that single course.</p>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card card-modern h-100 fade-in-on-scroll">
          <div class="card-body p-4 p-md-5">
            <div class="d-flex align-items-center mb-3">
              <div class="feature-icon" style="width: 50px; height: 50px; font-size: 1.2rem; margin: 0 1rem 0 0;">
                <i class="fa-solid fa-star"></i>
              </div>
              <h4 class="fw-bold mb-0">Key Calculation Features</h4>
            </div>
            <p class="text-muted">Our tool automates the most complex parts of the UAF grading policy for you:</p>
            
            <ul class="list-unstyled m-0">
              <li class="d-flex align-items-start gap-3 mb-3">
                <i class="fa-solid fa-check-circle text-success fa-lg mt-1"></i>
                <div>
                  <strong class="d-block">Repeated Courses Handled</strong>
                  <span class="text-muted small">Only the <strong>highest grade attempt</strong> for any repeated course is included in the final CGPA calculation. All other attempts are automatically excluded.</span>
                </div>
              </li>
              <li class="d-flex align-items-start gap-3 mb-3">
                <i class="fa-solid fa-check-circle text-success fa-lg mt-1"></i>
                <div>
                  <strong class="d-block">Comprehensive System Sync</strong>
                  <span class="text-muted small">Pulls data from both the <strong>UAF LMS</strong> and the <strong>Attendance System</strong> to build the most complete picture of your academic record.</span>
                </div>
              </li>
              <li class="d-flex align-items-start gap-3">
                <i class="fa-solid fa-check-circle text-success fa-lg mt-1"></i>
                <div>
                  <strong class="d-block">Works for All Faculties</strong>
                  <span class="text-muted small">The calculation logic is standard across all UAF departments, from Agriculture and Sciences to Engineering and Veterinary Sciences.</span>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-10">
          <div class="card card-modern fade-in-on-scroll h-100">
            <div class="card-body p-4">
              <h4 class="fw-bold mb-3 d-flex align-items-center gap-2">
                <i class="fa-solid fa-table me-1" style="color: var(--brand);"></i>
                Official UAF Quality Point Table
              </h4>
              <p class="text-body-secondary mb-3">
                Refer to the official UAF Quality Point Table below to understand how marks are converted into quality points and grades. Click or tap the image to zoom in and drag for details.
              </p>
              <div class="zoomable-image-container" id="qpTableContainer">
                
                <img src="/assets/images/quality-point-table-uaf-cgpa-calculator-saqlain.webp" 
                     id="qpTableImage"
                     alt="Official UAF Quality Point Table by M Saqlain showing mark ranges, grades (A, B+, B, C+, C, D, F), and corresponding quality points for various course credit hours (0.5 to 4.0). Designed by M Saqlain, a UAF alumni and developer of UAF CGPA Calculator."
                     title="UAF Quality Point Table by M Saqlain">
                
                <div class="zoom-loupe" id="qpTableLoupe"></div>
                
                <div class="zoom-box" id="qpTableZoomBox"></div>

              </div>
              <p class="text-body-secondary small mt-3 mb-0">
                  *Table developed by M Saqlain based on official UAF academic regulations.
              </p>
            </div>
          </div>
        </div>
    </div>
  </div>
</section>


  
    <section class="py-5" id="faq">
  <div class="container">
    <div class="text-center mb-5 fade-in-on-scroll">
      <h2 class="fw-bold">Frequently Asked Questions</h2>
      <p class="lead text-muted">Everything you need to know about UAF CGPA Calculator</p>
    </div>
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="accordion" id="faqAccordion">
              <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
                <h2 class="accordion-header" id="headingOne">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    How does the UAF CGPA Calculator work?
                  </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    <strong>Our CGPA Calculator</strong> securely connects to the public UAF LMS portal using your registration number. It fetches your official results, processes the grades and credit hours according to the official UAF grading formula, and instantly calculates your precise Semester GPA and Cumulative GPA (CGPA).
                  </div>
                </div>
              </div>
              <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
                <h2 class="accordion-header" id="headingTwo">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    Is it safe to use my registration number?
                  </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    <strong>Yes, This CGPA Calculator by M Saqlain is completely safe.</strong> The calculator only requires your registration number, not your password. Your information is used only for fetching your result for the current session and is never stored or shared. The connection is secure and private.
                  </div>
                </div>
              </div>
              <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
                <h2 class="accordion-header" id="headingThree">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Can I use this calculator for other universities?
                  </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    This calculator is specifically designed for the students of the <strong>University of Agriculture Faisalabad (UAF)</strong>. It uses UAF's unique grading system and connects directly to the UAF LMS, so it will not work for other universities.
                  </div>
                </div>
              </div>

          <!-- ADD THESE NEW FAQ ITEMS -->
          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                How do I calculate my UAF CGPA automatically?
              </button>
            </h2>
            <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                Simply enter your <strong>UAF registration number</strong> (e.g., 2020-ag-1234) in the calculator above and click "Fetch Result". Our system will automatically retrieve your results from UAF LMS and calculate your CGPA, GPA, and percentage using the official UAF grading formula.
              </div>
            </div>
          </div>

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive">
                What is the UAF CGPA formula used by this calculator?
              </button>
            </h2>
            <div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                Our calculator uses the <strong>official UAF CGPA formula</strong>: CGPA = (Total Quality Points from all semesters) Ã· (Total Credit Hours from all semesters). Quality points are calculated by multiplying your grade points with credit hours for each course, following UAF's 4.0 grading scale.
              </div>
            </div>
          </div>

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix">
                Does this work for all UAF departments and programs?
              </button>
            </h2>
            <div id="collapseSix" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                <strong>Yes!</strong> This UAF CGPA calculator works for all departments including Agriculture, Sciences, Engineering, Veterinary, and all degree programs (BS, MS, PhD) at the University of Agriculture Faisalabad (UAF).
              </div>
            </div>
          </div>

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeven">
                Can I calculate UAF CGPA without my registration number?
              </button>
            </h2>
            <div id="collapseSeven" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                While automatic fetching requires your registration number, you can manually add your semester GPAs and credit hours to calculate your CGPA. However, using your registration number provides the most accurate results as it fetches data directly from UAF's system.
              </div>
            </div>
          </div>

          <!-- 5. ADD ENHANCED FAQ QUESTIONS (Add these to your existing FAQ section) -->

<!-- Add these new FAQ items to your accordion -->
<div class="accordion-item card-modern mb-3 fade-in-on-scroll">
  <h2 class="accordion-header">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTen">
      How to use the UAF CGPA Calculator by M Saqlain?
    </button>
  </h2>
  <div id="collapseTen" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
    <div class="accordion-body">
      Using <strong>M Saqlain's UAF CGPA Calculator</strong> is simple: (1) Enter your UAF registration number, (2) Click "Fetch Result", (3) View your automatic CGPA, GPA, and percentage calculation, (4) Optionally import missing courses from Attendance System, (5) Download your professional PDF transcript. The entire process takes less than 2 minutes!
    </div>
  </div>
</div>

<div class="accordion-item card-modern mb-3 fade-in-on-scroll">
  <h2 class="accordion-header">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEleven">
      Is Muhammad Saqlain's UAF calculator more accurate than others?
    </button>
  </h2>
  <div id="collapseEleven" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
    <div class="accordion-body">
      Yes! <strong>M Saqlain's calculator</strong> is 100% accurate because: (1) It uses the official UAF quality point formula, (2) It correctly handles repeated courses by counting only the highest grade, (3) It fetches data from both LMS and Attendance System, (4) It's developed by a UAF alumnus who deeply understands the grading system, (5) It's tested and trusted by 50,000+ students.
    </div>
  </div>
</div>

<div class="accordion-item card-modern mb-3 fade-in-on-scroll">
  <h2 class="accordion-header">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwelve">
      Can I forecast my future UAF CGPA with Saqlain's calculator?
    </button>
  </h2>
  <div id="collapseTwelve" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
    <div class="accordion-body">
      Absolutely! The <strong>UAF CGPA Calculator by M Saqlain</strong> is the ONLY calculator that lets you forecast future semesters. Click "Forecast Semester", add custom courses with expected grades, and see how your CGPA will change. This feature helps you plan your academic goals and target specific CGPA milestones.
    </div>
  </div>
</div>

<div class="accordion-item card-modern mb-3 fade-in-on-scroll">
  <h2 class="accordion-header">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThirteen">
      What is the difference between UAF LMS and Attendance System?
    </button>
  </h2>
  <div id="collapseThirteen" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
    <div class="accordion-body">
      UAF has two systems: (1) <strong>LMS (new)</strong> - contains most course results, (2) <strong>Attendance System (old)</strong> - contains additional courses that teachers upload separately. <b>Mr. Saqlain's calculator</b> is unique because it automatically fetches from BOTH portals, ensuring you never miss any courses in your CGPA calculation. Other calculators only check LMS.
    </div>
  </div>
</div>
          

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEight">
                How accurate is this UAF CGPA calculator?
              </button>
            </h2>
            <div id="collapseEight" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                Our calculator is <strong>100% accurate</strong> as it follows the official UAF grading system and quality point calculation method. It fetches data directly from UAF LMS and uses the same formulas as the university's official calculation system.
              </div>
            </div>
          </div>

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNine">
                Who created this UAF CGPA Calculator?
              </button>
            </h2>
            <div id="collapseNine" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                This calculator was developed by <strong>Muhammad Saqlain</strong>, a UAF BS Chemistry graduate (2020-2024). It's designed specifically for UAF students to make CGPA/GPA calculation easy and accurate. For any queries, you can contact through the form below.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
  


          <!-- 4. ADD TESTIMONIALS SECTION AFTER FEATURES -->
<section class="py-5" id="testimonials">
  <div class="container">
    <div class="text-center mb-5 fade-in-on-scroll">
      <h2 class="fw-bold">What UAF Students Say About <span class="gradient-text">M Saqlain's Calculator</span></h2>
      <p class="lead text-muted">Trusted by over 50,000 students across all UAF departments</p>
    </div>
    
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card card-modern h-100 p-4 fade-in-on-scroll">
          <div class="mb-3">
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
          </div>
          <p class="mb-3">"The <strong>best UAF CGPA calculator</strong> I've used! <strong>Saqlain's tool</strong> saved me hours of manual calculation. The attendance system integration is a game-changer!"</p>
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
              <strong>AA</strong>
            </div>
            <div>
              <strong>Ahmad Ali</strong>
              <div class="small text-muted">BS Agriculture, Batch 2021</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card card-modern h-100 p-4 fade-in-on-scroll">
          <div class="mb-3">
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
          </div>
          <p class="mb-3">"Finally, a <strong>UAF calculator</strong> that handles repeated courses correctly! <strong>M Saqlain</strong> really understood our needs. The PDF download feature is amazing!"</p>
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
              <strong>SF</strong>
            </div>
            <div>
              <strong>Sarah Fatima</strong>
              <div class="small text-muted">BS Chemistry, Batch 2020</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card card-modern h-100 p-4 fade-in-on-scroll">
          <div class="mb-3">
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
          </div>
          <p class="mb-3">"I've recommended <strong>UAF CGPA Calculator Saqlain</strong> to my entire batch! It's accurate, fast, and the forecasting feature helps me plan my grades perfectly."</p>
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
              <strong>MH</strong>
            </div>
            <div>
              <strong>Muhammad Hamza</strong>
              <div class="small text-muted">BS Engineering, Batch 2022</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
          

          <!-- 3. ADD THIS "ABOUT M SAQLAIN" SECTION BEFORE CONTACT -->
<section id="about-developer-premium" class="fade-in-on-scroll">
  <div class="container">
    <div class="card card-modern overflow-hidden">
      <div class="row g-0">
        <div class="col-lg-4 about-sidebar bg-light bg-opacity-50 border-end border-light-subtle d-flex flex-column align-items-center text-center p-4 p-md-5">
          <div class="position-relative mb-4">
            <div class="position-absolute top-0 start-0 w-100 h-100 bg-primary rounded-circle blur-xl opacity-25" style="filter: blur(20px);"></div>
            <img src="assets/images/developer-uaf-cgpa-calculator-m-saqlain.webp" 
                 alt="Muhammad Saqlain - Creator of UAF CGPA Calculator Saqlain" 
                 class="rounded-circle shadow-lg position-relative border border-4 border-white" 
                 style="width: 160px; height: 160px; object-fit: cover;" />
          </div>
          
          <h3 class="fw-bold mb-1 gradient-text">Muhammad Saqlain</h3>
          <p class="badge bg-primary-subtle text-primary rounded-pill mb-3 px-3">UAF Alumnus (2020-2024)</p>
          
          <p class="text-muted small mb-4 px-lg-3">
            Passionate software developer and Chemist committed to simplifying academic life for UAF students through accurate digital tools.
          </p>

          <div class="d-flex flex-wrap justify-content-center gap-2 w-100">
            <a href="https://www.linkedin.com/in/muhammad-saqlain-akbar/" target="_blank" class="btn btn-sm btn-soft rounded-pill flex-grow-1">
              <i class="fa-brands fa-linkedin me-2"></i>LinkedIn
            </a>
            <a href="https://x.com/M_Saqlain_Akbar" target="_blank" class="btn btn-sm btn-soft rounded-pill flex-grow-1">
              <i class="fa-brands fa-x-twitter me-2"></i>Twitter
            </a>
            <a href="https://www.facebook.com/UAFChemist.Rustam" target="_blank" class="btn btn-sm btn-soft rounded-pill flex-grow-1">
              <i class="fa-brands fa-facebook me-2"></i>Facebook
            </a>
          </div>
        </div>

        <div class="col-lg-8 p-4 p-md-5">
          <span class="text-uppercase text-primary fw-bold small tracking-wide">About The Developer</span>
          <h2 class="fw-bold mb-4">The Mind Behind the <span class="gradient-text">UAF CGPA Calculator</span></h2>
          
          <p class="text-body-secondary mb-4">
            Hello! I am <strong>M Saqlain</strong>. While pursuing my BS Chemistry at the University of Agriculture Faisalabad, I realized the struggle students face with manual calculations and fragmented results. To solve this, I developed this <strong>UAF CGPA Calculator</strong>â€”a tool designed to integrate directly with <strong>UAF LMS</strong> and the Attendance System for 100% accuracy.
          </p>

          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <div class="about-feature-box d-flex gap-3 align-items-start p-3 rounded-4 bg-white shadow-sm border border-light h-100">
                <div class="feature-icon bg-primary text-white rounded-circle p-2 d-flex align-items-center justify-content-center" style="width:40px;height:40px;">
                  <i class="fa-solid fa-server"></i>
                </div>
                <div>
                  <h6 class="fw-bold mb-1">LMS UAF Integration</h6>
                  <p class="small text-muted mb-0">Seamlessly fetches data from <strong>LMS UAF</strong> portals.</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="about-feature-box d-flex gap-3 align-items-start p-3 rounded-4 bg-white shadow-sm border border-light h-100">
                <div class="feature-icon bg-success text-white rounded-circle p-2 d-flex align-items-center justify-content-center" style="width:40px;height:40px;">
                  <i class="fa-solid fa-check-double"></i>
                </div>
                <div>
                  <h6 class="fw-bold mb-1">Accuracy First</h6>
                  <p class="small text-muted mb-0">Uses the official <strong>UAF CGPA Calculator Saqlain</strong> algorithm.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="alert about-quote-box alert-light border-start border-4 border-primary shadow-sm">
            <div class="d-flex">
              <i class="fa-solid fa-quote-left text-primary opacity-25 fa-2x me-3"></i>
              <div>
                <p class="fst-italic mb-0 text-muted small">
                  "My goal was to create the ultimate <strong>LMS UAF CGPA Calculator</strong> that handles repeated courses and attendance data automatically, saving students time and confusion."
                </p>
                <footer class="blockquote-footer mt-2 mb-0">M Saqlain</footer>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>


  <section class="py-5" id="contact-us">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-6 fade-in-on-scroll">
          <h3 class="fw-bold mb-2">Contact</h3>
          <p class="text-body-secondary">Questions or suggestions? Send a message.</p>
          <form id="contact-form" action="https://formspree.io/f/xblrolwp" method="post" class="needs-validation" novalidate>
            <div class="row g-3">
              <div class="col-md-6"><label class="form-label" for="name">Your Name</label><input class="form-control" id="name" name="name" placeholder="e.g., Ali Raza" required /><div class="invalid-feedback">Please enter your name.</div></div>
              <div class="col-md-6"><label class="form-label" for="email">Email</label><input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required /><div class="invalid-feedback">Enter a valid email.</div></div>
              <div class="col-12"><label class="form-label" for="message">Message</label><textarea class="form-control" id="message" name="message" rows="4" placeholder="Write your message..." required></textarea><div class="invalid-feedback">Please write a message.</div></div>
              <div class="col-12"><button class="btn btn-primary-action rounded-pill" type="submit"><i class="fa-solid fa-paper-plane me-2"></i>Send</button></div>
              <div id="contact-form-status" class="mt-2 small"></div>
            </div>
          </form>
        </div>
        <div class="col-lg-6 fade-in-on-scroll">
          <div class="h-100 p-4 p-lg-5 rounded-4" style="background:linear-gradient(180deg, rgba(122,106,216,.15), rgba(122,106,216,.05));">
            <h5 class="fw-bold">Developer</h5>
            <div class="d-flex align-items-center gap-3 mt-2">
              <img src="assets/images/developer-uaf-cgpa-calculator-m-saqlain.webp" alt="Muhammad Saqlain - Developer of UAF CGPA Calculator" class="rounded-circle" width="86" height="86" />
              <div>
                <div class="fw-semibold">Muhammad Saqlain</div><div class="text-body-secondary small">BS Chemistry (2020â€“2024)</div>
                <div class="d-flex gap-3 mt-2">
                  <a class="text-decoration-none" href="https://www.facebook.com/UAFChemist.Rustam" target="_blank"><i class="fa-brands fa-facebook"></i></a>
                  <a class="text-decoration-none" href="https://x.com/M_Saqlain_Akbar" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
                  <a class="text-decoration-none" href="https://www.linkedin.com/in/muhammad-saqlain-akbar/" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
                </div>
              </div>
            </div>
            <hr class="my-4" /><p class="mb-0 small text-body-secondary">Share this tool with your friends to support the project. â™¥</p>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

  <!-- 6. UPDATE YOUR FOOTER TO THIS -->
<footer class="premium-footer">
  <div class="container">
    <div class="row">

      <div class="col-lg-4 col-md-6">
        <a class="footer-logo" href="/">
          <span class="badge">UAF</span>
          <span class="gradient-text">CGPA Calculator</span>
        </a>
        <p class="footer-description">
          The #1 automatic cgpa calculator for University of Agriculture Faisalabad (UAF) students. Developed by M Saqlain to be accurate, fast, and free.
        </p>
        <div class="social-links">
          <a href="https://www.facebook.com/UAFChemist.Rustam" target="_blank" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
          <a href="https://x.com/M_Saqlain_Akbar" target="_blank" title="Twitter/X"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="https://www.linkedin.com/in/muhammad-saqlain-akbar/" target="_blank" title="LinkedIn"><i class="fa-brands fa-linkedin"></i></a>
        </div>
      </div>

      <div class="col-lg-2 col-md-3 offset-lg-1">
        <h5 class="footer-heading">Quick Links</h5>
        <ul class="footer-links">
          <li><a href="#Home">Home</a></li>
          <li><a href="#Auto-Calculator">Calculator</a></li>
          <li><a href="#features">Features</a></li>
          <li><a href="#faq">FAQ</a></li>
        </ul>
      </div>

      <div class="col-lg-2 col-md-7">
        <h5 class="footer-heading">About</h5>
        <ul class="footer-links">
          <li><a href="#about-developer-premium">About M Saqlain</a></li>
          <li><a href="#contact-us">Contact Developer</a></li>
          <li><a href="#uaf-grading-info">Grading System</a></li>
          <li><a href="#testimonials">Testimonials</a></li>
        </ul>
      </div>

      <div class="col-lg-3 col-md-12 mt-4 mt-lg-0"> <h5 class="footer-heading">Disclaimer</h5>
        <p class="footer-disclaimer">
          This is an unofficial, third-party tool developed by a UAF alumnus. It is not affiliated with, endorsed, or supported by the University of Agriculture Faisalabad (UAF). Always verify your official results with the university.
        </p>
      </div>

    </div>

    <div class="footer-bottom-bar">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="footer-copyright">
              <p class="mb-1">Â© 2025 Muhammad Saqlain. All rights reserved.</p>
              <p class="mb-0">Trusted by 50,000+ UAF Students | Developed by <a href="#about-developer-premium">M Saqlain</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<script>
        document.addEventListener('DOMContentLoaded', function() {
      // Elements
      const resultForm = document.getElementById('resultForm');
      const registrationNumber = document.getElementById('registrationNumber');
      const resultContainer = document.getElementById('resultContainer');
      const statusLog = document.getElementById('statusLog');
      const themeToggle = document.getElementById('themeToggle');
      const cursorDot = document.getElementById('cursorDot');
      const contactForm = document.getElementById('contact-form');
      const downloadLogBtn = document.getElementById('downloadLogBtn');
      const clearLogBtn = document.getElementById('clearLogBtn');
      const semesterResults = document.getElementById('semesterResults');
      const studentName = document.getElementById('studentName');
      const studentReg = document.getElementById('studentReg');
      const totalCgpa = document.getElementById('totalCgpa');
      const totalPercentage = document.getElementById('totalPercentage');
      const totalMarksObtained = document.getElementById('totalMarksObtained');
      const totalMaxMarks = document.getElementById('totalMaxMarks');
      const downloadPdfBtn = document.getElementById('downloadPdfBtn');
      const courseDetailsModal = new bootstrap.Modal(document.getElementById('courseDetailsModal'));
      const addCourseModal = new bootstrap.Modal(document.getElementById('addCourseModal'));
      const saveCourseBtn = document.getElementById('saveCourseBtn');
      const addCourseForm = document.getElementById('addCourseForm');
      const loadingContainer = document.getElementById('loadingContainer');
      const backToTopButton = document.getElementById('backToTop');
      const addForecastSemesterBtn = document.getElementById('addForecastSemesterBtn');
      const gpaChartContainer = document.getElementById('gpaChartContainer');
      const gpaTrendChartCanvas = document.getElementById('gpaTrendChart').getContext('2d');
      const profileManagementDiv = document.getElementById('profileManagement');
      const profileSwitcher = document.getElementById('profileSwitcher');
      const renameProfileModal = new bootstrap.Modal(document.getElementById('renameProfileModal'));
      const saveProfileNameBtn = document.getElementById('saveProfileNameBtn');

      let renameSemesterModal; // Will be initialized in init()
      let saveSemesterNameBtn; // Will be initialized in init()

      // NEW Attendance System Elements
      let fetchAttendanceBtn = document.getElementById('fetchAttendanceBtn');
      let bedFetchAttendanceBtn = document.getElementById('bed-fetchAttendanceBtn');
      let otherFetchAttendanceBtn = document.getElementById('other-fetchAttendanceBtn');
      const attendanceImportModal = new bootstrap.Modal(document.getElementById('attendanceImportModal'));
      const importAttendanceCoursesBtn = document.getElementById('importAttendanceCoursesBtn');

      // Profile Manager Elements
      const openProfileManagerBtn = document.getElementById('openProfileManagerBtn');
      const profileManagerModal = new bootstrap.Modal(document.getElementById('profileManagerModal'));
      const profileManagerModalEl = document.getElementById('profileManagerModal'); // Get the element
      const renameProfileModalEl = document.getElementById('renameProfileModal'); // Get the element
      const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
      const confirmationModalEl = document.getElementById('confirmationModal'); // Get the element
      const attendanceImportModalEl = document.getElementById('attendanceImportModal'); // Get the element

      // Import/Export buttons
      const importProfilesBtn = document.getElementById('importProfilesBtn');
      const exportProfilesBtn = document.getElementById('exportProfilesBtn');
      const importProfilesBtnModal = document.getElementById('importProfilesBtnModal'); // In modal
      const exportProfilesBtnModal = document.getElementById('exportProfilesBtnModal'); // In modal

      // State
      let allLogs = [];
      let processedData = null;
      let deletedSemesters = {};
      let gpaChart = null;
      let bedGpaChart = null;
      let otherGpaChart = null;
      let isInitialLoad = true;
      let confirmationCallback = null;
      let importedAttendanceCourses = []; // Tracks courses from the last import

      // --- NEW B.Ed. Variables ---
      const BED_COURSES = new Set([
        'EDU-501', 'EDU-503', 'EDU-505', 'EDU-507', 'EDU-509', 'EDU-511', 'EDU-513',
        'EDU-502', 'EDU-504', 'EDU-506', 'EDU-508', 'EDU-510', 'EDU-512', 'EDU-516',
        'EDU-601', 'EDU-604', 'EDU-605', 'EDU-607', 'EDU-608', 'EDU-623'
      ]);
      let bedConfirmationModal; // Will be initialized in init()
      let bedModeActive = false;
      // --- End of NEW B.Ed. Variables ---

      const API_ENDPOINT = `/api/result-scraper?action=scrape_single`;
      const ATTENDANCE_API_ENDPOINT = `/api/result-scraper?action=scrape_attendance`; // NEW API Endpoint

          
          // NEW FUNCTION to auto-collapse mobile menu
function initMenuAutoCollapse() {
  const navLinks = document.querySelectorAll('#mainNav .nav-link');
  const togglerButton = document.querySelector('.navbar-toggler[data-bs-target="#mainNav"]');
  const collapsibleMenu = document.getElementById('mainNav');

  if (!togglerButton || !collapsibleMenu) return;

  navLinks.forEach(link => {
    link.addEventListener('click', () => {
      // Check if the menu is currently shown (Bootstrap 5 class)
      if (collapsibleMenu.classList.contains('show')) {
        togglerButton.click(); // Simulate a click on the toggler to close it
      }
    });
  });
}
      
          // NEW updated init() function
function init() {
  try {
    migrateOldProfiles(); 
    initCustomCursor();
    initTheme();
    
    renameSemesterModal = new bootstrap.Modal(document.getElementById('renameSemesterModal'));
    saveSemesterNameBtn = document.getElementById('saveSemesterNameBtn');
    saveSemesterNameBtn.addEventListener('click', renameSemester); 
    
    initContactForm();
    createToastContainer();
    initBackToTop();
    initScrollAnimations();
    loadProfiles(); 
    initModalZIndexHandlers(); 
    
    initMenuAutoCollapse(); // <-- ADD THIS LINE

    // --- NEW B.Ed. Modal Init ---
    const bedModalEl = document.getElementById('bedConfirmationModal');
    if (bedModalEl) {
        bedConfirmationModal = new bootstrap.Modal(bedModalEl);
        document.getElementById('bedConfirmYes').addEventListener('click', () => {
          console.log("B.Ed. Yes clicked");
        });
        document.getElementById('bedConfirmNo').addEventListener('click', () => {
           console.log("B.Ed. No clicked");
        });
    } else {
        console.warn("B.Ed. confirmation modal HTML not found.");
    }

  } catch (error) { 
      console.error("Initialization failed:", error);
      try {
          createToastContainer(); 
          showToast("Error initializing application. Saved data might be corrupted.", "error");
      } catch (toastError) {
          console.error("Could not show initialization error toast:", toastError);
      }
  }
}


      function setupAttendanceButton() {
        // We now have three buttons to update
        const buttons = [
            { el: fetchAttendanceBtn, id: 'fetchAttendanceBtn' },
            { el: bedFetchAttendanceBtn, id: 'bed-fetchAttendanceBtn' },
            { el: otherFetchAttendanceBtn, id: 'other-fetchAttendanceBtn' }
        ];

        buttons.forEach(btnInfo => {
            if (!btnInfo.el) {
                // Button might not exist in DOM yet, try to find it
                btnInfo.el = document.getElementById(btnInfo.id);
                if (!btnInfo.el) {
                    // console.warn(`Attendance button ${btnInfo.id} not found.`);
                    return; // Skip if still not found
                }
            }

            // Remove existing listener to avoid stacking
            const newBtn = btnInfo.el.cloneNode(true);
            btnInfo.el.parentNode.replaceChild(newBtn, btnInfo.el);
            btnInfo.el = newBtn; // Re-assign the variable
            
            // Re-assign global variables
            if (btnInfo.id === 'fetchAttendanceBtn') fetchAttendanceBtn = newBtn;
            else if (btnInfo.id === 'bed-fetchAttendanceBtn') bedFetchAttendanceBtn = newBtn;
            else if (btnInfo.id === 'other-fetchAttendanceBtn') otherFetchAttendanceBtn = newBtn;

            if (importedAttendanceCourses.length > 0) {
                newBtn.innerHTML = '<i class="fa-solid fa-rotate-left me-2"></i>Revert Import';
                newBtn.className = 'btn btn-danger-action'; // Use danger for revert
                // Pass the button itself to the revert function
                newBtn.addEventListener('click', (e) => revertAttendanceImport(e.currentTarget));
                newBtn.disabled = false; // Ensure it's enabled
            } else {
                newBtn.innerHTML = '<i class="fa-solid fa-clipboard-user me-2"></i>Attendance System';
                newBtn.className = 'btn btn-success-action';
                // Pass the button itself to the fetch function
                newBtn.addEventListener('click', (e) => fetchAttendanceData(e.currentTarget));
                // Only disable if there is no processedData
                newBtn.disabled = !processedData;
            }
            
            // Re-apply styles
            newBtn.style.minWidth = '220px';
            newBtn.style.borderRadius = 'var(--radius-btn)';
        });
      }

      function revertAttendanceImport() {
        if (importedAttendanceCourses.length === 0) return;

        let revertedCount = 0;
        importedAttendanceCourses.forEach(imported => {
            const semester = processedData.semesters[imported.semester];
            if (semester) {
                const initialLength = semester.courses.length;
                semester.courses = semester.courses.filter(c => 
                    !(c.isCustom && c.source === 'attendance' && c.code === imported.code)
                );
                if (semester.courses.length < initialLength) {
                    revertedCount++;
                }
            }
        });
        
        showToast(`Reverted ${revertedCount} imported course(s)`, 'success');
        addStatusMessage(`Reverted import of ${revertedCount} courses`, 'info');
        
        importedAttendanceCourses = []; // Clear the list
        recalculateAndDisplay(); // This saves the profile
        setupAttendanceButton(); // Reset the button
      }

      function updateAttendanceCounts() {
        const listEl = document.getElementById('attendanceCourseList');
        const selectAllCheckbox = document.getElementById('toggleSelectAllCourses');
        const selectedCountEl = document.getElementById('attendanceSelectedCount');
        if (!listEl || !selectAllCheckbox || !selectedCountEl) return;

        const allVisibleCheckboxes = listEl.querySelectorAll('.attendance-course-item:not([style*="display: none"]) .form-check-input:not(:disabled)');
        const allVisibleChecked = listEl.querySelectorAll('.attendance-course-item:not([style*="display: none"]) .form-check-input:checked:not(:disabled)');

        const selected = allVisibleChecked.length;
        const totalVisible = allVisibleCheckboxes.length;
        
        selectedCountEl.textContent = `${selected} Selected`;

        if (totalVisible === 0) {
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
            selectAllCheckbox.disabled = true;
        } else {
            selectAllCheckbox.disabled = false;
            if (selected === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (selected === totalVisible) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }
      }
      
      

      // --- Handle modal stacking/blur visual effects ---
      function initModalZIndexHandlers() {
        // When Rename modal shows, blur Profile Manager
        renameProfileModalEl.addEventListener('show.bs.modal', function () {
            profileManagerModalEl.classList.add('blur-backdrop');
        });
        // When Rename modal hides, remove blur from Profile Manager
        renameProfileModalEl.addEventListener('hide.bs.modal', function () {
            profileManagerModalEl.classList.remove('blur-backdrop');
        });
        // When Confirmation modal shows, blur Profile Manager
        confirmationModalEl.addEventListener('show.bs.modal', function () {
            profileManagerModalEl.classList.add('blur-backdrop');
        });
        // When Confirmation modal hides, remove blur from Profile Manager
        confirmationModalEl.addEventListener('hide.bs.modal', function () {
            profileManagerModalEl.classList.remove('blur-backdrop');
        });
        // NEW: Blur main UI when attendance modal is open
        attendanceImportModalEl.addEventListener('show.bs.modal', function () {
            document.querySelector('.hero').style.filter = 'blur(4px)';
            document.querySelector('#Auto-Calculator').style.filter = 'blur(4px)';
        });
        attendanceImportModalEl.addEventListener('hide.bs.modal', function () {
            document.querySelector('.hero').style.filter = 'none';
            document.querySelector('#Auto-Calculator').style.filter = 'none';
        });
      }

      function migrateOldProfiles() {
          const oldProfilesData = localStorage.getItem('uafCalculatorProfiles');
          if (oldProfilesData) {
              try {
                  const oldProfiles = JSON.parse(oldProfilesData);
                  const newProfiles = getProfiles();
                  let migratedCount = 0;

                  Object.keys(oldProfiles).forEach(oldId => {
                      const oldProfile = oldProfiles[oldId];
                      const alreadyExists = Object.values(newProfiles).some(
                          p => p.studentInfo.registration === oldProfile.studentInfo.registration
                      );

                      if (!alreadyExists && oldProfile.studentInfo) {
                          const newProfile = {
                              ...oldProfile,
                              displayName: `${oldProfile.studentInfo.name} (${oldProfile.studentInfo.registration})`,
                              createdAt: new Date().toISOString(),
                              lastModified: new Date().toISOString()
                          };
                          const newId = `profile_${Date.now()}_${migratedCount}`;
                          newProfiles[newId] = newProfile;
                          migratedCount++;
                      }
                  });

                  if (migratedCount > 0) {
                      saveProfiles(newProfiles);
                      showToast(`${migratedCount} profile(s) from a previous version were successfully migrated!`, 'success');
                  }

                  localStorage.removeItem('uafCalculatorProfiles'); // Remove old data after migration
              } catch (e) {
                  console.error("Failed to migrate old profiles:", e);
              }
          }
      }

      function initScrollAnimations() {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.1 });
        document.querySelectorAll('.fade-in-on-scroll').forEach(el => observer.observe(el));
      }

      function getProfiles() {
        return JSON.parse(localStorage.getItem('uafCalculatorProfiles_v2') || '{}');
      }

      function saveProfiles(profiles) {
        localStorage.setItem('uafCalculatorProfiles_v2', JSON.stringify(profiles));
      }

      function getActiveProfileId() {
        return localStorage.getItem('uafCalculatorActiveProfile_v2');
      }

      function setActiveProfileId(id) {
        localStorage.setItem('uafCalculatorActiveProfile_v2', id);
      }

      function getBackupInfo() {
          return JSON.parse(localStorage.getItem('uafCalculatorBackupInfo') || '{}');
      }

      function saveBackupInfo(info) {
          localStorage.setItem('uafCalculatorBackupInfo', JSON.stringify(info));
      }

      function loadProfiles() {
        try { // <<< ADDED TRY within loadProfiles for more specific error handling
          const profiles = getProfiles();
          const activeProfileId = getActiveProfileId();
          updateProfileSwitcher(profiles, activeProfileId);

          if (activeProfileId && profiles[activeProfileId]) {
            loadProfile(activeProfileId); // This calls calculateCGPA and displayCGPAResults
            addStatusMessage('Loaded active profile from session.', 'info');
          } else if (activeProfileId) {
            // Active ID exists but profile doesn't - clear the invalid ID
            setActiveProfileId('');
            addStatusMessage('Cleared invalid active profile ID from session.', 'warning');
          }
        } catch (error) { // <<< ADDED CATCH
          console.error("Failed to load profiles:", error);
          showToast("Error loading saved profiles. Data might be corrupted.", "error");
          // Clear potentially corrupted storage
          localStorage.removeItem('uafCalculatorProfiles_v2');
          localStorage.removeItem('uafCalculatorActiveProfile_v2');
          // Attempt to recover by resetting UI elements related to profiles
          try {
              updateProfileSwitcher({}, ''); // Clear switcher
              profileManagementDiv.style.display = 'none';
              if(resultContainer) resultContainer.style.display = 'none'; // Hide results if loading failed
          } catch (uiError) {
              console.error("Error resetting UI after profile load failure:", uiError);
          }
        }
      }

      function updateProfileSwitcher(profiles, activeProfileId) {
        const profileKeys = Object.keys(profiles);
        const activeProfileUI = document.getElementById('activeProfileUI');
        const initialProfileUI = document.getElementById('initialProfileUI');
        
        // 1. Populate the switcher options (if profiles exist)
        if (profileKeys.length > 0) {
          profileSwitcher.innerHTML = '<option value="">Select a saved profile...</option>';
          profileKeys.forEach(profileId => {
            const profile = profiles[profileId];
            if (profile && profile.studentInfo) {
                const option = document.createElement('option');
                option.value = profileId;
                option.textContent = profile.displayName || `${profile.studentInfo.name} (${profile.studentInfo.registration})`;
                if (profileId === activeProfileId) {
                  option.selected = true;
                }
                profileSwitcher.appendChild(option);
            }
          });
        } else {
            profileSwitcher.innerHTML = '<option value="">No profiles found</option>';
        }

        // 2. Toggle UI Visibility
        // If we have saved profiles, show the Manager/Switcher.
        // If we have NO profiles (First time / All deleted), show the Import/Backup buttons.
        if (profileKeys.length > 0) {
            if(activeProfileUI) activeProfileUI.style.display = 'block';
            if(initialProfileUI) initialProfileUI.style.display = 'none';
        } else {
            if(activeProfileUI) activeProfileUI.style.display = 'none';
            if(initialProfileUI) initialProfileUI.style.display = 'block';
        }
      }

      function loadProfile(profileId) {
        const profiles = getProfiles();
        if (profiles[profileId]) {
          processedData = profiles[profileId];
          isInitialLoad = true;

          bedModeActive = processedData.bedMode || false; // --- NEW: Load B.Ed. preference

          renderResults(processedData); // --- MODIFIED: Call new render function
          
          registrationNumber.value = processedData.studentInfo.registration;
          setActiveProfileId(profileId);
          updateProfileSwitcher(profiles, profileId);
        }
      }

      function switchProfile(event) {
        const profileId = event.target.value;
        if (profileId) {
          loadProfile(profileId);
          showToast(`Switched to profile: ${getProfiles()[profileId].displayName}`, 'info');
        }
      }

      function saveActiveProfile() {
        const activeProfileId = getActiveProfileId();
        if (activeProfileId && processedData) {
            const profiles = getProfiles();
            if (profiles[activeProfileId]) {
                processedData.lastModified = new Date().toISOString();
                profiles[activeProfileId] = processedData;
                saveProfiles(profiles);
            }
        }
      }

      function openRenameModal(profileId) {
        const profiles = getProfiles();
        if (!profileId || !profiles[profileId]) {
            showToast('Invalid profile selected for rename.', 'warning');
            return;
        }
        document.getElementById('newProfileName').value = profiles[profileId].displayName;
        saveProfileNameBtn.dataset.profileId = profileId; // Store the ID
        renameProfileModal.show();
      }

      function renameProfile() {
          const profileId = saveProfileNameBtn.dataset.profileId;
          const newName = document.getElementById('newProfileName').value.trim();

          if (!newName) {
              showToast('Profile name cannot be empty.', 'error');
              return;
          }

          const profiles = getProfiles();
          // FIX: Iterate over keys (profile IDs) to correctly check for duplicates 
          // while ensuring the current profile (profileId) is excluded.
          const nameExists = Object.keys(profiles).some(currentId => 
              profiles[currentId].displayName === newName && currentId !== profileId
          );
          
          if (nameExists) {
              showToast('A profile with this name already exists.', 'error');
              return;
          }

          profiles[profileId].displayName = newName;
          profiles[profileId].lastModified = new Date().toISOString();
          saveProfiles(profiles);
          renameProfileModal.hide();
          showToast('Profile renamed successfully!', 'success');

          updateProfileSwitcher(profiles, getActiveProfileId());
          if (profileManagerModalEl.classList.contains('show')) {
              renderProfileManager();
          }
      }

      function showConfirmationModal(title, body, onConfirm) {
        document.getElementById('confirmationModalTitle').textContent = title;
        document.getElementById('confirmationModalBody').textContent = body;
        confirmationCallback = onConfirm;
        confirmationModal.show();
      }

      function handleConfirm() {
        if (typeof confirmationCallback === 'function') {
          confirmationCallback();
        }
        confirmationModal.hide();
        confirmationCallback = null;
      }

      // --- PROFILE MANAGER FUNCTIONS ---

      // NEW CODE (replace with this)
      function renderProfileManager() {
        const profiles = getProfiles();
        const profileListEl = document.getElementById('profileManagerList');
        const profileCountStat = document.getElementById('profileCountStat');
        const lastBackupStat = document.getElementById('lastBackupStat');

        // --- UPDATED: Sort profiles by lastModified date (Newest on Top) ---
        const profileKeys = Object.keys(profiles).sort((a, b) => {
            const dateA = new Date(profiles[a].lastModified || 0);
            const dateB = new Date(profiles[b].lastModified || 0);
            return dateB - dateA; // Descending order
        });
        // --- END UPDATE ---

        profileCountStat.textContent = `${profileKeys.length} Profile${profileKeys.length !== 1 ? 's' : ''}`;

        const backupInfo = getBackupInfo();
        lastBackupStat.textContent = backupInfo.lastBackup ? `Last Backup: ${new Date(backupInfo.lastBackup).toLocaleString()}` : 'Last Backup: Never';

        if (profileKeys.length === 0) {
            profileListEl.innerHTML = '<li class="text-center text-muted p-4">No profiles saved yet.</li>';
            // Disable buttons if list is empty
            document.getElementById('bulkActionsBtn').disabled = true;
            document.getElementById('exportProfilesBtnModal').disabled = true;
            document.getElementById('selectAllProfiles').checked = false;
            document.getElementById('selectAllProfiles').indeterminate = false;
            return;
        }

        profileListEl.innerHTML = profileKeys.map(id => {
            const profile = profiles[id];
            const lastModified = profile.lastModified ? new Date(profile.lastModified).toLocaleString() : 'N/A';
            let detailsHtml = '';

            // Check if this is a B.Ed. profile
            if (profile.bedMode) {
                // B.Ed. Profile Visualization
                const bedSemesters = filterSemesters(profile.semesters, true);
                const bedData = { ...profile, semesters: bedSemesters };
                const bedCgpa = calculateCGPA(bedData);
                const bedSemesterCount = Object.keys(bedData.semesters).length;
                const bedCourseCount = Object.values(bedData.semesters).reduce((sum, s) => sum + s.courses.length, 0);

                const otherSemesters = filterSemesters(profile.semesters, false);
                const otherData = { ...profile, semesters: otherSemesters };
                const otherCgpa = calculateCGPA(otherData);
                const otherSemesterCount = Object.keys(otherData.semesters).length;
                const otherCourseCount = Object.values(otherData.semesters).reduce((sum, s) => sum + s.courses.length, 0);

                detailsHtml = `
                  <div class="profile-item-name">${profile.displayName} <span class="badge bg-primary-subtle text-primary-emphasis rounded-pill ms-2" style="font-size: 0.7em;">B.Ed. Profile</span></div>
                  <div class="profile-item-meta" style="grid-column: 1 / -1;"><i class="fa-solid fa-id-card"></i> ${profile.studentInfo.registration}</div>
                  
                  <!-- B.Ed. Details -->
                  <div class="profile-item-meta" style="grid-column: 1 / -1; margin-top: 5px; padding-top: 5px; border-top: 1px solid rgba(122, 106, 216, 0.1);">
                    <strong class="small" style="color: var(--brand);">B.Ed. Program:</strong>
                  </div>
                  <div class="profile-item-meta" style="padding-left: 15px;"><i class="fa-solid fa-graduation-cap"></i> CGPA: ${bedCgpa.cgpa.toFixed(4)}</div>
                  <div class="profile-item-meta" style="padding-left: 15px;"><i class="fa-solid fa-book"></i> ${bedSemesterCount} Sem, ${bedCourseCount} Crs</div>

                  <!-- Other Details -->
                  <div class="profile-item-meta" style="grid-column: 1 / -1; margin-top: 5px; padding-top: 5px; border-top: 1px solid rgba(122, 106, 216, 0.1);">
                    <strong class="small" style="color: var(--brand);">Other Program:</strong>
                  </div>
                  <div class="profile-item-meta" style="padding-left: 15px;"><i class="fa-solid fa-graduation-cap"></i> CGPA: ${otherCgpa.cgpa.toFixed(4)}</div>
                  <div class="profile-item-meta" style="padding-left: 15px;"><i class="fa-solid fa-book"></i> ${otherSemesterCount} Sem, ${otherCourseCount} Crs</div>
                  
                  <div class="profile-item-meta" style="grid-column: 1 / -1; margin-top: 5px; padding-top: 5px; border-top: 1px solid rgba(122, 106, 216, 0.1);">
                    <i class="fa-solid fa-clock"></i> ${lastModified}
                  </div>
                `;

            } else {
                // Standard Profile Visualization
                const cgpaData = calculateCGPA(profile);
                const semesterCount = Object.keys(profile.semesters).length;
                const courseCount = Object.values(profile.semesters).reduce((sum, s) => sum + s.courses.length, 0);
                
                detailsHtml = `
                  <div class="profile-item-name">${profile.displayName}</div>
                  <div class="profile-item-meta"><i class="fa-solid fa-id-card"></i> ${profile.studentInfo.registration}</div>
                  <div class="profile-item-meta"><i class="fa-solid fa-graduation-cap"></i> CGPA: ${cgpaData.cgpa.toFixed(4)}</div>
                  <div class="profile-item-meta"><i class="fa-solid fa-book"></i> ${semesterCount} Semesters, ${courseCount} Courses</div>
                  <div class="profile-item-meta"><i class="fa-solid fa-clock"></i> ${lastModified}</div>
                `;
            }

            return `
              <li class="profile-item" data-profile-id="${id}">
                  <input class="form-check-input profile-checkbox" type="checkbox" value="${id}">
                  <div class="profile-item-details" style="${profile.bedMode ? 'grid-template-columns: repeat(2, 1fr);' : ''}">
                      ${detailsHtml}
                  </div>
                  <div class="profile-item-actions">
                      <button class="btn btn-sm btn-soft rounded-pill action-load" title="Load Profile"><i class="fa-solid fa-arrow-up-right-from-square"></i></button>
                      <button class="btn btn-sm btn-soft rounded-pill action-rename" title="Rename"><i class="fa-solid fa-pen"></i></button>
                      <button class="btn btn-sm btn-soft rounded-pill text-danger action-delete" title="Delete"><i class="fa-solid fa-trash"></i></button>
                  </div>
              </li>
            `;
        }).join('');

        // --- Attach event listeners for quick actions ---
        profileListEl.querySelectorAll('.action-load').forEach(btn => btn.addEventListener('click', e => {
            loadProfile(e.currentTarget.closest('.profile-item').dataset.profileId);
            profileManagerModal.hide();
        }));
        profileListEl.querySelectorAll('.action-rename').forEach(btn => btn.addEventListener('click', e => {
            openRenameModal(e.currentTarget.closest('.profile-item').dataset.profileId);
        }));
        profileListEl.querySelectorAll('.action-delete').forEach(btn => btn.addEventListener('click', e => {
            const profileId = e.currentTarget.closest('.profile-item').dataset.profileId;
            const profileName = profiles[profileId]?.displayName || 'this profile';
            showConfirmationModal('Delete Profile?', `Are you sure you want to delete "${profileName}"?`, () => {
                deleteProfiles([profileId]);
            });
        }));

        // Reset bulk action buttons
        document.getElementById('bulkActionsBtn').disabled = true;
        document.getElementById('exportProfilesBtnModal').disabled = true;
        document.getElementById('selectAllProfiles').checked = false;
        document.getElementById('selectAllProfiles').indeterminate = false;
      }

      function handleBulkAction() {
          const selectedIds = Array.from(document.querySelectorAll('.profile-checkbox:checked')).map(cb => cb.value);
          if (selectedIds.length === 0) {
              showToast('No profiles selected.', 'warning');
              return;
          }
          showConfirmationModal(`Delete ${selectedIds.length} Profiles?`, `This will permanently delete the selected profiles.`, () => {
              deleteProfiles(selectedIds);
          });
      }

      function deleteProfiles(idsToDelete) {
          const profiles = getProfiles();
          let deletedCount = 0;
          idsToDelete.forEach(id => {
              if (profiles[id]) {
                  delete profiles[id];
                  deletedCount++;
                  if (getActiveProfileId() === id) {
                      setActiveProfileId('');
                  }
              }
          });
          saveProfiles(profiles);
          showToast(`Successfully deleted ${deletedCount} profile(s).`, 'success');
          renderProfileManager();
          updateProfileSwitcher(profiles, getActiveProfileId());
          if (!getActiveProfileId()) {
              resultContainer.style.display = 'none';
              document.getElementById('bedResultContainer').style.display = 'none'; // Hide B.Ed. container
              registrationNumber.value = '';
          }
      }

      function exportSelectedProfiles() {
          const selectedIds = Array.from(document.querySelectorAll('#profileManagerList .profile-checkbox:checked')).map(cb => cb.value);
          const profiles = getProfiles();
          const profilesToExport = {};
          let exportCount = 0;
          let filename = `uaf-cgpa-profiles-backup-${new Date().toISOString().split('T')[0]}.json`; // Default filename

          if (selectedIds.length === 0) {
              showToast('No profiles selected to export. Please select profiles from the list.', 'warning');
              return;
          }

          selectedIds.forEach(id => {
              if (profiles[id]) {
                  profilesToExport[id] = profiles[id];
                  exportCount++;
              }
          });

          // Custom filename for single profile export
          if (exportCount === 1) {
              const singleProfileId = selectedIds[0];
              let profileName = 'profile'; 
              if (profiles[singleProfileId].displayName) {
                  profileName = profiles[singleProfileId].displayName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
              } else if (profiles[singleProfileId].studentInfo && profiles[singleProfileId].studentInfo.registration) {
                  profileName = profiles[singleProfileId].studentInfo.registration.replace(/[^a-z0-9]/gi, '_').toLowerCase();
              }
              filename = `${profileName}-profile-backup.json`;
          }

          const backupData = {
              version: '2.0.0',
              exportDate: new Date().toISOString(),
              profiles: profilesToExport
          };

          // --- FIXED EXPORT LOGIC ---
          const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
          
          // Workaround for Android WebView (Website 2 APK Builder)
          const reader = new FileReader();
          reader.readAsDataURL(blob);
          reader.onloadend = function() {
              const base64data = reader.result;
              
              // 1. Trigger the download via the Python helper
              forceAndroidDownload(filename, base64data);

              // 2. Update UI (moved inside here so it happens after download starts)
              saveBackupInfo({ lastBackup: new Date().toISOString() });
              showToast(`${exportCount} profile(s) exported.`, 'success');
              renderProfileManager();
          };
          // --- END FIXED LOGIC ---
      }


      function importProfiles() {
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.json';
          input.onchange = e => {
              const file = e.target.files[0];
              if (!file) return;
              const reader = new FileReader();
              reader.onload = event => {
                  try {
                      const importedData = JSON.parse(event.target.result);
                      
                      if (!importedData.profiles || importedData.version !== '2.0.0') {
                          throw new Error('Invalid or incompatible backup file.');
                      }

                      const existingProfiles = getProfiles();
                      let importedCount = 0, skippedCount = 0;

                      Object.keys(importedData.profiles).forEach(id => {
                          if (existingProfiles[id]) {
                              skippedCount++;
                          } else {
                              existingProfiles[id] = importedData.profiles[id];
                              importedCount++;
                          }
                      });

                      saveProfiles(existingProfiles);
                      showToast(`Import complete: ${importedCount} added, ${skippedCount} skipped.`, 'success');
                      loadProfiles(); // Reload profiles into switcher
                      if (profileManagerModalEl.classList.contains('show')) {
                        renderProfileManager(); // Re-render manager if open
                      }

                  } catch (error) {
                      showToast(`Import failed: ${error.message}`, 'error');
                      console.error('Import error:', error);
                  }
              };

              // --- FIX: Add onerror handler for file read errors ---
              reader.onerror = event => {
                  showToast('Failed to read the file. Please check the file and try again.', 'error');
                  console.error('FileReader error:', event.target.error);
              };
              // --- End of Fix ---

              reader.readAsText(file);
          };
          input.click();
      }

  // Function to force Android Download via Vercel Proxy
function forceAndroidDownload(filename, dataUri) {
    // Create a hidden form
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/api/download'; // Calls your new Python script
    form.style.display = 'none';

    // Add Filename
    const nameInput = document.createElement('input');
    nameInput.name = 'filename';
    nameInput.value = filename;
    form.appendChild(nameInput);

    // Add File Data
    const dataInput = document.createElement('input');
    dataInput.name = 'fileData';
    dataInput.value = dataUri;
    form.appendChild(dataInput);

    // Submit and Cleanup
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
} 
      // --- END OF PROFILE MANAGER FUNCTIONS ---

  
      function updateTotalsDisplay() {
        const cgpaData = calculateCGPA(processedData);
        if (!cgpaData) return;

        studentName.innerHTML = `<i class="fa-solid fa-user-graduate me-2"></i>${processedData.studentInfo.name}`;
        studentReg.textContent = processedData.studentInfo.registration;
        totalCgpa.textContent = formatNumber(cgpaData.cgpa).toFixed(4);
        totalPercentage.textContent = `${formatNumber(cgpaData.percentage, 2).toFixed(2)}%`;
        totalMarksObtained.textContent = cgpaData.totalMarksObtained.toFixed(0);
        totalMaxMarks.textContent = `/ ${cgpaData.totalMaxMarks.toFixed(0)}`;

        renderGpaChart();
        saveActiveProfile();
      }

      function initBackToTop() {
        window.addEventListener('scroll', () => backToTopButton.classList.toggle('visible', window.pageYOffset > 300));
        backToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
      }

      function createToastContainer() {
        if (!document.getElementById('toast-container')) {
          const toastContainer = document.createElement('div');
          toastContainer.id = 'toast-container';
          document.body.appendChild(toastContainer);
        }
      }

      function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        const icons = { success: 'fa-circle-check', error: 'fa-circle-exclamation', warning: 'fa-triangle-exclamation', info: 'fa-circle-info' };
        toast.innerHTML = `<div class="toast-content"><i class="toast-icon fa-solid ${icons[type]}"></i><span class="toast-message">${message}</span></div><div class="toast-progress"></div>`;
        toastContainer.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      function initCustomCursor() {
        document.addEventListener('mousemove', (e) => {
          cursorDot.style.display = window.innerWidth > 768 ? 'block' : 'none';
          cursorDot.style.left = `${e.clientX}px`;
          cursorDot.style.top = `${e.clientY}px`;
        });
      }

      // NEW initTheme function
function initTheme() {
  const THEME_KEY = 'uaf-theme';
  
  // Find BOTH the new mobile input and the new desktop button
  const themeToggleInput = document.getElementById('themeToggleInput');
  const themeToggleBtn = document.getElementById('themeToggleBtn');

  const applyTheme = (theme) => {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem(THEME_KEY, theme);
    
    const isDark = theme === 'dark';
    
    // 1. Set the state of the mobile toggle
    if (themeToggleInput) {
        themeToggleInput.checked = isDark;
    }
    
    // 2. Set the icon for the desktop button
    if (themeToggleBtn) {
        const iconClass = isDark ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        themeToggleBtn.innerHTML = `<i class="${iconClass}"></i>`;
    }
  };

  // Get the current theme and apply it
  const currentTheme = localStorage.getItem(THEME_KEY) || 'light'; // <--- THIS IS THE CHANGE
  applyTheme(currentTheme);

  // Function to handle the toggle logic
  const toggleLogic = () => {
    const newTheme = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    applyTheme(newTheme);
  };

  // Add event listeners to BOTH elements
  if (themeToggleInput) {
    themeToggleInput.addEventListener('change', toggleLogic); // Use 'change' for checkboxes
  }
  if (themeToggleBtn) {
    themeToggleBtn.addEventListener('click', toggleLogic); // Use 'click' for the button
  }
}

      function initContactForm() {
        contactForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          if (!contactForm.checkValidity()) {
            e.stopPropagation();
            contactForm.classList.add('was-validated');
            return;
          }
          const data = new FormData(contactForm);
          const statusEl = document.getElementById('contact-form-status');
          try {
            const res = await fetch(contactForm.action, { method: 'POST', body: data, headers: { 'Accept': 'application/json' } });
            if (res.ok) {
              statusEl.textContent = "Thanks! We'll get back to you soon.";
              statusEl.className = "text-success small";
              contactForm.reset();
              contactForm.classList.remove('was-validated');
              showToast('Message sent successfully!', 'success');
            } else {
              throw new Error('Form submission failed');
            }
          } catch {
            statusEl.textContent = "Oops! There was a problem. Please try again.";
            statusEl.className = "text-danger small";
            showToast('Failed to send message.', 'error');
          }
        });
      }

      function addStatusMessage(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        allLogs.push({ timestamp, message, type });
        const messageEl = document.createElement('div');
        messageEl.className = `status-line status-${type}`;
        messageEl.textContent = `[${timestamp}] ${message}`;
        statusLog.prepend(messageEl);
        statusLog.scrollTop = 0;
      }

      function showLoadingStage(stage) {
        ['connecting', 'fetching', 'processing', 'complete'].forEach(s => {
          const el = document.getElementById(`${s}Stage`);
          if (el) el.style.display = 'none';
        });
        if (stage) {
            const el = document.getElementById(`${stage}Stage`);
            if (el) el.style.display = 'block';
        }
        loadingContainer.style.display = stage ? 'block' : 'none';
      }

      function downloadLog() {
        addStatusMessage('Preparing log file for download...', 'info');
        let logContent = "UAF CGPA Calculator - M SAQLAIN - Activity Log\n============================================\n\n";
        allLogs.forEach(log => logContent += `[${log.timestamp}] ${log.message}\n`);
        const blob = new Blob([logContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `cgpa_calculator_log_${new Date().toISOString().replace(/[:.]/g, '-')}.txt`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        addStatusMessage('Log file downloaded successfully', 'success');
        showToast('Log file downloaded!', 'success');
      }

      function clearLog() {
        statusLog.innerHTML = '';
        allLogs = [];
        addStatusMessage('Log cleared', 'info');
        showToast('Log cleared', 'info');
      }

      // --- 
      // --- UPDATED processSemesterName Function ---
      // --- 
      // ---
      // --- UPDATED processSemesterName Function ---
      // ---
      function processSemesterName(semester) {
          if (!semester) return 'Unknown Semester';

          const semesterLower = semester.toLowerCase();

          // Regex to match "YYYY-YY" or "YYYY-YYYY"
          const yearRangeMatch = semesterLower.match(/(\d{4})-(\d{2,4})/);
          // Regex to match a single 4-digit year
          const singleYearMatch = semesterLower.match(/\b(\d{4})\b/);

          let season = 'Unknown';
          let year = '';

          if (semesterLower.includes('spring')) {
              season = 'Spring';
              if (yearRangeMatch) {
                  year = yearRangeMatch[2]; // "25" or "2025"
                  // Ensure it's a 4-digit year
                  if (year.length === 2) {
                      year = `20${year}`; // "25" -> "2025"
                  }
              } else if (singleYearMatch) {
                  // If only a single year is present for Spring, assume it's the latter year
                  year = (parseInt(singleYearMatch[1]) + 1).toString();
              }
          } else if (semesterLower.includes('winter')) {
              season = 'Winter';
              if (yearRangeMatch) {
                  year = yearRangeMatch[1]; // "2024"
              } else if (singleYearMatch) {
                  year = singleYearMatch[1];
              }
          } else if (semesterLower.includes('summer')) {
              season = 'Summer';
              // Summer usually belongs to the first year of the range or the single year mentioned
              if (yearRangeMatch) {
                  year = yearRangeMatch[1]; // "2024"
              } else if (singleYearMatch) {
                  year = singleYearMatch[1];
              }
          } else if (semesterLower.includes('fall')) {
              season = 'Fall';
              // Fall usually belongs to the first year of the range or the single year mentioned
              if (yearRangeMatch) {
                  year = yearRangeMatch[1]; // "2024"
              } else if (singleYearMatch) {
                  year = singleYearMatch[1];
              }
          }

          // If a season and year were found, return them
          if (season !== 'Unknown' && year) {
              return `${season} ${year}`;
          }

          // Fallback logic for non-standard formats like "Winter20", "Spring24" etc. from attendance
          // Converts "SeasonYY" directly to "Season 20YY"
          const attendanceMatch = semesterLower.match(/^(winter|spring|summer|fall)(\d{2})$/);
          if (attendanceMatch) {
              const season = attendanceMatch[1].charAt(0).toUpperCase() + attendanceMatch[1].slice(1); // Capitalize season
              const yearYY = attendanceMatch[2];
              return `${season} 20${yearYY}`; // e.g., Spring 2024
          }

          // Default fallback (original string, capitalized) if no other pattern matches
          return semester.charAt(0).toUpperCase() + semester.slice(1);
      }

      function getSemesterOrderKey(processedSemesterName) {
        // Takes the processed name like "Winter 2020" or "Spring 2021"
        if (!processedSemesterName) return '9999-9'; // Ensure unknowns sort last

        const semesterLower = processedSemesterName.toLowerCase();

        // Handle Forecast semesters - place them far in the future
        if (semesterLower.startsWith('forecast')) {
            const num = parseInt(semesterLower.split(' ')[1] || '1');
            // Ensure proper numerical sorting for multiple forecasts
            return `3000-${num.toString().padStart(2, '0')}`;
        }

        let year = 0;
        let seasonOrder = 9; // Default for unknowns

        const yearMatch = semesterLower.match(/\b(\d{4})\b/); // Match the 4-digit year
        if (yearMatch) {
            year = parseInt(yearMatch[1]);
        } else {
            return '9999-9'; // Cannot determine year, sort last
        }

        let academicYearStart = year;

        // Determine season order and adjust academic year start for Spring/Summer
        if (semesterLower.includes('winter')) {
            seasonOrder = 1;
            academicYearStart = year; // Winter 2020 belongs to AY starting 2020
        } else if (semesterLower.includes('spring')) {
            seasonOrder = 2;
            academicYearStart = year - 1; // Spring 2021 belongs to AY starting 2020
        } else if (semesterLower.includes('summer')) {
            seasonOrder = 3;
            academicYearStart = year - 1; // Summer 2021 belongs to AY starting 2020
        } else if (semesterLower.includes('fall')) {
             // Assuming Fall starts the *next* academic cycle relative to Summer
             // Fall 2021 would belong to AY starting 2021
            seasonOrder = 4;
            academicYearStart = year;
        } else {
             seasonOrder = 9; // Unknown season type
             academicYearStart = year;
        }

        // Format: YYYY-S (e.g., 2020-1, 2020-2, 2020-3, 2021-1)
        return `${academicYearStart}-${seasonOrder}`;
      }

      function processScrapedData(data) {
        if (!data || !data.resultData) return null;
        const studentInfo = { name: data.resultData[0]?.StudentName || '', registration: data.resultData[0]?.RegistrationNo || '' };
        const semesters = {};
        const courseHistory = {};
        
        let hasBedCourses = false; // --- NEW B.Ed. Flag ---

        data.resultData.forEach(course => {
          const originalSemester = course.Semester || 'Unknown Semester';
          const semesterName = processSemesterName(originalSemester);
          const courseCode = (course.CourseCode || '').trim().toUpperCase();
          const historyKey = courseCode;

          // --- NEW B.Ed. Check ---
          const isBedCourse = BED_COURSES.has(courseCode); // <-- MODIFIED: Store this check
          if (isBedCourse) {
            hasBedCourses = true;
          }
          // --- End of NEW B.Ed. Check ---

          if (!semesters[semesterName]) {
            // Pass the *processed* semesterName to getSemesterOrderKey
            semesters[semesterName] = { 
              originalName: originalSemester, 
              sortKey: getSemesterOrderKey(semesterName), 
              courses: [],
              hasBedCourses: false,    // <-- ADD THIS
              hasOtherCourses: false   // <-- ADD THIS
            };
          }

          // --- ADD THIS BLOCK ---
          // Tag the semester with the type of course it contains
          if (isBedCourse) {
            semesters[semesterName].hasBedCourses = true;
          } else {
            semesters[semesterName].hasOtherCourses = true;
          }
          // --- END ADDED BLOCK ---

          const creditHoursStr = course.CreditHours || '0';
          const creditHours = parseInt(creditHoursStr.match(/\d+/)?.[0] || '0');
          const marks = parseFloat(course.Total || '0');

          // Pass the grade to the QP calculation
          let qualityPoints = calculateQualityPoints(marks, creditHours, course.Grade);

          // This 'if' block is now redundant if 'F' is handled in calculateQualityPoints,
          // but we can leave it as a safeguard.
          if (course.Grade === 'F') {
            qualityPoints = 0;
          }

          // --- 
          // --- UPDATED courseData Object ---
          // --- 
          const courseData = {
            code: courseCode,
            title: course.CourseTitle || '',
            creditHours: creditHours,
            creditHoursDisplay: creditHoursStr,
            marks: marks,
            qualityPoints: qualityPoints,
            grade: course.Grade || '',
            teacher: course.TeacherName || '',
            mid: course.Mid || '0',
            assignment: course.Assignment || '0',
            final: course.Final || '0',
            practical: course.Practical || '0',
            isExtraEnrolled: false,
            isRepeated: false,
            isDeleted: false,
            isCustom: false,
            originalSemester: originalSemester // <-- THIS LINE WAS ADDED
          };

          if (!courseHistory[historyKey]) {
            courseHistory[historyKey] = [];
          }
          courseHistory[historyKey].push({ semester: semesterName, semesterSortKey: getSemesterOrderKey(semesterName), marks: marks, data: courseData });
          semesters[semesterName].courses.push(courseData);
        });

        Object.values(courseHistory).forEach(history => {
          if (history.length > 1) {
            history.sort((a, b) => a.semesterSortKey.localeCompare(b.semesterSortKey));

            const passedCourses = history.filter(item => item.data.grade !== 'F');
            let bestAttempt;

            if (passedCourses.length > 0) {
              bestAttempt = passedCourses.reduce((prev, current) => (prev.marks > current.marks) ? prev : current);
            } else {
              bestAttempt = history.reduce((prev, current) => (prev.marks > current.marks) ? prev : current);
            }

            history.forEach(item => {
              item.data.isRepeated = true;
              if (item !== bestAttempt) {
                item.data.isExtraEnrolled = true;
              } else {
                item.data.isExtraEnrolled = false;
              }
            });
          }
        });

        // --- NEW: Return the flag ---
        return { studentInfo, semesters, courseHistory, hasBedCourses };
      }

      function calculateQualityPoints(marks, creditHours, grade) {
        marks = parseFloat(marks);
        creditHours = parseInt(creditHours);
        
        // Handle P/F grades first (Request 2)
        grade = (grade || '').trim().toUpperCase();
        if (grade === 'P') {
            return parseFloat(creditHours) * 4.0;
        }
        if (grade === 'F') {
            return 0;
        }

        // Keep existing marks-based logic as a fallback
        let qualityPoints = 0;
        if (creditHours === 10) {
            if (marks >= 160) qualityPoints = 40;
            else if (marks >= 100) qualityPoints = 40 - ((160 - marks) * 0.33333);
            else if (marks < 100) qualityPoints = 20 - ((100 - marks) * 0.5);
            if (marks < 80) qualityPoints = 0;
        } else if (creditHours === 9) {
            if (marks >= 144) qualityPoints = 36;
            else if (marks >= 90) qualityPoints = 36 - ((144 - marks) * 0.33333);
            else if (marks < 90) qualityPoints = 18 - ((90 - marks) * 0.5);
            if (marks < 72) qualityPoints = 0;
        } else if (creditHours === 8) {
            if (marks >= 128) qualityPoints = 32;
            else if (marks >= 80) qualityPoints = 32 - ((128 - marks) * 0.33333);
            else if (marks < 80) qualityPoints = 16 - ((80 - marks) * 0.5);
            if (marks < 64) qualityPoints = 0;
        } else if (creditHours === 7) {
            if (marks >= 112) qualityPoints = 28;
            else if (marks >= 70) qualityPoints = 28 - ((112 - marks) * 0.33333);
            else if (marks < 70) qualityPoints = 14 - ((70 - marks) * 0.5);
            if (marks < 56) qualityPoints = 0;
        } else if (creditHours === 6) {
            if (marks >= 96) qualityPoints = 24;
            else if (marks >= 60) qualityPoints = 24 - ((96 - marks) * 0.33333);
            else if (marks < 60) qualityPoints = 12 - ((60 - marks) * 0.5);
            if (marks < 48) qualityPoints = 0;
        } else if (creditHours === 5) {
            if (marks >= 80) qualityPoints = 20;
            else if (marks >= 50) qualityPoints = 20 - ((80 - marks) * 0.33333);
            else if (marks < 50) qualityPoints = 10 - ((50 - marks) * 0.5);
            if (marks < 40) qualityPoints = 0;
        } else if (creditHours === 4) {
            if (marks >= 64) qualityPoints = 16;
            else if (marks >= 40) qualityPoints = 16 - ((64 - marks) * 0.33333);
            else if (marks < 40) qualityPoints = 8 - ((40 - marks) * 0.5);
            if (marks < 32) qualityPoints = 0;
        } else if (creditHours === 3) {
            if (marks >= 48) qualityPoints = 12;
            else if (marks >= 30) qualityPoints = 12 - ((48 - marks) * 0.33333);
            else if (marks < 30) qualityPoints = 6 - ((30 - marks) * 0.5);
            if (marks < 24) qualityPoints = 0;
        } else if (creditHours === 2) {
            if (marks >= 32) qualityPoints = 8;
            else if (marks >= 20) qualityPoints = 8 - ((32 - marks) * 0.33333);
            else if (marks < 20) qualityPoints = 4 - ((20 - marks) * 0.5);
            if (marks < 16) qualityPoints = 0;
        } else if (creditHours === 1) {
            if (marks >= 16) qualityPoints = 4;
            else if (marks >= 10) qualityPoints = 4 - ((16 - marks) * 0.33333);
            else if (marks < 10) qualityPoints = 2 - ((10 - marks) * 0.5);
            if (marks < 8) qualityPoints = 0;
        }
        return parseFloat(Math.max(0, qualityPoints).toFixed(2));
      }

      function calculateCustomGrade(marks, creditHours) {
        const grading = { 10: { A: 160, B: 130, C: 100, D: 80 }, 9: { A: 144, B: 117, C: 90, D: 72 }, 8: { A: 128, B: 104, C: 80, D: 64 }, 7: { A: 112, B: 91, C: 70, D: 56 }, 6: { A: 96, B: 78, C: 60, D: 48 }, 5: { A: 80, B: 65, C: 50, D: 40 }, 4: { A: 64, B: 52, C: 40, D: 32 }, 3: { A: 48, B: 39, C: 30, D: 24 }, 2: { A: 32, B: 26, C: 20, D: 16 }, 1: { A: 16, B: 13, C: 10, D: 8 } };
        const scale = grading[creditHours];
        if (!scale) return 'F';
        if (marks >= scale.A) return 'A'; if (marks >= scale.B) return 'B';
        if (scale.C && marks >= scale.C) return 'C'; if (marks >= scale.D) return 'D';
        return 'F';
      }

      function calculateCGPA(data) {
        if (!data) return null;
        let totalQualityPoints = 0, totalCreditHours = 0, totalMarksObtained = 0, totalMaxMarks = 0;
        
        // Re-evaluate course history for repeated courses *every time* we calculate
        const courseHistory = {};
        Object.entries(data.semesters).forEach(([semesterName, semester]) => {
            semester.courses.forEach(course => {
                if (course.isDeleted) return; // Skip deleted courses entirely
                
                const historyKey = course.code.toUpperCase().trim();
                if (!courseHistory[historyKey]) {
                    courseHistory[historyKey] = [];
                }
                courseHistory[historyKey].push({
                    semester: semesterName,
                    semesterSortKey: semester.sortKey,
                    marks: course.marks,
                    data: course // Direct reference to the course object
                });
            });
        });

        // Reset all 'isExtraEnrolled' flags
        Object.values(courseHistory).flat().forEach(item => item.data.isExtraEnrolled = false);

        // Set 'isExtraEnrolled' flags based on current data
        Object.values(courseHistory).forEach(history => {
            if (history.length > 1) {
                history.sort((a, b) => a.semesterSortKey.localeCompare(b.semesterSortKey));
                const passedCourses = history.filter(item => item.data.grade !== 'F');
                let bestAttempt;

                if (passedCourses.length > 0) {
                    bestAttempt = passedCourses.reduce((prev, current) => (prev.marks > current.marks) ? prev : current);
                } else { // All attempts are 'F'
                    bestAttempt = history.reduce((prev, current) => (prev.marks > current.marks) ? prev : current);
                }

                history.forEach(item => {
                    item.data.isRepeated = true; // Mark all as repeated
                    if (item !== bestAttempt) {
                        item.data.isExtraEnrolled = true; // Mark non-best attempts
                    }
                });
            } else if (history.length === 1) {
                 history[0].data.isRepeated = false; // Not repeated if only one instance
            }
        });


        // Now calculate totals// Now calculate totals
        Object.values(data.semesters).forEach(semester => {
            // 1. Global Counters (Strict: Excludes repeats) - For Final CGPA
            semester.totalQualityPoints = 0;
            semester.totalCreditHours = 0;
            semester.totalMarksObtained = 0;
            semester.totalMaxMarks = 0;

            // 2. Semester Counters (Inclusive: Includes repeats) - For Card Display
            let semActualQP = 0;
            let semActualCH = 0;
            let semActualObtained = 0;
            let semActualMax = 0;

            semester.courses.forEach(course => {
                // RULE 1: Real-time Manipulation
                // If the user deleted the course, skip it entirely for BOTH calculations.
                if (course.isDeleted) return; 

                // Common Max Marks Logic
                let maxMarks;
                if ((course.grade || '').trim().toUpperCase() === 'P') {
                    if (course.creditHours === 1) maxMarks = 100;
                    else maxMarks = course.marks;
                } else {
                     maxMarks = { 10: 200, 9: 180, 8: 160, 7: 140, 6: 120, 5: 100, 4: 80, 3: 60, 2: 40, 1: 20 }[course.creditHours] || 0;
                }

                // RULE 2: Semester Card Display (Includes Repeats/Extra Enrolled)
                // Since we passed the delete check above, we include EVERYTHING here.
                semActualQP += course.qualityPoints;
                semActualCH += course.creditHours;
                semActualObtained += course.marks;
                semActualMax += maxMarks;

                // RULE 3: Global CGPA Calculation (Strictly Excludes Repeats)
                // Only add to the official global totals if it is NOT an extra enrollment.
                if (!course.isExtraEnrolled) {
                    semester.totalQualityPoints += course.qualityPoints;
                    semester.totalCreditHours += course.creditHours;
                    semester.totalMarksObtained += course.marks;
                    semester.totalMaxMarks += maxMarks;

                    // Add to Global Totals
                    totalQualityPoints += course.qualityPoints;
                    totalCreditHours += course.creditHours;
                    totalMarksObtained += course.marks;
                    totalMaxMarks += maxMarks;
                }
            });

            // Set the Semester Card display values using the ACTUAL (inclusive) counters
            semester.gpa = semActualCH > 0 ? (semActualQP / semActualCH) : 0;
            semester.percentage = semActualMax > 0 ? (semActualObtained / semActualMax * 100) : 0;
        });

        const cgpa = totalCreditHours > 0 ? (totalQualityPoints / totalCreditHours) : 0;
        const percentage = totalMaxMarks > 0 ? (totalMarksObtained / totalMaxMarks * 100) : 0;
        return { cgpa, percentage, totalQualityPoints, totalCreditHours, totalMarksObtained, totalMaxMarks };
      }

      function formatNumber(value, places = 4) { return parseFloat(value.toFixed(places)); }

      // --- NEW Function: Renders semester cards into a specific container ---
      function displaySemesterCards(containerId, data) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.innerHTML = '';
        Object.keys(data.semesters).sort((a,b) => data.semesters[a].sortKey.localeCompare(data.semesters[b].sortKey)).forEach(semesterName => {
          const semester = data.semesters[semesterName];
          
          // --- FIX ---
          // Safety check: Don't render a semester if its course list is missing.
          // We no longer hide empty non-forecast semesters, as this fixes the drag-and-drop bug.
          if (!semester.courses) {
              return;
          }
          // Check if it's a forecast semester (still needed for other logic)
          const isForecastSemester = semester.isForecast === true;
          // --- END FIX ---
          
          const semesterCard = document.createElement('div');
          
          semesterCard.dataset.semester = semesterName;

          const animationClass = isInitialLoad ? 'fade-in-on-scroll' : 'is-visible';
          semesterCard.className = `semester-card ${animationClass}`;

          semesterCard.dataset.semester = semesterName;
          
          const isForecastOrCustom = semesterName.toLowerCase().startsWith('forecast') || 
                                     !Object.values(processedData.courseHistory).flat().some(c => c.semester === semesterName && !c.data.isCustom);
          
          semesterCard.innerHTML = `
            <i class="fa-solid fa-trash delete-semester" title="Delete this semester" data-semester="${semesterName}"></i>
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="mb-0 d-flex align-items-center">
                <i class="fa-solid fa-book-open me-2" style="color: var(--brand);"></i>
                <span id="semester-name-${semester.sortKey}">${semesterName}</span>
                
                ${isForecastOrCustom ? `<i class="fa-solid fa-pencil edit-semester-name" title="Rename semester" data-semester="${semesterName}" style="cursor: pointer; margin-left: 10px; font-size: 0.9em; color: var(--muted);"></i>` : ''}
                </h5>
              <div class="text-end" style="margin-right: 40px;">
                <p class="mb-0 text-body-secondary small">GPA:</p>
                <p class="mb-0 h4 fw-bold" style="color: var(--brand);">${formatNumber(semester.gpa).toFixed(4)}</p>
                <p class="mb-0 text-body-secondary small">${formatNumber(semester.percentage, 2).toFixed(2)}%</p>
              </div>
            </div>
            <button class="custom-course-btn" data-semester="${semesterName}"><i class="fa-solid fa-plus"></i> Custom Course</button>
            <div class="table-responsive"><table class="course-table"><thead><tr><th>Course</th><th>Hrs</th><th>Marks</th><th>Grade</th><th>Action</th></tr></thead>
              <tbody>${semester.courses.map((course, index) => {
                  const courseIdentifier = `${semesterName}-${course.code}-${course.total}-${index}`;
                  const courseTitle = course.title || (course.isCustom ? 'Custom Course' : 'N/A');
                  return `
                  <tr data-course-identifier="${courseIdentifier}" draggable="true" class="${course.isExtraEnrolled ? 'table-warning' : ''} ${course.isDeleted ? 'table-danger text-decoration-line-through' : ''} ${course.isCustom ? 'table-info' : ''}">
                    <td>
                      <div class="course-code-container">
                        <span class="fw-medium course-code clickable-info" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}'>
                          ${course.code}
                          <i class="fa-solid fa-info-circle ms-1 clickable-info small" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}' title="${courseTitle}"></i>
                        </span>
                        ${course.isExtraEnrolled ? '<sup class="extra-enrolled">Rep.</sup>' : ''}
                        ${course.isCustom && course.source === 'attendance' ? '<sup class="extra-enrolled" style="color: #087990; background-color: #cff4fc;">Atnd.</sup>' : ''}
                        ${course.isCustom && course.source !== 'attendance' ? '<span class="extra-enrolled">Custom</span>' : ''}
                      </div>
                    </td>
                    <td>${course.creditHoursDisplay || course.creditHours}</td><td>${course.marks}</td>
                    <td><span class="grade-badge grade-${course.grade}">${course.grade}</span></td>
                    <td class="course-actions">${course.isDeleted ? `<i class="fa-solid fa-rotate-left restore-course" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}' data-semester="${semesterName}" title="Restore"></i>` : `<i class="fa-solid fa-trash delete-course" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}' data-semester="${semesterName}" title="Delete"></i>`}</td>
                  </tr>`;
              }).join('')}</tbody>
            </table></div>`;
          container.appendChild(semesterCard);
        });

        isInitialLoad = false;
        // Note: We call attachResultEventListeners() *after* this function finishes
      }

      function displayCGPAResults(data, cgpaData) {
        processedData = data;
        resultContainer.style.display = 'block';

        // 1. Update the main CGPA card
        studentName.innerHTML = `<i class="fa-solid fa-user-graduate me-2"></i>${data.studentInfo.name}`;
        studentReg.textContent = data.studentInfo.registration;
        totalCgpa.textContent = formatNumber(cgpaData.cgpa).toFixed(4);
        totalPercentage.textContent = `${formatNumber(cgpaData.percentage, 2).toFixed(2)}%`;
        totalMarksObtained.textContent = cgpaData.totalMarksObtained.toFixed(0);
        totalMaxMarks.textContent = `/ ${cgpaData.totalMaxMarks.toFixed(0)}`;

        const cgpaCircle = document.getElementById('cgpaCircle');
        if(cgpaCircle) {
            const cgpa = parseFloat(totalCgpa.textContent);
            const percentage = (cgpa / 4.0) * 100;
            setTimeout(() => {
                cgpaCircle.style.strokeDasharray = `${percentage}, 100`;
            }, 100);
        }

        // 2. Render the semester cards into the *standard* container
        displaySemesterCards('semesterResults', data);

        // 3. Attach listeners
        attachResultEventListeners();

        // 4. Render chart and setup buttons
        renderGpaChart();
        
        const hasAttendanceCourses = Object.values(data.semesters).some(s => s.courses.some(c => c.isCustom && c.source === 'attendance'));
        if (!hasAttendanceCourses) {
             importedAttendanceCourses = [];
        }
        importedAttendanceCourses = [];
        setupAttendanceButton();
      }

      // --- NEW Function: Renders the B.Ed. tabbed interface ---
      function displayBedResults(data) {
        processedData = data; // *** FIX: Set global processedData, just like displayCGPAResults does ***
        // 1. Filter for B.Ed. results
        const bedSemesters = filterSemesters(data.semesters, true);
        const bedData = { ...data, semesters: bedSemesters };
        const bedCgpa = calculateCGPA(bedData);

        // 2. Filter for "Other" results
        const otherSemesters = filterSemesters(data.semesters, false);
        const otherData = { ...data, semesters: otherSemesters };
        const otherCgpa = calculateCGPA(otherData);

        // --- NEW: Populate Student Info Headers (Fixes Bug) ---
        document.getElementById('bed-studentName').innerHTML = `<i class="fa-solid fa-user-graduate me-2"></i>${data.studentInfo.name}`;
        document.getElementById('bed-studentReg').textContent = data.studentInfo.registration;
        document.getElementById('other-studentName').innerHTML = `<i class="fa-solid fa-user-graduate me-2"></i>${data.studentInfo.name}`;
        document.getElementById('other-studentReg').textContent = data.studentInfo.registration;
        // --- END NEW ---

        // 3. Render the "B.Ed." tab content
        document.getElementById('bed-totalCgpa').textContent = bedCgpa.cgpa.toFixed(4);
        document.getElementById('bed-totalPercentage').textContent = `${bedCgpa.percentage.toFixed(2)}%`;
        document.getElementById('bed-totalMarksObtained').textContent = bedCgpa.totalMarksObtained.toFixed(0);
        document.getElementById('bed-totalMaxMarks').textContent = `/ ${bedCgpa.totalMaxMarks.toFixed(0)}`;
        const bedCircle = document.getElementById('bed-cgpaCircle');
        if (bedCircle) {
            const bedPercentage = (bedCgpa.cgpa / 4.0) * 100;
            setTimeout(() => bedCircle.style.strokeDasharray = `${bedPercentage}, 100`, 100);
        }
        displaySemesterCards('bed-semesterResults', bedData);

        // 4. Render the "Other" tab content
        document.getElementById('other-totalCgpa').textContent = otherCgpa.cgpa.toFixed(4);
        document.getElementById('other-totalPercentage').textContent = `${otherCgpa.percentage.toFixed(2)}%`;
        document.getElementById('other-totalMarksObtained').textContent = otherCgpa.totalMarksObtained.toFixed(0);
        document.getElementById('other-totalMaxMarks').textContent = `/ ${otherCgpa.totalMaxMarks.toFixed(0)}`;
        const otherCircle = document.getElementById('other-cgpaCircle');
        if (otherCircle) {
            const otherPercentage = (otherCgpa.cgpa / 4.0) * 100;
            setTimeout(() => otherCircle.style.strokeDasharray = `${otherPercentage}, 100`, 100);
        }
        displaySemesterCards('other-semesterResults', otherData);

        // 5. --- MODIFIED: Render GPA charts ---
        // Hide the main chart container, which is for non-B.Ed. mode
        gpaChartContainer.style.display = 'none'; 
        // Render the two new charts
        renderBedGpaCharts(bedData.semesters, otherData.semesters);

        // 6. Attach listeners to all new elements
        attachResultEventListeners();

        // 7. Setup attendance button
        setupAttendanceButton();
      }

      // --- NEW Function: Renders either Normal or B.Ed. UI ---
      function renderResults(data) {
        const bedResultContainer = document.getElementById('bedResultContainer');
        
        // Get all the "standard view" elements by their specific IDs/Classes
        const standardGpaCard = document.querySelector('#resultContainer > .gpa-result-card-premium');
        // Get the parent div of the button
        const standardAttendanceBtnDiv = document.getElementById('fetchAttendanceBtn').parentElement; 
        const standardGpaChart = document.getElementById('gpaChartContainer');
        const standardActionButtons = document.querySelector('#resultContainer > .action-buttons-aligned');
        // Get the parent div of the semester grid
        const standardSemesterContainer = document.getElementById('semesterResults').parentElement; 

        if (bedModeActive) {
          // Hide Normal View elements
          if (standardGpaCard) standardGpaCard.style.display = 'none';
          if (standardAttendanceBtnDiv) standardAttendanceBtnDiv.style.display = 'none'; // Hide main button div
          if (standardGpaChart) standardGpaChart.style.display = 'none';
          if (standardActionButtons) standardActionButtons.style.display = 'none';
          if (standardSemesterContainer) standardSemesterContainer.style.display = 'none'; // Hide the container

          // Show B.Ed. Tabbed View
          bedResultContainer.style.display = 'block';
          displayBedResults(data); // This will render the B.Ed. content
        } else {
          // Show Normal View elements
          if (standardGpaCard) standardGpaCard.style.display = 'block';
          if (standardAttendanceBtnDiv) standardAttendanceBtnDiv.style.display = 'block'; // Show main button div
          if (standardGpaChart) standardGpaChart.style.display = 'block';
          if (standardActionButtons) standardActionButtons.style.display = 'flex'; // Use flex for alignment
          if (standardSemesterContainer) standardSemesterContainer.style.display = 'block'; // Show the container

          // Hide B.Ed. Tabbed View
          bedResultContainer.style.display = 'none';
          
          const cgpaData = calculateCGPA(data); // Calculate single, overall CGPA
          displayCGPAResults(data, cgpaData); // Call original display function
        }
      }

      // --- NEW Function: Filters semesters into B.Ed. or Other ---
      function filterSemesters(semesters, includeBed) {
        const filteredSemesters = {};
        
        Object.entries(semesters).forEach(([semesterName, semester]) => {
          // This is the list of courses that *will be displayed* in this tab
          const newCourseList = [];
          
          // --- START FINAL FIX ---
          // Check if the identity flags exist. If not, calculate them.
          // This makes the function work for old profiles loaded from storage.
          let hasBedCourses = semester.hasBedCourses;
          let hasOtherCourses = semester.hasOtherCourses;

          if (hasBedCourses === undefined || hasOtherCourses === undefined) {
            // Flags are missing (old profile), calculate them now.
            hasBedCourses = false;
            hasOtherCourses = false;
            semester.courses.forEach(course => {
              if (BED_COURSES.has(course.code.toUpperCase().trim())) {
                hasBedCourses = true;
              } else {
                hasOtherCourses = true;
              }
            });
            // We'll also check all *other* semesters in processedData
            // in case the course was dragged to another semester
            if (processedData && processedData.semesters) {
                Object.values(processedData.semesters).forEach(s => {
                    s.courses.forEach(c => {
                        // If a course *originally* from this semester is now elsewhere
                        if (c.originalSemester === semester.originalName) {
                            if (BED_COURSES.has(c.code.toUpperCase().trim())) {
                                hasBedCourses = true;
                            } else {
                                hasOtherCourses = true;
                            }
                        }
                    });
                });
            }
          }
          // --- END FINAL FIX ---

          // Now, iterate *again* just to build the *display list*
          semester.courses.forEach(course => {
            const isBedCourse = BED_COURSES.has(course.code.toUpperCase().trim());
            
            if (includeBed && isBedCourse) {
              newCourseList.push(course); // Add to display list for B.Ed. tab
            } else if (!includeBed && !isBedCourse) {
              newCourseList.push(course); // Add to display list for Other tab
            }
          });

          const isForecast = semester.isForecast === true;
          const isBedForecast = semester.isBedForecast === true;

          let shouldBeInThisTab = false;

          if (includeBed) { // We are filtering FOR B.Ed. tab
            // Semester belongs here if it has B.Ed. courses OR is a B.Ed. forecast
            shouldBeInThisTab = hasBedCourses || (isForecast && isBedForecast);
          } else { // We are filtering FOR "Other" tab
            // Semester belongs here if it has Other courses OR is an "Other" forecast
            shouldBeInThisTab = hasOtherCourses || (isForecast && !isBedForecast);
          }
          
          // If the semester belongs in this tab (even if its newCourseList is now empty)
          if (shouldBeInThisTab) {
            filteredSemesters[semesterName] = {
                ...semester,
                courses: newCourseList // This list might be empty, which is what we want
            };
          }
        });
        return filteredSemesters;
      }

      // --- NEW Function: Handles B.Ed. Modal Choice ---
      function handleBedConfirm(isBedStudent, processed) {
        if(bedConfirmationModal) bedConfirmationModal.hide();
        bedModeActive = isBedStudent;
        processed.bedMode = isBedStudent; // Save preference to profile

        // This logic is moved from fetchResult()
        const profiles = getProfiles();
        const studentInfo = processed.studentInfo;
        let baseName = `${studentInfo.name} (${studentInfo.registration})`;
        let finalName = baseName;
        let copyNum = 1;

        const allDisplayNames = Object.values(profiles).map(p => p.displayName);

        while(allDisplayNames.includes(finalName)) {
            finalName = `${baseName} - ${copyNum++}`;
        }

        processed.displayName = finalName;
        processed.createdAt = new Date().toISOString();
        processed.lastModified = new Date().toISOString();
        const newProfileId = `profile_${Date.now()}`;
        profiles[newProfileId] = processed;
        saveProfiles(profiles);
        setActiveProfileId(newProfileId);

        processedData = processed; // *** FIX: Set the global processedData variable ***

        showLoadingStage('complete');
        setTimeout(() => {
          renderResults(processed); // --- MODIFIED: Call new render function
          showLoadingStage(null);
          showToast('New profile created successfully!', 'success');
          updateProfileSwitcher(profiles, newProfileId);
        }, 1000);
      }

      function renderGpaChart() {
          if (!processedData || Object.keys(processedData.semesters).length === 0) {
              gpaChartContainer.style.display = 'none';
              return;
          }

          if (gpaChart) {
              gpaChart.destroy();
          }

          const sortedSemesters = Object.entries(processedData.semesters)
              .sort(([, a], [, b]) => a.sortKey.localeCompare(b.sortKey));

          const labels = sortedSemesters.map(([name]) => name);
          const gpaData = sortedSemesters.map(([, semester]) => formatNumber(semester.gpa, 4));

          const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
          const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
          const fontColor = isDarkMode ? '#e5e7eb' : '#4b5563';

          gpaChart = new Chart(gpaTrendChartCanvas, {
              type: 'line',
              data: {
                  labels: labels,
                  datasets: [{
                      label: 'Semester GPA',
                      data: gpaData,
                      fill: true,
                      backgroundColor: 'rgba(122, 106, 216, 0.2)',
                      borderColor: 'rgba(122, 106, 216, 1)',
                      tension: 0.3,
                      pointBackgroundColor: 'rgba(122, 106, 216, 1)',
                      pointBorderColor: '#fff',
                      pointHoverRadius: 7,
                      pointHoverBackgroundColor: '#fff',
                      pointHoverBorderColor: 'rgba(122, 106, 216, 1)'
                  }]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  scales: {
                      y: {
                          beginAtZero: true,
                          suggestedMax: 4.0,
                          ticks: { color: fontColor },
                          grid: { color: gridColor }
                      },
                      x: {
                          ticks: { color: fontColor },
                          grid: { color: gridColor }
                      }
                  },
                  plugins: {
                      legend: { display: false },
                      tooltip: {
                          backgroundColor: isDarkMode ? '#1b1f24' : '#fff',
                          titleColor: isDarkMode ? '#fff' : '#1b1f24',
                          bodyColor: isDarkMode ? '#d1d5db' : '#4b5563',
                          borderColor: 'rgba(122, 106, 216, 0.5)',
                          borderWidth: 1,
                          padding: 10,
                          callbacks: {
                              label: context => `GPA: ${context.parsed.y.toFixed(4)}`
                          }
                      }
                  },
                  animation: {
                      duration: 1000,
                      easing: 'easeInOutQuart'
                  }
              }
          });
          gpaChartContainer.style.display = 'block';
      }

          function renderBedGpaCharts(bedSemesters, otherSemesters) {
        const bedChartContainer = document.getElementById('bedGpaChartContainer');
        const otherChartContainer = document.getElementById('otherGpaChartContainer');
        const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
        const fontColor = isDarkMode ? '#e5e7eb' : '#4b5563';
        
        // Re-usable options for both charts
        const chartOptions = {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
              y: { beginAtZero: true, suggestedMax: 4.0, ticks: { color: fontColor }, grid: { color: gridColor } },
              x: { ticks: { color: fontColor }, grid: { color: gridColor } }
          },
          plugins: {
              legend: { display: false },
              tooltip: {
                  backgroundColor: isDarkMode ? '#1b1f24' : '#fff',
                  titleColor: isDarkMode ? '#fff' : '#1b1f24',
                  bodyColor: isDarkMode ? '#d1d5db' : '#4b5563',
                  borderColor: 'rgba(122, 106, 216, 0.5)',
                  borderWidth: 1,
                  padding: 10,
                  callbacks: { label: context => `GPA: ${context.parsed.y.toFixed(4)}` }
              }
          },
          animation: { duration: 1000, easing: 'easeInOutQuart' }
        };

        // Render B.Ed. Chart
        if (bedGpaChart) bedGpaChart.destroy(); // Destroy previous chart
        const sortedBedSemesters = Object.entries(bedSemesters).sort(([, a], [, b]) => a.sortKey.localeCompare(b.sortKey));
        if (sortedBedSemesters.length > 0) {
            bedChartContainer.style.display = 'block';
            bedGpaChart = new Chart(document.getElementById('bedGpaTrendChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: sortedBedSemesters.map(([name]) => name),
                    datasets: [{
                        label: 'B.Ed. GPA',
                        data: sortedBedSemesters.map(([, semester]) => formatNumber(semester.gpa, 4)),
                        fill: true,
                        backgroundColor: 'rgba(122, 106, 216, 0.2)', // Brand color
                        borderColor: 'rgba(122, 106, 216, 1)',
                        tension: 0.3
                    }]
                },
                options: chartOptions
            });
        } else {
            bedChartContainer.style.display = 'none'; // Hide if no data
        }

        // Render Other Chart
        if (otherGpaChart) otherGpaChart.destroy(); // Destroy previous chart
        const sortedOtherSemesters = Object.entries(otherSemesters).sort(([, a], [, b]) => a.sortKey.localeCompare(b.sortKey));
        if (sortedOtherSemesters.length > 0) {
            otherChartContainer.style.display = 'block';
            otherGpaChart = new Chart(document.getElementById('otherGpaTrendChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: sortedOtherSemesters.map(([name]) => name),
                    datasets: [{
                        label: 'Other GPA',
                        data: sortedOtherSemesters.map(([, semester]) => formatNumber(semester.gpa, 4)),
                        fill: true,
                        backgroundColor: 'rgba(255, 107, 107, 0.2)', // Use Accent color
                        borderColor: 'rgba(255, 107, 107, 1)',
                        tension: 0.3
                    }]
                },
                options: chartOptions
            });
        } else {
            otherChartContainer.style.display = 'none'; // Hide if no data
        }
      }
          

      function attachResultEventListeners() {
        document.querySelectorAll('.clickable-info').forEach(el => el.addEventListener('click', e => showCourseDetails(JSON.parse(e.currentTarget.dataset.course.replace(/&#39;/g, "'")))));
        document.querySelectorAll('.delete-semester').forEach(btn => btn.addEventListener('click', e => deleteSemester(e, e.currentTarget.dataset.semester)));
        document.querySelectorAll('.custom-course-btn').forEach(btn => btn.addEventListener('click', e => openAddCourseModal(e.currentTarget.dataset.semester)));
        
        // --- START: NEW LISTENER FOR PENCIL ICON ---
        document.querySelectorAll('.edit-semester-name').forEach(btn => {
          btn.addEventListener('click', e => openRenameSemesterModal(e.currentTarget.dataset.semester));
        });
        // --- END: NEW LISTENER ---

        if(document.getElementById('copyDetailsIconBtn')) {
            document.getElementById('copyDetailsIconBtn').addEventListener('click', copyDetailsToClipboard);
        }
        document.querySelectorAll('.delete-course').forEach(btn => {
          const course = JSON.parse(btn.dataset.course.replace(/&#39;/g, "'"));
          btn.addEventListener('click', e => modifyCourseState(e, course, btn.dataset.semester, true));
        });
        document.querySelectorAll('.restore-course').forEach(btn => {
          const course = JSON.parse(btn.dataset.course.replace(/&#39;/g, "'"));
          btn.addEventListener('click', e => modifyCourseState(e, course, btn.dataset.semester, false));
        });
        document.querySelectorAll('.semester-card.fade-in-on-scroll:not(.is-visible)').forEach(el => {
            const observer = new IntersectionObserver(entries => {
                if (entries[0].isIntersecting) {
                    entries[0].target.classList.add('is-visible');
                    observer.unobserve(entries[0].target);
                }
            }, { threshold: 0.1 });
            observer.observe(el);
        });
        if (window.innerWidth >= 992) {
          initDragAndDrop();
        }
      }

      function initDragAndDrop() {
          const draggables = document.querySelectorAll('.course-table tr[draggable="true"]');
          const droppables = document.querySelectorAll('.semester-card');

          draggables.forEach(draggable => {
              draggable.addEventListener('dragstart', e => {
                  e.target.classList.add('dragging');
                  const sourceSemester = e.target.closest('.semester-card').dataset.semester;
                  const courseIdentifier = e.target.dataset.courseIdentifier;
                  e.dataTransfer.setData('text/plain', JSON.stringify({ courseIdentifier, sourceSemester }));
              });
              draggable.addEventListener('dragend', e => {
                  e.target.classList.remove('dragging');
              });
          });

          droppables.forEach(droppable => {
              droppable.addEventListener('dragover', e => {
                  e.preventDefault();
                  e.currentTarget.classList.add('drag-over');
              });
              droppable.addEventListener('dragleave', e => {
                  e.currentTarget.classList.remove('drag-over');
              });
              droppable.addEventListener('drop', e => {
                  e.preventDefault();
                  e.currentTarget.classList.remove('drag-over');

                  const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                  const targetSemester = e.currentTarget.dataset.semester;

                  if (data.sourceSemester === targetSemester) {
                      return;
                  }

                  let courseToMove = null;
                  let courseIndex = -1;

                  // Find the course based on its unique identifier
                  const sourceSemesterCourses = processedData.semesters[data.sourceSemester]?.courses;
                  if (sourceSemesterCourses) {
                      courseIndex = sourceSemesterCourses.findIndex((course, index) => {
                          const identifier = `${data.sourceSemester}-${course.code}-${course.total}-${index}`;
                          return identifier === data.courseIdentifier;
                      });
                      if (courseIndex !== -1) {
                          courseToMove = sourceSemesterCourses[courseIndex];
                      }
                  }


                  if (courseToMove && courseIndex > -1) {
                      // --- B.Ed. Drag/Drop Logic ---
                      const isBedCourse = BED_COURSES.has(courseToMove.code.toUpperCase().trim());
                      const targetIsBedTab = e.currentTarget.closest('#bed-tab-content');
                      const targetIsOtherTab = e.currentTarget.closest('#other-tab-content');
                      
                      // Check if the drop is valid in B.Ed. mode
                      if (bedModeActive) {
                          if (isBedCourse && targetIsOtherTab) {
                              showToast(`Cannot move B.Ed. course (${courseToMove.code}) to "Other" tab.`, 'warning');
                              return;
                          }
                          if (!isBedCourse && targetIsBedTab) {
                              showToast(`Cannot move non-B.Ed. course (${courseToMove.code}) to "B.Ed." tab.`, 'warning');
                              return;
                          }
                      }
                      // --- End of B.Ed. Logic ---

                      sourceSemesterCourses.splice(courseIndex, 1); // Remove from source
                      processedData.semesters[targetSemester].courses.push(courseToMove); // Add to target
                      recalculateAndDisplay(); // Update UI
                      showToast(`Moved ${courseToMove.code} to ${targetSemester}`, 'success');
                      addStatusMessage(`Moved course ${courseToMove.code} from ${data.sourceSemester} to ${targetSemester}`, 'info');
                  } else {
                      showToast('Could not move course. Data might be out of sync.', 'error');
                      console.error('Course mismatch or not found. Identifier:', data.courseIdentifier, 'Index:', courseIndex);
                  }
              });
          });
      }

      // ---
      // --- REVISED showCourseDetails Function (UI/UX Improv. & Fixes) ---
      // ---
      function showCourseDetails(course) {
        // --- Fix 1: Semester Name Formatting ---
        let formattedSemester = course.originalSemester || 'Unknown Semester';
        // Remove " Semester" and format year range (e.g., "Winter Semester 2020-2021" -> "Winter 2020-21")
        formattedSemester = formattedSemester.replace(' Semester', ''); // Remove " Semester"
        formattedSemester = formattedSemester.replace(/(\d{4})-(\d{4})/, (match, y1, y2) => `${y1}-${y2.substring(2)}`); // Format year range

        // Set Modal Title
        document.getElementById('courseDetailsModalTitle').textContent = `${course.code} - ${course.title || 'N/A'}`;

        // --- Fix 2 & UI Improvement: Modal Body Structure ---
        const modalBody = document.getElementById('courseDetailsModalBody');
        modalBody.innerHTML = `
          <div class="mb-3 border-bottom pb-3">
            <h6 class="text-muted fw-bold small text-uppercase mb-2">Details</h6>
            <div class="row g-2">
              <div class="col-12 col-sm-6">
                <p class="mb-1 small"><i class="fa-solid fa-chalkboard-user fa-fw me-2 text-primary"></i><strong>Teacher:</strong> ${course.teacher || 'N/A'}</p>
              </div>
              <div class="col-12 col-sm-6">
                <p class="mb-1 small"><i class="fa-solid fa-calendar-alt fa-fw me-2 text-primary"></i><strong>Semester:</strong> ${formattedSemester}</p>
              </div>
              <div class="col-12">
                 <p class="mb-0 small"><i class="fa-solid fa-hourglass-half fa-fw me-2 text-primary"></i><strong>Credit Hours:</strong> ${course.creditHoursDisplay || course.creditHours}</p>
              </div>
            </div>
          </div>

          <div class="mb-3 border-bottom pb-3">
            <h6 class="text-muted fw-bold small text-uppercase mb-2">Marks Breakdown</h6>
            <div class="row g-2">
              <div class="col-6 col-sm-3">
                <p class="mb-1 small text-center text-sm-start"><i class="fa-solid fa-file-pen fa-fw me-1 text-info"></i><strong>Mid:</strong> ${course.mid || 'N/A'}</p>
              </div>
              <div class="col-6 col-sm-3">
                <p class="mb-1 small text-center text-sm-start"><i class="fa-solid fa-clipboard fa-fw me-1 text-info"></i><strong>Assign:</strong> ${course.assignment || 'N/A'}</p>
              </div>
              <div class="col-6 col-sm-3">
                 <p class="mb-1 small text-center text-sm-start"><i class="fa-solid fa-flag-checkered fa-fw me-1 text-info"></i><strong>Final:</strong> ${course.final || 'N/A'}</p>
              </div>
               ${course.practical && course.practical !== '0' ? `
                 <div class="col-6 col-sm-3">
                   <p class="mb-1 small text-center text-sm-start"><i class="fa-solid fa-flask-vial fa-fw me-1 text-info"></i><strong>Prac:</strong> ${course.practical}</p>
                 </div>
               ` : ''}
            </div>
          </div>

          <div>
             <h6 class="text-muted fw-bold small text-uppercase mb-2">Result</h6>
             <div class="d-flex flex-wrap justify-content-around align-items-center bg-light rounded p-2" style="background-color: rgba(122, 106, 216, 0.05) !important;">
                 <div class="text-center px-2">
                     <span class="small text-muted">Total Marks</span>
                     <p class="fs-5 fw-bold mb-0 text-primary">${course.marks !== undefined ? course.marks : 'N/A'}</p>
                 </div>
                 <div class="text-center px-2">
                     <span class="small text-muted">Grade</span>
                     <p class="fs-5 mb-0"><span class="grade-badge grade-${course.grade}">${course.grade || 'N/A'}</span></p>
                 </div>
                 <div class="text-center px-2">
                     <span class="small text-muted">Quality Points</span>
                     <p class="fs-5 fw-bold mb-0 text-primary">${course.qualityPoints !== undefined ? course.qualityPoints.toFixed(2) : 'N/A'}</p>
                 </div>
             </div>
          </div>

          ${course.isExtraEnrolled ? `<div class="alert alert-warning d-flex align-items-center mt-3 small p-2"><i class="fa-solid fa-info-circle me-2"></i> This is a repeated course attempt, and its marks are not the highest achieved. It does not count towards the CGPA calculation shown.</div>` : ''}
          ${course.isRepeated && !course.isExtraEnrolled ? `<div class="alert alert-success d-flex align-items-center mt-3 small p-2"><i class="fa-solid fa-check-circle me-2"></i> This is the highest scoring attempt for this repeated course and is used in CGPA calculation.</div>` : ''}
          ${course.isCustom ? `<div class="alert alert-info d-flex align-items-center mt-3 small p-2"><i class="fa-solid fa-pencil me-2"></i> This is a custom course added manually${course.source === 'attendance' ? ' (imported from Attendance System)' : ''}.</div>` : ''}`;

        courseDetailsModal.show();
      }

      function openAddCourseModal(semesterName) {
        document.getElementById('addCourseSemester').value = semesterName;
        addCourseForm.reset();
        addCourseModal.show();
      }

      function addCustomCourse() {
        const semesterName = document.getElementById('addCourseSemester').value;
        const courseCode = document.getElementById('courseCode').value.trim().toUpperCase();
        const courseTitle = document.getElementById('courseTitle').value.trim();
        const creditHours = parseInt(document.getElementById('creditHours').value);
        const marks = parseFloat(document.getElementById('courseMarks').value);
        
        // REMOVED !courseTitle to make it optional
        if (!courseCode || !creditHours || isNaN(marks)) {
          showToast('Please fill all fields correctly', 'error');
          return;
        }
        
        // UPDATED marks range to 0-200
        if (marks < 0 || marks > 200) {
             showToast('Marks must be between 0 and 200', 'error');
             return;
        }
        
        // --- B.Ed. Validation ---
        if (bedModeActive) {
            const isBedCourse = BED_COURSES.has(courseCode);
            const currentTab = document.querySelector('#bedTab .nav-link.active').id;
            
            if (isBedCourse && currentTab === 'other-tab') {
                showToast(`Cannot add B.Ed. course (${courseCode}) to "Other" tab.`, 'warning');
                return;
            }
            if (!isBedCourse && currentTab === 'bed-tab') {
                showToast(`Cannot add non-B.Ed. course (${courseCode}) to "B.Ed." tab.`, 'warning');
                return;
            }
        }
        // --- End of B.Ed. Validation ---

        const grade = calculateCustomGrade(marks, creditHours);
        const qualityPoints = calculateQualityPoints(marks, creditHours, grade);

        const newCourse = {
            code: courseCode, 
            title: courseTitle, // Empty string is fine, it will fallback to 'Custom Course' in display
            creditHours, 
            creditHoursDisplay: `${creditHours}(${creditHours}-0)`, 
            marks,
            qualityPoints: qualityPoints, 
            grade: grade,
            semesterName, teacher: 'Custom', mid: 'N/A', assignment: 'N/A', final: marks, practical: 'N/A', total: marks,
            isExtraEnrolled: false, isRepeated: false, isDeleted: false, isCustom: true, originalSemester: semesterName 
        };

         // Check if course already exists (non-deleted) in the same semester
        const semester = processedData.semesters[semesterName];
        if (semester && semester.courses.some(c => !c.isDeleted && c.code.toUpperCase() === newCourse.code)) {
            showToast(`Course ${newCourse.code} already exists in ${semesterName}. Edit or delete the existing one first.`, 'warning');
            return;
        }

        processedData.semesters[semesterName].courses.push(newCourse);
        recalculateAndDisplay();
        addCourseModal.hide();
        showToast(`Course ${courseCode} added`, 'success');
        addStatusMessage(`Added custom course: ${courseCode} to ${semesterName}`, 'info');
      }

      function deleteSemester(event, semesterName) {
        event.preventDefault();
        if (!processedData || !processedData.semesters[semesterName]) return;

        deletedSemesters[semesterName] = JSON.parse(JSON.stringify(processedData.semesters[semesterName]));
        delete processedData.semesters[semesterName];

        recalculateAndDisplay();

        showUndoNotification(`Semester "${semesterName}" deleted`, () => undoDeleteSemester(semesterName));
        addStatusMessage(`Deleted semester: ${semesterName}`, 'info');
      }

      function showUndoNotification(message, undoCallback) {
        document.getElementById('undo-notification')?.remove();
        const notification = document.createElement('div');
        notification.id = 'undo-notification';
        notification.className = 'undo-notification';
        notification.innerHTML = `<span>${message}</span> <button class="undo-btn">Undo</button>`;
        document.body.appendChild(notification);
        notification.querySelector('.undo-btn').onclick = () => {
            undoCallback();
            notification.remove();
        };
        setTimeout(() => notification.remove(), 5000);
      }

      function undoDeleteSemester(semesterName) {
        if (!deletedSemesters[semesterName]) return;

        processedData.semesters[semesterName] = deletedSemesters[semesterName];
        delete deletedSemesters[semesterName];

        recalculateAndDisplay();
        addStatusMessage(`Restored semester: ${semesterName}`, 'info');
      }

      function modifyCourseState(event, course, semesterName, isDeleted) {
        event.preventDefault();
        const semester = processedData.semesters[semesterName];
        if (!semester) return;

        // Find course using a more robust comparison, including custom status
        const courseIndex = semester.courses.findIndex(c =>
            c.code === course.code &&
            c.title === course.title &&
            c.creditHours === course.creditHours &&
            c.marks === course.marks &&
            c.isCustom === course.isCustom // Crucial for distinguishing identical custom courses
        );


        if (courseIndex !== -1) {
          semester.courses[courseIndex].isDeleted = isDeleted;
          recalculateAndDisplay();
          const action = isDeleted ? 'Deleted' : 'Restored';
          showToast(`Course ${course.code} ${action.toLowerCase()}`, 'info');
          addStatusMessage(`${action} course: ${course.code} from ${semesterName}`, 'info');
        } else {
          console.error("Could not find course to modify state:", course, "in semester:", semesterName);
          showToast(`Error modifying course ${course.code}`, 'error');
        }
      }


      function recalculateAndDisplay() {
        saveActiveProfile();
        // Re-render the entire UI based on the current mode and modified data
        renderResults(processedData);
      }

      function addForecastSemester() {
        // --- NEW: Check which tab is active ---
        let isForBedTab = false;
        if (bedModeActive) {
            const activeTabId = document.querySelector('#bedTab .nav-link.active').id;
            if (activeTabId === 'bed-tab') {
                isForBedTab = true;
            }
        }
        // --- END NEW ---

        let forecastCount = 1;
        while (`Forecast ${forecastCount}` in processedData.semesters) {
            forecastCount++;
        }
        const newSemesterName = `Forecast ${forecastCount}`;
        processedData.semesters[newSemesterName] = {
            originalName: newSemesterName,
            sortKey: getSemesterOrderKey(newSemesterName),
            courses: [],
            isForecast: true,
            isBedForecast: isForBedTab // <-- ADD THIS NEW FLAG
        };
        
        recalculateAndDisplay(); // This renders the new card
        showToast(`Added "${newSemesterName}"`, 'success');
        addStatusMessage(`Added forecast semester: ${newSemesterName}`, 'info');

        // --- START: NEW SCROLL-TO-ELEMENT LOGIC ---
        setTimeout(() => {
          const newCard = document.querySelector(`[data-semester="${newSemesterName}"]`);
          if (newCard) {
            newCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Optional: Add a subtle flash animation
            newCard.style.transition = 'background-color 0.5s ease-out';
            newCard.style.backgroundColor = 'rgba(122, 106, 216, 0.1)';
            setTimeout(() => {
                newCard.style.backgroundColor = '';
            }, 1000);
          }
        }, 100); // Small delay to ensure DOM is updated
        // --- END: NEW SCROLL-TO-ELEMENT LOGIC ---
      }

      // NEW CODE (replace with this)
      function openRenameSemesterModal(oldSemesterName) {
        if (!processedData.semesters[oldSemesterName]) return;
        document.getElementById('newSemesterName').value = oldSemesterName;
        saveSemesterNameBtn.dataset.oldName = oldSemesterName; // Store old name
        renameSemesterModal.show();
      }

      // ADD THIS NEW FUNCTION (e.g., after openRenameSemesterModal)
      function renameSemester() {
        const oldSemesterName = saveSemesterNameBtn.dataset.oldName;
        const newSemesterName = document.getElementById('newSemesterName').value.trim();

        if (!newSemesterName || newSemesterName === "") {
          showToast("Semester name cannot be empty.", 'warning');
          return;
        }

        if (newSemesterName === oldSemesterName) {
          renameSemesterModal.hide();
          return;
        }

        if (processedData.semesters[newSemesterName]) {
          showToast(`Semester name "${newSemesterName}" already exists.`, 'error');
          return;
        }

        // Rename: Copy data, delete old, update properties
        processedData.semesters[newSemesterName] = processedData.semesters[oldSemesterName];
        delete processedData.semesters[oldSemesterName];
        
        processedData.semesters[newSemesterName].originalName = newSemesterName;
        processedData.semesters[newSemesterName].sortKey = getSemesterOrderKey(newSemesterName);
        // The isForecast flag is automatically carried over
        
        recalculateAndDisplay();
        renameSemesterModal.hide();
        showToast(`Semester renamed to "${newSemesterName}"`, 'success');
        addStatusMessage(`Renamed semester "${oldSemesterName}" to "${newSemesterName}"`, 'info');
      }
      
      function copyDetailsToClipboard() {
          if (!processedData) return;
          const textToCopy = `Name: ${processedData.studentInfo.name}\nRegistration: ${processedData.studentInfo.registration}\nCGPA: ${totalCgpa.textContent}\nPercentage: ${totalPercentage.textContent}`;
          navigator.clipboard.writeText(textToCopy).then(() => {
              showToast('Details copied to clipboard!', 'success');
          }, (err) => {
              showToast('Failed to copy details.', 'error');
              console.error('Clipboard copy failed: ', err);
          });
      }

      function generatePDF() {
        if (!processedData) {
            showToast('No data to download', 'error');
            return;
        }

        // --- B.Ed. PDF Logic ---
        // Determine which dataset to use for the PDF
        let dataToPrint, titleSuffix;
        if (bedModeActive) {
            const activeTabId = document.querySelector('#bedTab .nav-link.active').id;
            if (activeTabId === 'bed-tab') {
                const bedSemesters = filterSemesters(processedData.semesters, true);
                dataToPrint = { ...processedData, semesters: bedSemesters };
                titleSuffix = 'B.Ed. Program';
            } else { // 'other-tab'
                const otherSemesters = filterSemesters(processedData.semesters, false);
                dataToPrint = { ...processedData, semesters: otherSemesters };
                titleSuffix = 'Other Programs';
            }
        } else {
            // Normal mode, print all
            dataToPrint = processedData;
            titleSuffix = 'Overall';
        }
        // --- End of B.Ed. PDF Logic ---


        addStatusMessage(`Generating premium PDF report (${titleSuffix})...`, 'info');
        showLoadingStage('processing');

        try {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
            
            // --- Use the *calculated* CGPA for the selected dataset ---
            const cgpaData = calculateCGPA(dataToPrint);

            const pageMargin = 15;
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const availableWidth = pageWidth - (2 * pageMargin);
            const colors = {
                primary: '#7a6ad8',
                textDark: '#1b1f24',
                textLight: '#4b5563',
                line: '#e0e0e0',
                fillLight: '#f8f9ff',
            };
            let lastY = 0;

            const drawFirstPageHeader = () => {
                pdf.setFontSize(18);
                pdf.setTextColor(colors.primary);
                pdf.setFont('helvetica', 'bold');
                pdf.text("University of Agriculture Faisalabad (UAF)", pageWidth / 2, 20, { align: 'center' });

                pdf.setFontSize(12);
                pdf.setTextColor(colors.textLight);
                pdf.setFont('helvetica', 'normal');
                
                // --- PDF TITLE CHANGE ---
                let transcriptTitle = "Unofficial Academic Transcript";
                if (titleSuffix === 'B.Ed. Program') {
                    transcriptTitle += ` (${titleSuffix})`; // Only add suffix for B.Ed.
                }
                pdf.text(transcriptTitle, pageWidth / 2, 28, { align: 'center' });
                // --- END PDF TITLE CHANGE ---

                pdf.setDrawColor(colors.primary);
                pdf.setLineWidth(0.5);
                pdf.line(pageMargin, 35, pageWidth - pageMargin, 35);
                lastY = 35;
            };

            drawFirstPageHeader();

            const topBoxY = lastY + 10;
            const boxHeight = 45;
            const gap = 5;
            const leftBoxWidth = availableWidth * 0.4;
            const rightBoxWidth = availableWidth - leftBoxWidth - gap;
            const rightBoxX = pageMargin + leftBoxWidth + gap;

            pdf.setFillColor(colors.fillLight);
            pdf.roundedRect(pageMargin, topBoxY, leftBoxWidth, boxHeight, 3, 3, 'F');
            pdf.setFontSize(11);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(colors.textDark);
            pdf.text("Student Information", pageMargin + 5, topBoxY + 8);
            pdf.setDrawColor(colors.line);
            pdf.line(pageMargin + 5, topBoxY + 11, pageMargin + leftBoxWidth - 5, topBoxY + 11);

            pdf.setFontSize(12);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(colors.primary);
            pdf.text(dataToPrint.studentInfo.name, pageMargin + 5, topBoxY + 25, { maxWidth: leftBoxWidth - 10 });

            pdf.setFontSize(8);
            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(colors.textLight);
            pdf.text(dataToPrint.studentInfo.registration, pageMargin + 5, topBoxY + 30);

            pdf.setFillColor(colors.fillLight);
            pdf.roundedRect(rightBoxX, topBoxY, rightBoxWidth, boxHeight, 3, 3, 'F');
            pdf.setFontSize(11);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(colors.textDark);
            
            // --- PDF ACADEMIC SUMMARY CHANGE ---
            pdf.text(`Academic Summary`, rightBoxX + 5, topBoxY + 8); 
            // --- END PDF ACADEMIC SUMMARY CHANGE ---
            
            pdf.line(rightBoxX + 5, topBoxY + 11, rightBoxX + rightBoxWidth - 5, topBoxY + 11);

            pdf.setFontSize(22);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(colors.primary);
            pdf.text(formatNumber(cgpaData.cgpa, 4).toFixed(4), rightBoxX + 5, topBoxY + 25);
            pdf.setFontSize(8);
            pdf.setTextColor(colors.textLight);
            
            // --- PDF CGPA LABEL CHANGE ---
            pdf.text(`Overall CGPA`, rightBoxX + 5, topBoxY + 29); 
            // --- END PDF CGPA LABEL CHANGE ---

            const statsStartX = rightBoxX + 40;
            pdf.setFont('helvetica', 'bold');
            pdf.text("Percentage:", statsStartX, topBoxY + 20);
            pdf.text("Total Credits:", statsStartX, topBoxY + 28);
            pdf.text("Total Marks:", statsStartX, topBoxY + 36);

            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(colors.textDark);
            pdf.text(`${formatNumber(cgpaData.percentage, 2).toFixed(2)}%`, statsStartX + 25, topBoxY + 20);
            pdf.text(cgpaData.totalCreditHours.toString(), statsStartX + 25, topBoxY + 28);
            pdf.text(`${cgpaData.totalMarksObtained.toFixed(0)} / ${cgpaData.totalMaxMarks}`, statsStartX + 25, topBoxY + 36);

            lastY = topBoxY + boxHeight;

            let semesterIndex = 0;
            Object.keys(dataToPrint.semesters) // --- Use dataToPrint ---
                .sort((a, b) => dataToPrint.semesters[a].sortKey.localeCompare(dataToPrint.semesters[b].sortKey))
                .forEach(semesterName => {
                    semesterIndex++;
                    const semester = dataToPrint.semesters[semesterName]; // --- Use dataToPrint ---
                    const activeCourses = semester.courses.filter(c => !c.isDeleted);
                    if (activeCourses.length === 0) return;

                    const semesterSummary = `GPA: ${formatNumber(semester.gpa, 4).toFixed(4)}  |  Credit Hours: ${semester.totalCreditHours}  |  Marks: ${semester.totalMarksObtained.toFixed(0)}/${semester.totalMaxMarks}`;

                    if (lastY + 30 > pageHeight - 30) { // Added margin check for footer
                        pdf.addPage();
                        lastY = 20; // Reset Y for new page
                    }
                    const semesterHeaderY = lastY + 12;

                    pdf.setFontSize(14);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(colors.primary);
                    pdf.text(`${semesterIndex}. ${semesterName}`, pageMargin, semesterHeaderY);

                    pdf.setFontSize(9);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(colors.textDark);
                    pdf.text(semesterSummary, pageWidth - pageMargin, semesterHeaderY, { align: 'right' });

                    lastY = semesterHeaderY + 2;

                    const head = [['Course Code', 'Course Title', 'CH', 'Marks', 'Grade']];
                    const body = activeCourses.map(c => [
                        c.code + (c.isCustom ? '*' : ''), // Mark custom courses
                        c.title || (c.isCustom ? 'Custom Course' : 'N/A'),
                        c.creditHoursDisplay || c.creditHours,
                        c.marks.toFixed(0),
                        c.grade
                    ]);


                    pdf.autoTable({
                        head: head,
                        body: body,
                        startY: lastY,
                        margin: { left: pageMargin, right: pageMargin },
                        headStyles: { fillColor: colors.primary, textColor: '#ffffff', fontStyle: 'bold', halign: 'center', valign: 'middle' },
                        columnStyles: {
                            0: { halign: 'left', cellWidth: availableWidth * 0.18 },
                            1: { halign: 'left', cellWidth: availableWidth * 0.46, cellPadding: { left: 2 } },
                            2: { halign: 'center', cellWidth: availableWidth * 0.12 },
                            3: { halign: 'center', cellWidth: availableWidth * 0.12 },
                            4: { halign: 'center', cellWidth: availableWidth * 0.12 }
                        },
                        styles: { valign: 'middle', cellPadding: 2.2, fontSize: 9, overflow: 'linebreak' },
                        alternateRowStyles: { fillColor: '#f8f9ff' },
                         didDrawPage: (data) => {
                             // Reset lastY for autoTable pagination
                             lastY = data.cursor.y;
                         }
                    });
                    // Update lastY after table drawing
                     lastY = pdf.lastAutoTable.finalY;


                    if (lastY < pageHeight - 30) { // Check against footer margin
                         pdf.setDrawColor(colors.line);
                         pdf.setLineWidth(0.3);
                         pdf.line(pageMargin, lastY + 6, pageWidth - pageMargin, lastY + 6);
                         lastY += 6;
                    }
                });

            // Footer for all pages
            const totalPages = pdf.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                pdf.setPage(i);
                pdf.setFontSize(9);
                pdf.setTextColor(colors.textLight);
                pdf.setFont('helvetica', 'italic');
                const footerY = pageHeight - 15;

                pdf.text("Generated by UAF CGPA Calculator - M Saqlain (https://uafcgpacalculator.vercel.app)", pageWidth / 2, footerY, { align: 'center' });
                pdf.text("This is an unofficial transcript. * indicates a custom course added manually.", pageWidth / 2, footerY + 5, { align: 'center' });

                pdf.setFontSize(8).setTextColor('#b0b0b0');
                pdf.text(`Page ${i} of ${totalPages}`, pageWidth - pageMargin, pageHeight - 10, { align: 'right' });
            }

            // --- Use titleSuffix for filename ---
            const safeSuffix = titleSuffix.replace(/ /g, '_');
            

// 1. Define Filename
const finalFilename = `UAF_Transcript_${dataToPrint.studentInfo.registration}_${safeSuffix}.pdf`;

// 2. Get Blob
const blob = pdf.output('blob');

// 3. Convert to Base64 and download via Server
const reader = new FileReader();
reader.readAsDataURL(blob);
reader.onloadend = function() {
    const base64data = reader.result;
    
    // Call the helper function
    forceAndroidDownload(finalFilename, base64data);
    
    addStatusMessage('PDF report generated successfully', 'success');
    showToast('PDF downloaded!', 'success');
};

        } catch (e) {
            addStatusMessage(`Error generating PDF: ${e.message}`, 'error');
            showToast('Error generating PDF', 'error');
            console.error("PDF generation error: ", e);
        } finally {
            showLoadingStage(null);
        }
      }

       // *** 1. ADD THIS NEW HELPER FUNCTION ***
    // This function contains the new deduplication logic (Req 2)
    // and is called by fetchAttendanceData either with fresh or cached data.
    function processAttendanceData(data) {
        if (!data || !data.resultData) {
            showToast('No attendance data to process.', 'info');
            return;
        }

        addStatusMessage(`Processing ${data.resultData.length} records from Attendance System...`, 'info');

        // --- REQ 2: New Deduplication Logic ---
        // 1. Create a global map of all existing LMS courses
        // Key: "CHEM-401", Value: Set {"75|B", "80|A"}
        const globalLmsCourseMap = new Map();
        Object.values(processedData.semesters).forEach(sem => {
            sem.courses.forEach(course => {
                // Only check against courses not deleted and not *already* from attendance
                if (!course.isDeleted && course.source !== 'attendance') {
                    const code = course.code.toUpperCase().trim();
                    // Use parseFloat for marks and handle potential 'N/A' grades
                    const marks = parseFloat(course.marks);
                    const grade = (course.grade || 'N/A').toUpperCase().trim();
                    const key = `${marks}|${grade}`;
                    
                    if (!globalLmsCourseMap.has(code)) {
                        globalLmsCourseMap.set(code, new Set());
                    }
                    globalLmsCourseMap.get(code).add(key);
                }
            });
        });
        // --- End of Map Build ---

        // 2. Process ALL attendance courses, flagging duplicates based on the new global map
        const allAttendanceCourses = [];
        data.resultData.forEach(attCourse => {
            const courseCode = (attCourse.CourseCode || '').toUpperCase().trim();
            const semesterName = processSemesterName(attCourse.Semester);
            const marks = parseFloat(attCourse.Totalmark || '0');
            const grade = (attCourse.Grade || 'N/A').toUpperCase().trim();
            const globalKey = `${marks}|${grade}`;

            let isDuplicate = false;

            // REQ 2: Check if this exact code, mark, and grade combo exists *anywhere* in the LMS data
            if (globalLmsCourseMap.has(courseCode) && globalLmsCourseMap.get(courseCode).has(globalKey)) {
                isDuplicate = true;
            }

            // Also check if it's *already* imported from attendance (original logic, still good)
            const semesterExists = processedData.semesters[semesterName];
            if (!isDuplicate && semesterExists && semesterExists.courses.some(c => 
                    c.code.toUpperCase().trim() === courseCode && 
                    c.isCustom && 
                    c.source === 'attendance'
                )) {
                isDuplicate = true; // Already imported, treat as duplicate
            }

            allAttendanceCourses.push({
                code: (attCourse.CourseCode || '').trim(), // Keep original case for display
                title: attCourse.CourseName || 'N/A',
                semester: semesterName,
                marks: marks,
                grade: (attCourse.Grade || 'N/A'), // Keep original case for display
                teacher: attCourse.TeacherName || 'N/A',
                mid: attCourse.Mid || '0',
                assignment: attCourse.Assigment || '0', // Corrected typo from API
                final: attCourse.Final || '0',
                practical: attCourse.Practical || '0',
                isDuplicate: isDuplicate 
            });
        });

        if (allAttendanceCourses.length > 0) {
            const importableCount = allAttendanceCourses.filter(c => !c.isDuplicate).length;
            addStatusMessage(`${allAttendanceCourses.length} courses found, ${importableCount} are new/importable. Showing import dialog.`, 'info');
            renderAttendanceImportModal(allAttendanceCourses);
            attendanceImportModal.show();
        } else {
            showToast('No courses found in Attendance System.', 'info');
            addStatusMessage('Attendance System search returned no courses.', 'success');
        }
    }


    // *** 2. REPLACE YOUR OLD FUNCTION WITH THIS UPDATED ONE ***
    async function fetchAttendanceData(clickedButton) { // <-- ACCEPTS THE BUTTON
        if (!processedData || !processedData.studentInfo || !processedData.studentInfo.registration) {
            showToast('Please fetch results first.', 'warning');
            return;
        }
        const regNum = processedData.studentInfo.registration;
        const cacheKey = `uafAttendanceCache_${regNum}`;
        const TEN_MINUTES_MS = 10 * 60 * 1000; // 10 minutes

        // --- Caching Logic ---
        try {
            const cachedDataJSON = localStorage.getItem(cacheKey);
            if (cachedDataJSON) {
                const cachedData = JSON.parse(cachedDataJSON);
                const cacheAge = Date.now() - cachedData.timestamp;

                if (cacheAge < TEN_MINUTES_MS) {
                    addStatusMessage(`Using cached attendance data (fetched ${Math.round(cacheAge / 1000 / 60)} mins ago).`, 'info');
                    showToast('Using cached attendance data.', 'info');
                    processAttendanceData(cachedData.data); // Process cached data
                    return; // Stop execution, don't fetch
                } else {
                    addStatusMessage('Cached attendance data is stale (> 10 mins). Fetching new data.', 'info');
                    localStorage.removeItem(cacheKey); // Clear stale data
                }
            }
        } catch (e) {
            console.error('Error reading cache:', e);
            localStorage.removeItem(cacheKey); // Clear corrupted cache
        }
        // --- End of Caching Logic ---

        addStatusMessage(`Fetching results from Attendance System for: ${regNum}`, 'info');
        
        // --- NEW: Show loading animation on the clicked button ---
        if (clickedButton) {
            clickedButton.disabled = true;
            clickedButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-2"></i>Fetching...';
        }

        try {
            const response = await fetch(`${ATTENDANCE_API_ENDPOINT}&registrationNumber=${encodeURIComponent(regNum)}`);
            const data = await response.json();

            if (!response.ok || !data.success) {
                throw new Error(data.message || `Server responded with status ${response.status}`);
            }
            
            addStatusMessage(`Successfully fetched ${data.resultData.length} records from Attendance System`, 'success');

            // --- Store in cache on successful fetch ---
            try {
                localStorage.setItem(cacheKey, JSON.stringify({ timestamp: Date.now(), data: data }));
                addStatusMessage('Saved attendance data to cache.', 'info');
            } catch (e) {
                console.error('Error saving to cache:', e);
                addStatusMessage('Could not save attendance data to cache (storage might be full).', 'warning');
            }

            // Call the new helper function to process and render
            processAttendanceData(data);

        } catch (error) {
            console.error("Attendance Fetch Error:", error);
            let userMessage = 'Could not retrieve Attendance System results. The server may be offline or the registration number is incorrect.';
            if (error.message.includes('timed out')) {
                userMessage = 'Connection to Attendance System timed out. Please try again later.';
            } else if (error.message.includes('No results found')) {
                userMessage = error.message; 
            }
            addStatusMessage(`Error fetching from Attendance System: ${error.message}`, 'error');
            showToast(userMessage, 'error');
        } finally {
            // --- NEW: Don't reset the button here ---
            // The setup function will be called by other functions
            // that modify the state (revert, import)
            
            // If no data was found or an error occurred, we must reset the buttons
            if (importedAttendanceCourses.length === 0) {
                 setupAttendanceButton();
            }
        }
    }


      function renderAttendanceImportModal(courses) {
        const listEl = document.getElementById('attendanceCourseList');
        const listElContainer = listEl.parentNode; // Get parent to replace
        let newListEl = listEl.cloneNode(false); // Create empty new list
        
        const toggleSwitch = document.getElementById('toggleAllCourses');
        const selectAllCheckbox = document.getElementById('toggleSelectAllCourses');
        const courseCountEl = document.getElementById('attendanceCourseCount');
        const modalTitle = document.getElementById('attendanceModalTitle');
        const modalDescription = document.getElementById('attendanceModalDescription');
        
        if (courses.length === 0) {
            newListEl.innerHTML = '<p class="text-center text-muted p-3">No courses found in Attendance System.</p>';
            importAttendanceCoursesBtn.disabled = true;
            if (toggleSwitch) toggleSwitch.closest('.d-flex').style.display = 'none';
            courseCountEl.textContent = 'Total: 0';
            listElContainer.replaceChild(newListEl, listEl); // Replace old list
            updateAttendanceCounts(); // Disable 'Select All'
            return;
        }

        let missingCoursesFound = false;
        
        courses.forEach((course, index) => {
            const courseId = `att-course-${index}`;
            const selectId = `att-ch-${index}`;
            const item = document.createElement('div');
            item.className = 'attendance-course-item';
            
            if (course.isDuplicate) {
                item.classList.add('duplicate-course');
                item.style.display = 'none';
            } else {
                missingCoursesFound = true;
            }

            let labelText = '';
            if (course.title && course.title.toLowerCase() !== 'n/a' && course.title.trim() !== '') {
                labelText = `${course.title} - `;
            }
            labelText += `Marks: ${course.marks}, Grade: ${course.grade}`;

            item.innerHTML = `
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="${index}" id="${courseId}" 
                        ${course.isDuplicate ? 'disabled' : 'checked'}>
                    <label class="form-check-label" for="${courseId}">
                        <strong>${course.code}</strong> (${course.semester})
                        ${course.isDuplicate ? '<span class="badge bg-success-subtle text-success-emphasis rounded-pill ms-1">In LMS</span>' : ''}
                        <small class="d-block text-muted">${labelText}</small>
                    </label>
                </div>
                <div class="import-ch-select">
                    <label for="${selectId}" class="form-label mb-0 small me-2">CH:</label>
                    <select class="form-select form-select-sm" id="${selectId}" ${course.isDuplicate ? 'disabled' : ''} style="width: 75px;">
                        ${[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(ch => `<option value="${ch}" ${ch === 3 ? 'selected' : ''}>${ch}</option>`).join('')}
                    </select>
                </div>
            `;
            item.querySelector(`#${courseId}`).dataset.courseData = JSON.stringify(course);
            newListEl.appendChild(item);
        });

        // Replace the old list with the new one to attach fresh listeners
        listElContainer.replaceChild(newListEl, listEl);

        // Attach listener for individual checkboxes
        newListEl.addEventListener('change', (e) => {
            if (e.target.classList.contains('form-check-input')) {
                updateAttendanceCounts();
            }
        });

        // --- Handle Toggles ---
        if (toggleSwitch) {
            toggleSwitch.closest('.d-flex').style.display = 'flex';
            toggleSwitch.checked = false; 
            
            const newToggle = toggleSwitch.cloneNode(true);
            toggleSwitch.parentNode.replaceChild(newToggle, toggleSwitch);
            
            newToggle.addEventListener('change', (e) => {
                const showAll = e.target.checked;
                newListEl.querySelectorAll('.duplicate-course').forEach(item => {
                    item.style.display = showAll ? 'flex' : 'none'; 
                });
                updateAttendanceCounts(); // Update counts and 'Select All' state
            });
        }
        
        if (selectAllCheckbox) {
            selectAllCheckbox.checked = false;
            
            const newSelectAll = selectAllCheckbox.cloneNode(true);
            selectAllCheckbox.parentNode.replaceChild(newSelectAll, selectAllCheckbox);

            newSelectAll.addEventListener('change', (e) => {
                const isChecked = e.target.checked;
                // Find *only visible* items
                newListEl.querySelectorAll('.attendance-course-item').forEach(item => {
                    if (item.style.display !== 'none') {
                        const checkbox = item.querySelector('.form-check-input:not(:disabled)');
                        if (checkbox) {
                            checkbox.checked = isChecked;
                        }
                    }
                });
                updateAttendanceCounts();
            });
        }
        // --- End of Toggle Logic ---

        // Update modal title, description, and counts
        courseCountEl.textContent = `Total: ${courses.length}`;
        
        if (missingCoursesFound) {
            modalTitle.innerHTML = '<i class="fa-solid fa-clipboard-user me-2"></i>Import Missing Courses';
            modalDescription.textContent = 'The following courses were found in the Attendance System but not in your main LMS results. Select courses to import and set their credit hours.';
        } else {
            modalTitle.innerHTML = '<i class="fa-solid fa-clipboard-check me-2"></i>Courses Synced';
            modalDescription.textContent = 'All courses found in the Attendance System are already present in your LMS results. You can toggle "Show All" to review them.';
        }

        importAttendanceCoursesBtn.disabled = false;
        updateAttendanceCounts(); // Set initial state for counts and 'Select All'
    }


     function importSelectedAttendanceCourses() {
        importedAttendanceCourses = []; // Clear any previous import list
        const selectedCheckboxes = document.querySelectorAll('#attendanceCourseList .form-check-input:checked');
        let importedCount = 0;

        selectedCheckboxes.forEach(checkbox => {
            // Ensure we are not importing a disabled checkbox
            if (checkbox.disabled) return;

            const courseData = JSON.parse(checkbox.dataset.courseData);
            const index = checkbox.value;
            const creditHoursSelect = document.getElementById(`att-ch-${index}`);
            const creditHours = parseInt(creditHoursSelect.value);

            if (!isNaN(creditHours) && creditHours > 0 && creditHours <= 10) {
                const semesterName = courseData.semester; // This is already the normalized name

                // Ensure semester exists
                if (!processedData.semesters[semesterName]) {
                    processedData.semesters[semesterName] = {
                        originalName: semesterName, // Use the processed name
                        sortKey: getSemesterOrderKey(semesterName),
                        courses: []
                    };
                     addStatusMessage(`Created new semester entry: ${semesterName} during import`, 'info');
                }

                // Create the course object
                const marks = courseData.marks;
                const grade = calculateCustomGrade(marks, creditHours); // Recalculate grade based on CH
                const qualityPoints = calculateQualityPoints(marks, creditHours, grade); // Use 'grade'

                const newCourse = {
                    code: courseData.code,
                    title: courseData.title || 'Imported from Attendance',
                    creditHours: creditHours,
                    creditHoursDisplay: `${creditHours}(${creditHours}-0)`, // Assuming theory only
                    marks: marks,
                    qualityPoints: qualityPoints,
                    grade: grade, 
                    teacher: courseData.teacher || 'Attendance System',
                    mid: courseData.mid || 'N/A',
                    assignment: courseData.assignment || 'N/A',
                    final: courseData.final || 'N/A',
                    practical: courseData.practical || 'N/A',
                    total: marks,
                    isExtraEnrolled: false, // Will be recalculated
                    isRepeated: false,      // Will be recalculated
                    isDeleted: false,
                    isCustom: true,          // Mark as custom
                    source: 'attendance',    // Add source marker
                    originalSemester: semesterName // Add originalSemester
                };

                 // Check if it already exists (non-deleted) before adding
                const semester = processedData.semesters[semesterName];
                 if (!semester.courses.some(c => !c.isDeleted && c.code.toUpperCase() === newCourse.code)) {
                     semester.courses.push(newCourse);
                     // Add to our revert list
                     importedAttendanceCourses.push({ semester: semesterName, code: newCourse.code });
                     importedCount++;
                 } else {
                     addStatusMessage(`Skipped importing ${newCourse.code} for ${semesterName} as it already exists.`, 'warning');
                 }

            } else {
                 showToast(`Invalid Credit Hours selected for ${courseData.code}`, 'warning');
            }
        });

        if (importedCount > 0) {
            recalculateAndDisplay(); // This will save the profile
            showToast(`${importedCount} course(s) imported successfully!`, 'success');
            addStatusMessage(`Imported ${importedCount} courses from Attendance System.`, 'info');
        } else {
              showToast('No new courses were imported.', 'info');
              importedAttendanceCourses = []; // Ensure list is empty if nothing was imported
        }

        setupAttendanceButton(); // Update the button to "Revert" or "Attendance"
        attendanceImportModal.hide();
    }



      // ==========================================
//  SECURE RESTRICTED ACCESS MODULE (V2)
// ==========================================

// 1. Configuration: Map Reg No -> Base64 Password
const _0xMap = {
    '2020-ag-9423': 'am9rZXI5MTE=', 
    '2020-ag-8662': 'am9rZXI5MTE=',
    '2020-ag-8876': 'am9rZXI5MTE=',
    '2020-ag-8636': 'am9rZXI5MTE=',
    '2019-ag-8136': 'bWlzczkxMQ=='
};

let _pendingReg = null;
const _modalEl = new bootstrap.Modal(document.getElementById('restrictedAccessModal'));
const _inputEl = document.getElementById('restrictedPassKey');
const _errEl = document.getElementById('passKeyError');
const _btnEl = document.getElementById('submitPassKeyBtn');

// 2. Anti-F12 & Anti-Debug Protection
document.addEventListener('contextmenu', (e) => e.preventDefault());

document.onkeydown = function(e) {
    if (e.keyCode == 123) return false; // F12
    if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) return false;
    if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) return false;
    if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
};

// 3. Main Fetch Logic Wrapper
function fetchResult() {
    const regNum = document.getElementById('registrationNumber').value.trim();
    if (!regNum) { showToast('Please enter a registration number', 'error'); return; }

    // Check if Reg No exists in our restricted map (Case Insensitive)
    const lowerReg = regNum.toLowerCase();
    if (_0xMap.hasOwnProperty(lowerReg)) {
        _pendingReg = lowerReg; // Store standardized reg num
        _inputEl.value = '';
        _inputEl.classList.remove('is-invalid');
        _errEl.style.display = 'none';
        _modalEl.show();
        return; // Stop execution
    }

    // Proceed if not restricted
    executeFetchLogic(regNum);
}

// 4. Secure Password Validation
function handlePassKeySubmit() {
    const inputVal = _inputEl.value;
    
    // Look up the correct hash for this specific user
    const correctHash = _0xMap[_pendingReg];

    // Convert input to Base64 and compare
    if (btoa(inputVal) === correctHash) {
        _modalEl.hide();
        showToast('Access Granted. Decrypting records...', 'success');
        executeFetchLogic(_pendingReg);
    } else {
        _errEl.style.display = 'block';
        _inputEl.classList.add('is-invalid');
        _btnEl.classList.add('pulse'); 
        setTimeout(() => _btnEl.classList.remove('pulse'), 500);
    }
}

// 5. Event Listeners
if(_btnEl) _btnEl.addEventListener('click', handlePassKeySubmit);
if(_inputEl) _inputEl.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') handlePassKeySubmit();
});

// 6. Original Core Fetch Logic
async function executeFetchLogic(regNum) {
    const resultContainer = document.getElementById('resultContainer');
    const bedResultContainer = document.getElementById('bedResultContainer');
    const gpaChartContainer = document.getElementById('gpaChartContainer');
    const semesterResults = document.getElementById('semesterResults');

    resultContainer.style.display = 'none';
    if(bedResultContainer) bedResultContainer.style.display = 'none';
    
    showLoadingStage('connecting');
    addStatusMessage(`Fetching result for: ${regNum}`, 'info');
    semesterResults.innerHTML = '';
    if(gpaChartContainer) gpaChartContainer.style.display = 'none';

    try {
        const response = await fetch(`${API_ENDPOINT}&registrationNumber=${encodeURIComponent(regNum)}`);
        showLoadingStage('fetching');
        const data = await response.json();

        if (!response.ok || !data.success) {
            throw new Error(data.message || `Server error: ${response.status}`);
        }

        showLoadingStage('processing');

        if (data.resultData && data.resultData.length > 0) {
            addStatusMessage('Result fetched successfully.', 'success');
            isInitialLoad = true;
            const processed = processScrapedData(data);

            // B.Ed Handling
            if (processed.hasBedCourses) {
                document.getElementById('bedConfirmYes').onclick = () => handleBedConfirm(true, processed);
                document.getElementById('bedConfirmNo').onclick = () => handleBedConfirm(false, processed);
                if (typeof bedConfirmationModal !== 'undefined') bedConfirmationModal.show();
            } else {
                handleBedConfirm(false, processed);
            }
        } else {
            throw new Error("No records found.");
        }
    } catch (error) {
        console.error("Fetch Error:", error);
        let userMessage = `Could not retrieve results: ${error.message}`;
        if (error.message.includes('Failed to fetch')) userMessage = 'Network error. Check internet connection.';
        
        addStatusMessage(`Error: ${error.message}`, 'error');
        showToast(userMessage, 'error');
        showLoadingStage(null);
    }
}

          
          // --- UPDATE: Event Listener for main export button opens manager ---
      exportProfilesBtn.addEventListener('click', () => {
        if (Object.keys(getProfiles()).length === 0) {
            showToast('No profiles available to export.', 'info');
            return;
        }
        renderProfileManager();
        profileManagerModal.show();
        showToast('Select profiles from the manager to export.', 'info');
      });

      // Event Listeners
      resultForm.addEventListener('submit', (e) => { e.preventDefault(); fetchResult(); });
      downloadLogBtn.addEventListener('click', downloadLog);
      clearLogBtn.addEventListener('click', clearLog);
      saveCourseBtn.addEventListener('click', addCustomCourse);
      profileSwitcher.addEventListener('change', switchProfile);
      
      // FIX: Add the missing event listener here
      saveProfileNameBtn.addEventListener('click', renameProfile); 
      
      document.getElementById('confirmationConfirmBtn').addEventListener('click', handleConfirm);

      // Main buttons
      downloadPdfBtn.addEventListener('click', generatePDF);
      addForecastSemesterBtn.addEventListener('click', addForecastSemester);

      // B.Ed. Tab buttons
      document.getElementById('bed-downloadPdfBtn').addEventListener('click', generatePDF);
      document.getElementById('bed-addForecastSemesterBtn').addEventListener('click', addForecastSemester);
      
      // Other Tab buttons
      document.getElementById('other-downloadPdfBtn').addEventListener('click', generatePDF);
      document.getElementById('other-addForecastSemesterBtn').addEventListener('click', addForecastSemester);

       // NEW: Attendance Button Setup
      setupAttendanceButton(); // This replaces the simple event listener
      importAttendanceCoursesBtn.addEventListener('click', importSelectedAttendanceCourses);

      importProfilesBtn.addEventListener('click', importProfiles);
      importProfilesBtnModal.addEventListener('click', importProfiles); // Add listener for modal button
      exportProfilesBtnModal.addEventListener('click', exportSelectedProfiles); // Use exportSelectedProfiles for modal button

      // Profile Manager Listeners
      openProfileManagerBtn.addEventListener('click', () => {
          renderProfileManager();
          profileManagerModal.show();
      });
      document.getElementById('selectAllProfiles').addEventListener('change', e => {
          document.querySelectorAll('.profile-checkbox').forEach(cb => cb.checked = e.target.checked);
          const anyChecked = e.target.checked;
           document.getElementById('bulkActionsBtn').disabled = !anyChecked;
           exportProfilesBtnModal.disabled = !anyChecked; // Also enable/disable export in modal
      });

        document.getElementById('profileManagerList').addEventListener('change', e => {
            if (e.target.classList.contains('profile-checkbox')) {
                const anyChecked = !!document.querySelector('.profile-checkbox:checked');
                document.getElementById('bulkActionsBtn').disabled = !anyChecked;
                // Also enable/disable the modal export button based on selection
                exportProfilesBtnModal.disabled = !anyChecked;

                 // Update "Select All" checkbox state
                const allCheckboxes = document.querySelectorAll('.profile-checkbox');
                const allChecked = allCheckboxes.length > 0 && Array.from(allCheckboxes).every(cb => cb.checked);
                document.getElementById('selectAllProfiles').checked = allChecked;
                document.getElementById('selectAllProfiles').indeterminate = !allChecked && anyChecked;

            }
        });

      document.getElementById('deleteSelectedBtn').addEventListener('click', handleBulkAction);

      init();
    });

</script>

          <script>
document.addEventListener('DOMContentLoaded', function() {

  // --- Common Elements ---
  const qpTableContainer = document.getElementById('qpTableContainer');
  const qpTableImage = document.getElementById('qpTableImage');
  const lightbox = document.getElementById('imageLightbox');
  const lightboxContent = document.getElementById('lightboxContent');
  const lightboxClose = document.getElementById('lightboxClose');

  if (!qpTableContainer || !qpTableImage || !lightbox || !lightboxContent || !lightboxClose) {
      console.error("Lightbox elements not found!");
      return;
  }

  const imageSrc = qpTableImage.src;
  let lightboxImage = null; // Reference to the image inside the lightbox

  // --- State Variables ---
  let isLightboxOpen = false;
  let isDesktop = window.matchMedia("(hover: hover) and (pointer: fine)").matches; // Detect if likely desktop

  // Mobile pinch/pan state
  let scale = 1, isPanning = false, isPinching = false;
  let start = { x: 0, y: 0 };
  let initialPinchDistance = 0;
  let currentTransform = { scale: 1, translateX: 0, translateY: 0 };

  // Desktop hover zoom state
  const desktopZoomLevel = 4.5; // How much to zoom on desktop hover

  // --- Utility Functions ---
  function applyTransform() {
    if (!lightboxImage) return;
    // Apply transform based on *current* state (pan/zoom for mobile)
    lightboxImage.style.transform = `translate(${currentTransform.translateX}px, ${currentTransform.translateY}px) scale(${currentTransform.scale})`;
  }

  function getDistance(p1, p2) {
    return Math.hypot(p1.clientX - p2.clientX, p1.clientY - p2.clientY);
  }

  function getCenter(p1, p2) {
    return { x: (p1.clientX + p2.clientX) / 2, y: (p1.clientY + p2.clientY) / 2 };
  }

  // --- Lightbox Open/Close ---
  function openLightbox() {
    if (isLightboxOpen) return;

    const imgClone = qpTableImage.cloneNode(true);
    imgClone.id = 'lightboxImage';
    // Reset styles specifically for the lightbox
    imgClone.style.transform = '';
    imgClone.style.transition = 'transform 0.15s ease-out'; // Keep transition
    imgClone.style.maxWidth = '95%';
    imgClone.style.maxHeight = '95%';
    imgClone.style.width = 'auto';
    imgClone.style.height = 'auto';
    lightboxContent.innerHTML = '';
    lightboxContent.appendChild(imgClone);
    lightboxImage = imgClone;

    // Reset interaction states
    isPanning = false; isPinching = false;
    currentTransform = { scale: 1, translateX: 0, translateY: 0 };
    applyTransform(); // Set initial state

    lightbox.classList.add('show');
    document.body.style.overflow = 'hidden'; // Prevent body scroll
    isLightboxOpen = true;

    // Attach interaction listeners based on device type
    if (isDesktop) {
        setupDesktopLightboxInteraction();
    } else {
        setupMobileLightboxInteraction();
    }
  }

  function closeLightbox() {
    if (!isLightboxOpen) return;
    lightbox.classList.remove('show');
    document.body.style.overflow = ''; // Restore body scroll
    isLightboxOpen = false;
    lightboxImage = null; // Clean up image ref
    // Remove specific listeners added when opened
    removeDesktopLightboxInteraction();
    removeMobileLightboxInteraction();
  }

  // --- Desktop Lightbox Interaction (Hover Zoom) ---
  const handleDesktopMouseMove = (e) => {
      if (!lightboxImage || !isLightboxOpen) return;

      const rect = lightboxImage.getBoundingClientRect();
      // Calculate cursor position as a percentage of the image dimensions
      const xPercent = ((e.clientX - rect.left) / rect.width) * 100;
      const yPercent = ((e.clientY - rect.top) / rect.height) * 100;

      // Apply scale and set transform origin to follow cursor
      lightboxImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
      lightboxImage.style.transform = `scale(${desktopZoomLevel})`;
  };

  const handleDesktopMouseLeave = () => {
      if (!lightboxImage || !isLightboxOpen) return;
      // Reset zoom when mouse leaves the image
      lightboxImage.style.transformOrigin = `center center`;
      lightboxImage.style.transform = `scale(1)`;
  };

  function setupDesktopLightboxInteraction() {
    if (!lightboxImage) return;
    lightboxContent.classList.add('desktop-zoom-active');
    lightboxImage.addEventListener('mousemove', handleDesktopMouseMove);
    lightboxImage.addEventListener('mouseleave', handleDesktopMouseLeave);
     // Add wheel zoom for desktop as well
    lightboxContent.addEventListener('wheel', handleWheelZoom, { passive: false });
  }

  function removeDesktopLightboxInteraction() {
    if (!lightboxImage) return;
    lightboxContent.classList.remove('desktop-zoom-active');
    lightboxImage.removeEventListener('mousemove', handleDesktopMouseMove);
    lightboxImage.removeEventListener('mouseleave', handleDesktopMouseLeave);
    lightboxContent.removeEventListener('wheel', handleWheelZoom);
  }

  // --- Mobile Lightbox Interaction (Pinch/Pan) ---
  const handleTouchStart = (e) => {
    if (!lightboxImage || !isLightboxOpen) return;
    
    if (e.touches.length === 1 && currentTransform.scale > 1) { // Only pan if zoomed
      isPanning = true;
      start.x = e.touches[0].clientX - currentTransform.translateX;
      start.y = e.touches[0].clientY - currentTransform.translateY;
    } else if (e.touches.length === 2) {
      isPanning = false; // Stop panning
      isPinching = true;
      initialPinchDistance = getDistance(e.touches[0], e.touches[1]);
      // Store center based on current transform - needed? Maybe not.
    }
  };

  const handleTouchMove = (e) => {
    if (!lightboxImage || !isLightboxOpen) return;
    e.preventDefault(); // Prevent scroll

    if (isPanning && e.touches.length === 1) {
      currentTransform.translateX = e.touches[0].clientX - start.x;
      currentTransform.translateY = e.touches[0].clientY - start.y;
      applyTransform();
    } else if (isPinching && e.touches.length === 2) {
        const currentPinchDistance = getDistance(e.touches[0], e.touches[1]);
        const scaleChange = currentPinchDistance / initialPinchDistance;
        let potentialNewScale = currentTransform.scale * scaleChange;

        // Clamp scale
        potentialNewScale = Math.max(1, Math.min(potentialNewScale, 10)); // Min 1x, Max 10x

        // Calculate zoom origin relative to the image
        const rect = lightboxImage.getBoundingClientRect();
        // Use the initial touch center relative to the viewport
        const touchCenterXVP = getCenter(e.touches[0], e.touches[1]).x;
        const touchCenterYVP = getCenter(e.touches[0], e.touches[1]).y;
        // Convert to position relative to the *untransformed* image top-left
        const originX = (touchCenterXVP - rect.left - currentTransform.translateX) / currentTransform.scale;
        const originY = (touchCenterYVP - rect.top - currentTransform.translateY) / currentTransform.scale;

        // Calculate new translation to keep origin point fixed
        currentTransform.translateX += originX * currentTransform.scale - originX * potentialNewScale;
        currentTransform.translateY += originY * currentTransform.scale - originY * potentialNewScale;
        currentTransform.scale = potentialNewScale; // Apply the new scale

        applyTransform();

        // Update for next move event (essential)
        initialPinchDistance = currentPinchDistance;
    }
  };

  const handleTouchEnd = (e) => {
    if (!lightboxImage || !isLightboxOpen) return;

    if (isPanning && e.touches.length === 0) {
      isPanning = false;
    }
    if (isPinching && e.touches.length < 2) {
      isPinching = false;
      // Check if scale is close to 1, if so, reset position
      if (currentTransform.scale <= 1.05) {
         currentTransform.scale = 1; // Snap to 1
         currentTransform.translateX = 0;
         currentTransform.translateY = 0;
         // Apply transform with a slight delay/transition if desired
         lightboxImage.style.transition = 'transform 0.2s ease-out'; // Add smooth reset
         applyTransform();
         setTimeout(() => {
              if (lightboxImage) lightboxImage.style.transition = 'transform 0.15s ease-out'; // Restore default transition
         }, 200);
      }
    }
  };

  function setupMobileLightboxInteraction() {
    if (!lightboxContent) return;
    lightboxContent.addEventListener('touchstart', handleTouchStart, { passive: false });
    lightboxContent.addEventListener('touchmove', handleTouchMove, { passive: false });
    lightboxContent.addEventListener('touchend', handleTouchEnd);
    lightboxContent.addEventListener('touchcancel', handleTouchEnd); // Use same handler for cancel
  }

  function removeMobileLightboxInteraction() {
    if (!lightboxContent) return;
    lightboxContent.removeEventListener('touchstart', handleTouchStart);
    lightboxContent.removeEventListener('touchmove', handleTouchMove);
    lightboxContent.removeEventListener('touchend', handleTouchEnd);
    lightboxContent.removeEventListener('touchcancel', handleTouchEnd);
  }

  // --- Wheel Zoom (Common for both in Lightbox) ---
  const handleWheelZoom = (e) => {
      if (!lightboxImage || !isLightboxOpen) return;
      e.preventDefault();

      const rect = lightboxImage.getBoundingClientRect();
      const delta = e.deltaY > 0 ? -0.2 : 0.2; // Zoom speed
      let potentialNewScale = currentTransform.scale + delta * currentTransform.scale; // Zoom relative to current scale

      // Clamp scale
      potentialNewScale = Math.max(1, Math.min(potentialNewScale, 10));

      // Calculate zoom origin relative to image
      const originX = (e.clientX - rect.left - currentTransform.translateX) / currentTransform.scale;
      const originY = (e.clientY - rect.top - currentTransform.translateY) / currentTransform.scale;

      // Calculate new translation to keep origin fixed
      currentTransform.translateX += originX * currentTransform.scale - originX * potentialNewScale;
      currentTransform.translateY += originY * currentTransform.scale - originY * potentialNewScale;
      currentTransform.scale = potentialNewScale;

      // Reset position if zoomed out fully
      if (currentTransform.scale <= 1.05) {
          currentTransform.scale = 1;
          currentTransform.translateX = 0;
          currentTransform.translateY = 0;
      }

      applyTransform();
  };


  // --- Event Listeners ---
  qpTableContainer.addEventListener('click', openLightbox);
  lightboxClose.addEventListener('click', closeLightbox);
  lightbox.addEventListener('click', (e) => { // Close on background click
    if (e.target === lightbox) closeLightbox();
  });

});
</script>

          <div id="imageLightbox" class="image-lightbox">
  <button id="lightboxClose" class="lightbox-close-btn" title="Close"><i class="fa-solid fa-times"></i></button>
  <div id="lightboxContent" class="lightbox-content">
    </div>
</div>          

         <script>
document.addEventListener('DOMContentLoaded', function() {
  
  // Initialize Bootstrap Popovers
  const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
  const popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
    return new bootstrap.Popover(popoverTriggerEl);
  });

  /**
   * Fetches the server statuses from our *own* backend API.
   */
  async function checkServerStatuses() {
    const lmsItem = document.getElementById('lms-status-item');
    const attndItem = document.getElementById('attnd-status-item');
    const lmsDot = document.getElementById('lms-status-dot');
    const attndDot = document.getElementById('attnd-status-dot');

    if (!lmsItem || !attndItem || !lmsDot || !attndDot) return;

    // Loading state is handled by default HTML (infinity-loader is visible)

    try {
      // Call our API endpoint
      const response = await fetch('/api/result-scraper?action=check_status', {
        cache: 'no-cache',
        signal: AbortSignal.timeout(15000) // 15-second timeout
      });
      
      if (!response.ok) {
        throw new Error('Status check API failed');
      }

      const data = await response.json();

      // --- Set LMS status ---
      if (data.lms_status === 'online') {
        lmsDot.className = 'status-dot online';
        lmsDot.title = 'LMS is Online';
      } else {
        // Treat "offline" and "error" both as 'offline' (red)
        lmsDot.className = 'status-dot offline';
        lmsDot.title = 'LMS is Offline or Unreachable';
      }
      // Add 'status-loaded' class to show the label and dot
      lmsItem.classList.add('status-loaded');


      // --- Set Attendance status ---
      if (data.attnd_status === 'online') {
        attndDot.className = 'status-dot online';
        attndDot.title = 'Attendance System is Online';
      } else {
        // Treat "offline" and "error" both as 'offline' (red)
        attndDot.className = 'status-dot offline';
        attndDot.title = 'Attendance System is Offline or has an Error';
      }
      // Add 'status-loaded' class to show the label and dot
      attndItem.classList.add('status-loaded');

    } catch (error) {
      console.error('Failed to fetch server statuses:', error.name, error.message);
      
      // If the API call itself fails, mark both as offline
      lmsDot.className = 'status-dot offline';
      lmsDot.title = 'Status check failed';
      lmsItem.classList.add('status-loaded');

      attndDot.className = 'status-dot offline';
      attndDot.title = 'Status check failed';
      attndItem.classList.add('status-loaded');
    }
  }

  // Run the check when the page loads
  checkServerStatuses();
  
});
</script>

</body>
</html>





